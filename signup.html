<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sign Up â€” 8BFR Music Network</title>
  <link rel="icon" href="assets/images/favicon.png">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { background:#0a0a0a; color:#fff; font-family:Inter,system-ui; padding:1rem; margin:0; min-height:100vh; }
    .card { max-width:760px; margin:0 auto; background:#111; padding:1.5rem; border-radius:8px; border:1px solid #222; }
    label { display:block; margin:.5rem 0; color:#ccc; font-weight:600; }
    input, textarea { width:100%; padding:.6rem; border-radius:6px; border:1px solid #333; background:#070707; color:#fff; box-sizing:border-box; }
    .btn { background:#7c3aed; color:#fff; padding:.8rem 1rem; border:none; border-radius:6px; cursor:pointer; margin-top:1rem; width:100%; font-weight:600; font-size:1rem; }
    .btn:hover { background:#6d28d9; }
    .btn:disabled { opacity:0.5; cursor:not-allowed; }
    .muted { color:#999; font-size:.9rem; }
    .error { color:#ff4444; background:rgba(255,68,68,0.1); padding:.5rem; border-radius:4px; margin:.5rem 0; }
    .success { color:#44ff88; background:rgba(68,255,136,0.1); padding:.5rem; border-radius:4px; margin:.5rem 0; }
    .checkbox-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:.5rem; max-height:250px; overflow-y:auto; padding:.5rem; background:#0a0a0a; border:1px solid #333; border-radius:4px; margin-top:.5rem; }
    .checkbox-item { display:flex; align-items:center; gap:.5rem; }
    .checkbox-item input { width:auto; }
    .checkbox-item label { margin:0; cursor:pointer; font-size:.85rem; font-weight:400; }
    .pw { position:relative; }
    .pw button { position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:none; color:#999; cursor:pointer; font-size:1.2rem; }
    h2 { color:#a855f7; }
    a { color:#00d9ff; }
  </style>
</head>
<body>
  <div class="card">
    <div style="text-align:center;margin-bottom:1.5rem;">
      <div style="font-size:2.5rem;">ğŸŸ£</div>
      <h2 style="margin:0.5rem 0 0.25rem;">Join 8BFR Music Network</h2>
      <p class="muted">Create â€¢ Connect â€¢ Collab</p>
    </div>
    <form id="signupForm">
      <label>Email *</label>
      <input name="email" type="email" required placeholder="your.email@example.com">
      <label>Password * (min 6 characters)</label>
      <div class="pw">
        <input id="pw1" name="password" type="password" required minlength="6" placeholder="Enter secure password">
        <button type="button" onclick="var f=document.getElementById('pw1');f.type=f.type==='password'?'text':'password'">ğŸ‘ï¸</button>
      </div>
      <label>Confirm Password *</label>
      <div class="pw">
        <input id="pw2" type="password" required minlength="6" placeholder="Re-enter password">
        <button type="button" onclick="var f=document.getElementById('pw2');f.type=f.type==='password'?'text':'password'">ğŸ‘ï¸</button>
      </div>
      <label>Username * (unique, no spaces)</label>
      <input name="username" type="text" required placeholder="yourusername" pattern="[a-zA-Z0-9_]+" maxlength="30">
      <label>Display Name</label>
      <input name="display_name" type="text" placeholder="Your Display Name" maxlength="50">
      <label>Bio</label>
      <textarea name="bio" rows="3" placeholder="Tell us about yourself..."></textarea>
      <label>I am a... (select roles) *</label>
      <div class="checkbox-grid">
        <div class="checkbox-item"><input type="checkbox" name="roles" value="fan" id="r1" checked><label for="r1">ğŸ’ Fan</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="artist" id="r2"><label for="r2">ğŸ¤ Artist</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="beatmaker" id="r3"><label for="r3">ğŸšï¸ Beatmaker</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="producer" id="r4"><label for="r4">ğŸ§ Producer</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="singer" id="r5"><label for="r5">ğŸ¶ Singer</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="musician" id="r6"><label for="r6">ğŸ¸ Musician</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="songwriter" id="r7"><label for="r7">ğŸ¼ Songwriter</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="dj" id="r8"><label for="r8">ğŸ“€ DJ</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="rapper" id="r9"><label for="r9">ğŸ¤ Rapper</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="author" id="r10"><label for="r10">ğŸ“– Author</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="blogger" id="r11"><label for="r11">ğŸ“° Blogger</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="streamer" id="r12"><label for="r12">ğŸ“¡ Streamer</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="gamer" id="r13"><label for="r13">ğŸ® Gamer</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="influencer" id="r14"><label for="r14">ğŸ’« Influencer</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="designer" id="r15"><label for="r15">ğŸ¨ Designer</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="developer" id="r16"><label for="r16">ğŸ§  Developer</label></div>
        <div class="checkbox-item"><input type="checkbox" name="roles" value="supporter" id="r17"><label for="r17">ğŸ¤ Supporter</label></div>
      </div>
      <label>Verification Link (optional â€” for artists seeking verification)</label>
      <input name="verify_url" type="url" placeholder="https://spotify.com/artist/... or social media link">
      <p class="muted" style="font-size:0.8rem;margin-top:0.25rem;">Verification is reviewed and approved by the platform owner. You cannot self-verify.</p>
      <div id="message"></div>
      <button type="submit" class="btn" id="submitBtn">ğŸš€ Create Account</button>
      <p class="muted" style="text-align:center;margin-top:1rem;">Already have an account? <a href="login.html">Log in here</a></p>
      <p style="text-align:center;margin-top:0.5rem;"><a href="index.html" style="color:#a855f7;font-size:0.85rem;text-decoration:none;">â† Back to Home</a></p>
    </form>
  </div>
  <script>
  document.getElementById('signupForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    var fd = new FormData(e.target), msg = document.getElementById('message'), btn = document.getElementById('submitBtn');
    var email = fd.get('email'), password = fd.get('password'), confirm = document.getElementById('pw2').value;
    var username = fd.get('username'), display_name = fd.get('display_name'), bio = fd.get('bio'), verify_url = fd.get('verify_url');
    var roles = fd.getAll('roles');
    if (password !== confirm) { msg.innerHTML = '<div class="error">Passwords do not match!</div>'; return; }
    if (roles.length === 0) { msg.innerHTML = '<div class="error">Please select at least one role.</div>'; return; }
    if (!/^[a-zA-Z0-9_]+$/.test(username)) { msg.innerHTML = '<div class="error">Username: letters, numbers, underscores only.</div>'; return; }
    btn.disabled = true; btn.textContent = 'Creating account...'; msg.innerHTML = '';
    try {
      if (!window.supabase) throw new Error('Supabase library failed to load. Refresh the page.');
      var db = window.supabase.createClient('https://novbuvwpjnxwwvdekjhr.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0');
      var ex = await db.from('profiles').select('user_id').eq('username', username).limit(1);
      if (ex.data && ex.data.length > 0) throw new Error('Username already taken.');
      var mc = await db.from('profiles').select('user_id', { count: 'exact', head: true });
      var isFounder = (mc.count || 0) < 1000;
      var auth = await db.auth.signUp({ email: email, password: password });
      if (auth.error) throw auth.error;
      if (!auth.data.user) throw new Error('Signup failed.');
      var badges = roles.slice();
      if (isFounder) badges.push('founder');
      await db.from('profiles').insert({
        user_id: auth.data.user.id, email: email, username: username,
        display_name: display_name || username, bio: bio || null,
        role: roles[0] || 'fan', badges: badges, verified_artist: false,
        verify_url: verify_url || null,
        algorithm_points: isFounder ? 100 : 0, algorithm_tier: 'Bronze'
      });
      msg.innerHTML = '<div class="success">âœ… Account created! Redirecting to your profile...</div>';
      setTimeout(function() { window.location.href = 'profile.html'; }, 1500);
    } catch(err) {
      var m = err.message || 'Signup failed';
      if (m.includes('already registered')) m = 'This email is already registered. Try logging in.';
      msg.innerHTML = '<div class="error">' + m + '</div>';
      btn.disabled = false; btn.textContent = 'ğŸš€ Create Account';
    }
  });
  </script>
</body>
</html>
