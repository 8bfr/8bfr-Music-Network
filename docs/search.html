
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Search ‚Äî 8BFR Music Network</title>
<link rel="icon" href="assets/images/favicon.png" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  * { box-sizing: border-box; }
  body {
    background: linear-gradient(#0b0014, #000);
    color: #eae6ff;
    font-family: system-ui, -apple-system, sans-serif;
    margin: 0;
    padding: 0;
  }
  
  .header {
    background: rgba(15, 0, 30, 0.95);
    border-bottom: 1px solid rgba(124, 58, 237, 0.5);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
  }
  
  .search-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  .search-box {
    position: relative;
    margin-bottom: 2rem;
  }
  
  .search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    background: rgba(18, 3, 39, 0.8);
    border: 1px solid rgba(124, 58, 237, 0.4);
    border-radius: 12px;
    color: #fff;
    font-size: 1rem;
    transition: all 0.2s;
  }
  
  .search-input:focus {
    outline: none;
    border-color: #a855f7;
    box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
  }
  
  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.2rem;
    color: #a855f7;
  }
  
  .filter-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }
  
  .filter-tab {
    padding: 0.6rem 1.2rem;
    background: rgba(124, 58, 237, 0.1);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 20px;
    color: #a855f7;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
  }
  
  .filter-tab:hover,
  .filter-tab.active {
    background: rgba(124, 58, 237, 0.3);
    border-color: #a855f7;
  }
  
  .result-card {
    background: rgba(12, 6, 24, 0.8);
    border: 1px solid rgba(124, 58, 237, 0.35);
    border-radius: 14px;
    padding: 1.25rem;
    margin-bottom: 1rem;
    transition: all 0.3s;
  }
  
  .result-card:hover {
    border-color: rgba(168, 85, 247, 0.6);
    box-shadow: 0 8px 32px rgba(124, 58, 237, 0.3);
  }
  
  .result-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  
  .result-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    flex-shrink: 0;
  }
  
  .result-info {
    flex: 1;
    min-width: 0;
  }
  
  .result-name {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }
  
  .verified-badge {
    color: #00d9ff;
    font-size: 1rem;
  }
  
  .result-badges {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
  }
  
  .badge {
    padding: 0.25rem 0.6rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
    background: rgba(124, 58, 237, 0.2);
    border: 1px solid rgba(124, 58, 237, 0.4);
    color: #a855f7;
  }
  
  .badge.founder {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
    border-color: rgba(245, 158, 11, 0.5);
    color: #f59e0b;
  }
  
  .result-bio {
    font-size: 0.9rem;
    color: #a855f7;
    opacity: 0.8;
    margin-bottom: 1rem;
    line-height: 1.5;
  }
  
  .result-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  
  .action-btn {
    padding: 0.6rem 1.25rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.85rem;
    text-decoration: none;
    display: inline-block;
  }
  
  .view-btn {
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    border: none;
    color: white;
  }
  
  .follow-btn {
    background: rgba(124, 58, 237, 0.2);
    border: 1px solid rgba(124, 58, 237, 0.5);
    color: #a855f7;
  }
  
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #a855f7;
    opacity: 0.7;
  }
  
  .debug-info {
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.9);
    color: #0f0;
    padding: 10px;
    border-radius: 8px;
    font-size: 12px;
    z-index: 9999;
    max-width: 300px;
  }
</style>
</head>
<body>

<header class="header">
  <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
    <a href="index.html" style="color: #a855f7; text-decoration: none; font-weight: 600;">‚Üê Home</a>
    <h1 style="font-size: 1.25rem; font-weight: 800;">üîç Search</h1>
    <div style="width: 80px;"></div>
  </div>
</header>

<main class="search-container">
  
  <div class="search-box">
    <span class="search-icon">üîç</span>
    <input 
      type="text" 
      class="search-input" 
      id="searchInput" 
      placeholder="Search artists, beatmakers, producers..."
      autocomplete="off"
    >
  </div>
  
  <div class="filter-tabs">
    <button class="filter-tab active" data-filter="all">All</button>
    <button class="filter-tab" data-filter="artist">üé§ Artists</button>
    <button class="filter-tab" data-filter="beatmaker">üéöÔ∏è Beatmakers</button>
    <button class="filter-tab" data-filter="producer">üéß Producers</button>
    <button class="filter-tab" data-filter="verified">üõ°Ô∏è Verified</button>
  </div>
  
  <div id="searchResults">
    <div class="empty-state">
      <div style="font-size: 4rem; margin-bottom: 1rem;">üîç</div>
      <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">
        Loading profiles...
      </div>
    </div>
  </div>
  
</main>

<div id="debugInfo" class="debug-info" style="display:none;"></div>

<script src="scripts.js" defer></script>

<script>
const SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let allProfiles = [];
let currentFilter = 'all';

function debug(msg) {
  const d = document.getElementById('debugInfo');
  d.style.display = 'block';
  d.innerHTML += msg + '<br>';
}

async function getAllProfiles() {
  debug('Loading profiles from Supabase...');
  const { data, error } = await supabase.from('profiles').select('*');
  
  if (error) {
    debug('ERROR: ' + error.message);
    return [];
  }
  
  debug('Loaded ' + (data?.length || 0) + ' profiles');
  
  // Convert Supabase format to match localStorage format
  const profiles = (data || []).map(p => {
    const rolesOrdered = p.roles_ordered || [];
    const tags = p.tags || [];
    const badges = [...new Set([...rolesOrdered, ...tags])];
    
    return {
      key: 'profile_' + p.user_id,
      id: p.user_id,
      name: p.username || p.display_name || 'Unknown',
      emoji: rolesOrdered[0] === 'artist' ? 'üé§' : rolesOrdered[0] === 'beatmaker' ? 'üéöÔ∏è' : 'üë§',
      bio: p.bio || '',
      badges: badges,
      verified: p.verified_artist || false,
      user_id: p.user_id
    };
  });
  
  debug('Converted profiles: ' + profiles.length);
  if (profiles.length > 0) {
    debug('Example: ' + profiles[0].name + ' has badges: ' + profiles[0].badges.join(', '));
  }
  
  return profiles;
}

function performSearch() {
  const query = document.getElementById('searchInput').value.toLowerCase().trim();
  
  let filtered = allProfiles;
  
  debug('Filter: ' + currentFilter + ', Query: "' + query + '"');
  
  // Apply filter (SAME as localStorage version)
  if (currentFilter === 'artist') {
    filtered = allProfiles.filter(p => p.badges && p.badges.includes('artist'));
  } else if (currentFilter === 'beatmaker') {
    filtered = allProfiles.filter(p => p.badges && p.badges.includes('beatmaker'));
  } else if (currentFilter === 'producer') {
    filtered = allProfiles.filter(p => p.badges && p.badges.includes('producer'));
  } else if (currentFilter === 'verified') {
    filtered = allProfiles.filter(p => p.verified === true);
  }
  
  debug('After filter: ' + filtered.length + ' profiles');
  
  // Apply search query (SAME as localStorage version)
  if (query) {
    filtered = filtered.filter(p => {
      const nameMatch = p.name.toLowerCase().includes(query);
      const bioMatch = p.bio && p.bio.toLowerCase().includes(query);
      
      return nameMatch || bioMatch;
    });
    debug('After search: ' + filtered.length + ' profiles');
  }
  
  renderResults(filtered);
}

function renderResults(results) {
  const resultsEl = document.getElementById('searchResults');
  
  if (results.length === 0) {
    resultsEl.innerHTML = `
      <div class="empty-state">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üòî</div>
        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">
          No results found
        </div>
        <div style="font-size: 0.9rem;">
          Total profiles loaded: ${allProfiles.length}<br>
          Try a different search term or filter
        </div>
      </div>
    `;
    return;
  }
  
  // SAME rendering as localStorage version
  const resultsHTML = results.map(profile => {
    let badgesHTML = '';
    if (profile.badges && profile.badges.length > 0) {
      badgesHTML = profile.badges.map(badge => {
        const badgeClass = badge === 'founder' ? 'founder' : '';
        const badgeEmoji = {
          'artist': 'üé§',
          'beatmaker': 'üéöÔ∏è',
          'verified': '‚úì',
          'founder': 'üëë',
          'songwriter': '‚úçÔ∏è',
          'producer': 'üéß'
        }[badge] || '';
        
        return `<span class="badge ${badgeClass}">${badgeEmoji} ${badge.toUpperCase()}</span>`;
      }).join('');
    }
    
    return `
      <div class="result-card">
        <div class="result-header">
          <div class="result-avatar">${profile.emoji || 'üéµ'}</div>
          <div class="result-info">
            <div class="result-name">
              ${profile.name}
              ${profile.verified ? '<span class="verified-badge">‚úì</span>' : ''}
            </div>
            ${badgesHTML ? `<div class="result-badges">${badgesHTML}</div>` : ''}
          </div>
        </div>
        
        ${profile.bio ? `<div class="result-bio">${profile.bio}</div>` : ''}
        
        <div class="result-actions">
          <a href="profile.html?id=${profile.user_id}" class="action-btn view-btn">
            üë§ View Profile
          </a>
          <button class="action-btn follow-btn" onclick="alert('‚úÖ Following!')">
            Follow
          </button>
        </div>
      </div>
    `;
  }).join('');
  
  resultsEl.innerHTML = resultsHTML;
}

// Search input listener
document.getElementById('searchInput').addEventListener('input', performSearch);

// Filter tabs
document.querySelectorAll('.filter-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    currentFilter = tab.dataset.filter;
    performSearch();
  });
});

// Initialize
async function init() {
  allProfiles = await getAllProfiles();
  performSearch();
}

init();

window.addEventListener("load", function(){
  setTimeout(function(){
    const idsToHide = ['bubbleStack', 'bubble-top-single', 'carrieWrap', 'carrieBubble', 'carrieToggleBar'];
    idsToHide.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });
    
    const classesToHide = ['.bubble-stack', '.floating-bubbles', '.carrie-bubble', '.bubble-container'];
    classesToHide.forEach(cls => {
      document.querySelectorAll(cls).forEach(el => el.style.display = 'none');
    });
    
    document.querySelectorAll('[data-bubble]').forEach(el => el.style.display = 'none');
    document.querySelectorAll('[data-role="carrie"], [data-carrie]').forEach(el => el.style.display = 'none');
  }, 300);
});
</script>

</body>
</html>
 
