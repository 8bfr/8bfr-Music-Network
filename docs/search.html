<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Search ‚Äî 8BFR Music Network</title>
<link rel="icon" href="assets/images/favicon.png" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  * { box-sizing: border-box; }
  body {
    background: linear-gradient(#0b0014, #000);
    color: #eae6ff;
    font-family: system-ui, -apple-system, sans-serif;
    margin: 0;
    padding: 0;
  }
  
  .header {
    background: rgba(15, 0, 30, 0.95);
    border-bottom: 1px solid rgba(124, 58, 237, 0.5);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
  }
  
  .search-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  .search-box {
    position: relative;
    margin-bottom: 2rem;
  }
  
  .search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    background: rgba(18, 3, 39, 0.8);
    border: 1px solid rgba(124, 58, 237, 0.4);
    border-radius: 12px;
    color: #fff;
    font-size: 1rem;
    transition: all 0.2s;
  }
  
  .search-input:focus {
    outline: none;
    border-color: #a855f7;
    box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
  }
  
  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.2rem;
    color: #a855f7;
  }
  
  .filter-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }
  
  .filter-tab {
    padding: 0.6rem 1.2rem;
    background: rgba(124, 58, 237, 0.1);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 20px;
    color: #a855f7;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
  }
  
  .filter-tab:hover,
  .filter-tab.active {
    background: rgba(124, 58, 237, 0.3);
    border-color: #a855f7;
  }
  
  .result-card {
    background: rgba(12, 6, 24, 0.8);
    border: 1px solid rgba(124, 58, 237, 0.35);
    border-radius: 14px;
    padding: 1.25rem;
    margin-bottom: 1rem;
    transition: all 0.3s;
  }
  
  .result-card:hover {
    border-color: rgba(168, 85, 247, 0.6);
    box-shadow: 0 8px 32px rgba(124, 58, 237, 0.3);
  }
  
  .result-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  
  .result-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    flex-shrink: 0;
  }
  
  .result-info {
    flex: 1;
    min-width: 0;
  }
  
  .result-name {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }
  
  .verified-badge {
    color: #00d9ff;
    font-size: 1rem;
  }
  
  .result-badges {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
  }
  
  .badge {
    padding: 0.25rem 0.6rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
    background: rgba(124, 58, 237, 0.2);
    border: 1px solid rgba(124, 58, 237, 0.4);
    color: #a855f7;
  }
  
  .badge.founder {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
    border-color: rgba(245, 158, 11, 0.5);
    color: #f59e0b;
  }
  
  .result-bio {
    font-size: 0.9rem;
    color: #a855f7;
    opacity: 0.8;
    margin-bottom: 1rem;
    line-height: 1.5;
  }
  
  .result-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  
  .action-btn {
    padding: 0.6rem 1.25rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.85rem;
    text-decoration: none;
    display: inline-block;
  }
  
  .view-btn {
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    border: none;
    color: white;
  }
  
  .follow-btn {
    background: rgba(124, 58, 237, 0.2);
    border: 1px solid rgba(124, 58, 237, 0.5);
    color: #a855f7;
  }
  
  /* ADMIN BUTTONS */
  .admin-result-btn {
    display: none;
    padding: 0.6rem 1rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.8rem;
    border: 1px solid;
  }
  
  .feature-result-btn {
    background: rgba(245, 158, 11, 0.2);
    border-color: rgba(245, 158, 11, 0.5);
    color: #f59e0b;
  }
  
  .unfeature-result-btn {
    background: rgba(239, 68, 68, 0.2);
    border-color: rgba(239, 68, 68, 0.5);
    color: #ef4444;
  }
  
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #a855f7;
    opacity: 0.7;
  }
</style>
</head>
<body>

<header class="header">
  <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
    <a href="index.html" style="color: #a855f7; text-decoration: none; font-weight: 600;">‚Üê Home</a>
    <h1 style="font-size: 1.25rem; font-weight: 800;">üîç Search</h1>
    <div style="width: 80px;"></div>
  </div>
</header>

<main class="search-container">
  
  <div class="search-box">
    <span class="search-icon">üîç</span>
    <input 
      type="text" 
      class="search-input" 
      id="searchInput" 
      placeholder="Search artists, songs, beatmakers..."
      autocomplete="off"
    >
  </div>
  
  <div class="filter-tabs">
    <button class="filter-tab active" data-filter="all">All</button>
    <button class="filter-tab" data-filter="artists">Artists</button>
    <button class="filter-tab" data-filter="beatmakers">Beatmakers</button>
    <button class="filter-tab" data-filter="verified">Verified</button>
  </div>
  
  <div id="searchResults">
    <div class="empty-state">
      <div style="font-size: 4rem; margin-bottom: 1rem;">üîç</div>
      <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">
        Start searching
      </div>
      <div style="font-size: 0.9rem;">
        Find artists, beatmakers, and tracks
      </div>
    </div>
  </div>
  
</main>

<script src="scripts.js?v=6" defer></script>

<script>
const $ = (s) => document.querySelector(s);
const $$ = (s) => Array.from(document.querySelectorAll(s));

let currentFilter = 'all';

// ===== ADMIN SYSTEM =====
function isAdmin() {
  const role = localStorage.getItem('userRole');
  return role === 'owner' || role === 'admin' || role === 'mod';
}

function logAdminAction(action, targetId, targetType) {
  const logs = JSON.parse(localStorage.getItem('admin_activity_log') || '[]');
  
  logs.push({
    action: action,
    targetId: targetId,
    targetType: targetType,
    performedBy: localStorage.getItem('username') || 'Admin',
    role: localStorage.getItem('userRole'),
    timestamp: Date.now()
  });
  
  if (logs.length > 1000) logs.shift();
  localStorage.setItem('admin_activity_log', JSON.stringify(logs));
  
  const notifications = JSON.parse(localStorage.getItem('owner_notifications') || '[]');
  notifications.push({
    type: 'admin_action',
    action: action,
    targetId: targetId,
    targetType: targetType,
    performedBy: localStorage.getItem('username'),
    timestamp: Date.now(),
    read: false
  });
  localStorage.setItem('owner_notifications', JSON.stringify(notifications));
}

function isArtistFeatured(profileKey) {
  const featured = JSON.parse(localStorage.getItem('featured_items') || '{}');
  return featured.artists && featured.artists.includes(profileKey);
}

function featureArtistFromSearch(profileKey) {
  const featured = JSON.parse(localStorage.getItem('featured_items') || '{}');
  if (!featured.artists) featured.artists = [];
  
  if (featured.artists.includes(profileKey)) {
    alert('‚ö†Ô∏è This artist is already featured!');
    return;
  }
  
  featured.artists.push(profileKey);
  localStorage.setItem('featured_items', JSON.stringify(featured));
  
  logAdminAction('featured_add', profileKey, 'artist');
  
  alert('‚≠ê Artist added to featured!');
  performSearch();
}

function unfeatureArtistFromSearch(profileKey) {
  if (!confirm('Remove this artist from featured?')) return;
  
  const featured = JSON.parse(localStorage.getItem('featured_items') || '{}');
  if (!featured.artists) featured.artists = [];
  
  featured.artists = featured.artists.filter(key => key !== profileKey);
  localStorage.setItem('featured_items', JSON.stringify(featured));
  
  logAdminAction('featured_remove', profileKey, 'artist');
  
  alert('‚ùå Artist removed from featured');
  performSearch();
}

// ===== INITIALIZE DEMO PROFILES IF NONE EXIST =====
function initializeDemoProfiles() {
  const existingProfiles = Array.from({length: localStorage.length}, (_, i) => localStorage.key(i))
    .filter(key => key.startsWith('profile_'));
  
  if (existingProfiles.length > 0) return; // Already have profiles
  
  const profiles = [
    {
      key: 'profile_demo_artist_1',
      id: 'demo_artist_1',
      name: '8BFR',
      emoji: 'üé§',
      bio: 'Music artist, songwriter, and beatmaker. Building the future of music networking.',
      badges: ['artist', 'verified', 'founder'],
      verified: true,
      verification: {
        type: 'artist',
        link: 'https://open.spotify.com/artist/127tw52iDXr7BvgB0IGG2x',
        status: 'approved'
      },
      tracks: [
        { title: 'Killa Bees', url: 'https://open.spotify.com/track/2x1sJyFdgcRDh9zlGSqNsa' },
        { title: 'Purple Dreams', url: 'https://open.spotify.com/track/demo2' }
      ],
      followers: 1247,
      plays: 8934
    },
    {
      key: 'profile_demo_artist_2',
      id: 'demo_artist_2',
      name: 'Nova Rae',
      emoji: 'üé§',
      bio: 'Indie artist creating dreamy soundscapes.',
      badges: ['artist', 'verified'],
      verified: true,
      verification: {
        type: 'artist',
        link: 'https://music.apple.com/artist/novarae',
        status: 'approved'
      },
      tracks: [
        { title: 'Dream State', url: 'https://open.spotify.com/track/demo3' },
        { title: 'Midnight Vibes', url: 'https://open.spotify.com/track/demo4' }
      ],
      followers: 892,
      plays: 5621
    },
    {
      key: 'profile_demo_beatmaker_1',
      id: 'demo_beatmaker_1',
      name: 'K. Drip',
      emoji: 'üéöÔ∏è',
      bio: 'Producer crafting next-level beats.',
      badges: ['beatmaker', 'verified'],
      verified: true,
      verification: {
        type: 'beatmaker',
        link: 'https://soundcloud.com/kdrip',
        status: 'approved'
      },
      tracks: [
        { title: 'Vapor Loop', url: 'https://open.spotify.com/track/demo5' },
        { title: 'Neon Nights', url: 'https://open.spotify.com/track/demo6' }
      ],
      followers: 634,
      plays: 4329
    }
  ];
  
  profiles.forEach(profile => {
    const { key, ...profileData } = profile;
    localStorage.setItem(key, JSON.stringify(profileData));
  });
}

// ===== SEARCH SYSTEM =====
function getAllProfiles() {
  const profiles = [];
  
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (!key.startsWith('profile_')) continue;
    
    try {
      const profile = JSON.parse(localStorage.getItem(key) || '{}');
      if (profile.name) {
        profiles.push({
          key: key,
          id: key.replace('profile_', ''),
          ...profile
        });
      }
    } catch(e) {}
  }
  
  return profiles;
}

function performSearch() {
  const query = $('#searchInput').value.toLowerCase().trim();
  const profiles = getAllProfiles();
  
  let filtered = profiles;
  
  // Apply filter
  if (currentFilter === 'artists') {
    filtered = profiles.filter(p => p.badges && p.badges.includes('artist'));
  } else if (currentFilter === 'beatmakers') {
    filtered = profiles.filter(p => p.badges && p.badges.includes('beatmaker'));
  } else if (currentFilter === 'verified') {
    filtered = profiles.filter(p => p.verified === true);
  }
  
  // Apply search query
  if (query) {
    filtered = filtered.filter(p => {
      const nameMatch = p.name.toLowerCase().includes(query);
      const bioMatch = p.bio && p.bio.toLowerCase().includes(query);
      const tracksMatch = p.tracks && p.tracks.some(t => 
        t.title && t.title.toLowerCase().includes(query)
      );
      
      return nameMatch || bioMatch || tracksMatch;
    });
  }
  
  renderResults(filtered);
}

function renderResults(results) {
  const resultsEl = $('#searchResults');
  
  if (results.length === 0) {
    resultsEl.innerHTML = `
      <div class="empty-state">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üòî</div>
        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">
          No results found
        </div>
        <div style="font-size: 0.9rem;">
          Try a different search term or filter
        </div>
      </div>
    `;
    return;
  }
  
  const adminMode = isAdmin();
  
  const resultsHTML = results.map(profile => {
    const isFeatured = isArtistFeatured(profile.key);
    
    // Get badges HTML
    let badgesHTML = '';
    if (profile.badges && profile.badges.length > 0) {
      badgesHTML = profile.badges.map(badge => {
        const badgeClass = badge === 'founder' ? 'founder' : '';
        const badgeEmoji = {
          'artist': 'üé§',
          'beatmaker': 'üéöÔ∏è',
          'verified': '‚úì',
          'founder': 'üëë',
          'songwriter': '‚úçÔ∏è'
        }[badge] || '';
        
        return `<span class="badge ${badgeClass}">${badgeEmoji} ${badge.toUpperCase()}</span>`;
      }).join('');
    }
    
    return `
      <div class="result-card">
        <div class="result-header">
          <div class="result-avatar">${profile.emoji || 'üéµ'}</div>
          <div class="result-info">
            <div class="result-name">
              ${profile.name}
              ${profile.verified ? '<span class="verified-badge">‚úì</span>' : ''}
            </div>
            ${badgesHTML ? `<div class="result-badges">${badgesHTML}</div>` : ''}
          </div>
        </div>
        
        ${profile.bio ? `<div class="result-bio">${profile.bio}</div>` : ''}
        
        <div class="result-actions">
          <a href="profile.html?id=${profile.id}" class="action-btn view-btn">
            üë§ View Profile
          </a>
          <button class="action-btn follow-btn" onclick="alert('‚úÖ Following!')">
            Follow
          </button>
          
          <!-- ADMIN BUTTONS -->
          ${adminMode ? `
            <button 
              class="admin-result-btn feature-result-btn" 
              onclick="featureArtistFromSearch('${profile.key}')"
              style="display: ${isFeatured ? 'none' : 'inline-block'};"
            >
              ‚≠ê Feature
            </button>
            <button 
              class="admin-result-btn unfeature-result-btn" 
              onclick="unfeatureArtistFromSearch('${profile.key}')"
              style="display: ${isFeatured ? 'inline-block' : 'none'};"
            >
              ‚ùå Unfeature
            </button>
          ` : ''}
        </div>
      </div>
    `;
  }).join('');
  
  resultsEl.innerHTML = resultsHTML;
}

// Search input listener
$('#searchInput').addEventListener('input', performSearch);

// Filter tabs
$$('.filter-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    $$('.filter-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    currentFilter = tab.dataset.filter;
    performSearch();
  });
});

// Initialize demo profiles if none exist
initializeDemoProfiles();

// Initial load - show all profiles
performSearch();

window.addEventListener("load", function(){
  setTimeout(function(){
    const idsToHide = ['bubbleStack', 'bubble-top-single', 'carrieWrap', 'carrieBubble', 'carrieToggleBar'];
    idsToHide.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });
    
    const classesToHide = ['.bubble-stack', '.floating-bubbles', '.carrie-bubble', '.bubble-container'];
    classesToHide.forEach(cls => {
      document.querySelectorAll(cls).forEach(el => el.style.display = 'none');
    });
    
    document.querySelectorAll('[data-bubble]').forEach(el => el.style.display = 'none');
    document.querySelectorAll('[data-role="carrie"], [data-carrie]').forEach(el => el.style.display = 'none');
  }, 300);
});
</script>

</body>
</html>
