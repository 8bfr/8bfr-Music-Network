<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Community Feed ‚Äî 8BFR Music Network</title>
<link rel="icon" href="assets/images/favicon.png" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  * { box-sizing: border-box; }
  body {
    background: linear-gradient(#0b0014, #000);
    color: #eae6ff;
    font-family: system-ui, -apple-system, sans-serif;
    margin: 0;
    padding: 0;
  }
  
  /* Header */
  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(15, 0, 30, 0.95);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(124, 58, 237, 0.3);
  }
  
  /* Tab System */
  .tabs {
    display: flex;
    gap: 0;
    border-bottom: 1px solid rgba(124, 58, 237, 0.2);
  }
  
  .tab {
    flex: 1;
    padding: 1rem;
    background: transparent;
    border: none;
    color: #a855f7;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    position: relative;
    transition: all 0.2s;
  }
  
  .tab:hover {
    background: rgba(124, 58, 237, 0.1);
  }
  
  .tab.active {
    color: #fff;
  }
  
  .tab.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #7c3aed, #a855f7);
    border-radius: 3px 3px 0 0;
  }
  
  /* Feed Container */
  .feed-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 0;
  }
  
  /* Post Card */
  .post-card {
    background: rgba(15, 0, 30, 0.6);
    border-bottom: 8px solid rgba(124, 58, 237, 0.15);
    padding: 1rem;
    position: relative;
  }
  
  .post-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }
  
  .post-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1rem;
    color: white;
    flex-shrink: 0;
  }
  
  .post-user-info {
    flex: 1;
    min-width: 0;
  }
  
  .post-username {
    font-weight: 700;
    font-size: 0.95rem;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }
  
  .verified-badge {
    color: #00d9ff;
    font-size: 0.9rem;
  }
  
  .post-time {
    font-size: 0.8rem;
    color: #a855f7;
    opacity: 0.7;
  }
  
  .follow-btn {
    padding: 0.4rem 1rem;
    background: transparent;
    border: 1px solid #a855f7;
    color: #a855f7;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .follow-btn:hover {
    background: #a855f7;
    color: white;
  }
  
  .follow-btn.following {
    background: #a855f7;
    color: white;
    border-color: #a855f7;
  }
  
  /* Post Content */
  .post-text {
    margin-bottom: 0.75rem;
    line-height: 1.5;
    font-size: 0.95rem;
    color: #eae6ff;
  }
  
  .post-media {
    margin-bottom: 0.75rem;
    border-radius: 12px;
    overflow: hidden;
    background: #000;
  }
  
  .post-media img,
  .post-media video {
    width: 100%;
    display: block;
    max-height: 500px;
    object-fit: contain;
  }
  
  /* Interaction Bar */
  .interaction-bar {
    display: flex;
    justify-content: space-between;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(124, 58, 237, 0.2);
  }
  
  .interaction-btn {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: transparent;
    border: none;
    color: #a855f7;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
  }
  
  .interaction-btn:hover {
    background: rgba(124, 58, 237, 0.2);
  }
  
  .interaction-btn.active {
    color: #00d9ff;
  }
  
  .interaction-btn.liked {
    color: #ef4444;
  }
  
  .interaction-count {
    font-weight: 600;
    font-size: 0.9rem;
  }
  
  /* Action Buttons Row */
  .action-row {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(124, 58, 237, 0.15);
  }
  
  .action-btn {
    flex: 1;
    padding: 0.6rem;
    background: rgba(124, 58, 237, 0.15);
    border: 1px solid rgba(124, 58, 237, 0.3);
    color: #a855f7;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.3rem;
  }
  
  .action-btn:hover {
    background: rgba(124, 58, 237, 0.3);
    border-color: rgba(124, 58, 237, 0.5);
  }
  
  .action-btn.active {
    background: rgba(0, 217, 255, 0.2);
    border-color: rgba(0, 217, 255, 0.4);
    color: #00d9ff;
  }
  
  /* Comments Section */
  .comments-section {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(124, 58, 237, 0.15);
    display: none;
  }
  
  .comments-section.open {
    display: block;
  }
  
  .comment {
    padding: 0.75rem;
    background: rgba(124, 58, 237, 0.05);
    border-radius: 8px;
    margin-bottom: 0.5rem;
  }
  
  .comment-header {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    margin-bottom: 0.4rem;
  }
  
  .comment-avatar {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 700;
  }
  
  .comment-username {
    font-weight: 600;
    font-size: 0.85rem;
  }
  
  .comment-time {
    font-size: 0.75rem;
    color: #a855f7;
    opacity: 0.6;
  }
  
  .comment-text {
    font-size: 0.9rem;
    line-height: 1.4;
    padding-left: 36px;
  }
  
  .comment-input-box {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
  }
  
  .comment-input {
    flex: 1;
    padding: 0.6rem;
    background: rgba(15, 0, 30, 0.8);
    border: 1px solid rgba(124, 58, 237, 0.4);
    border-radius: 8px;
    color: white;
    font-size: 0.9rem;
  }
  
  .comment-input:focus {
    outline: none;
    border-color: #a855f7;
  }
  
  .comment-submit {
    padding: 0.6rem 1.2rem;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    border: none;
    color: white;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
  }
  
  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #a855f7;
    opacity: 0.7;
  }
  
  .empty-state-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }
  
  /* Mobile Responsive */
  @media (max-width: 640px) {
    .post-card {
      padding: 0.75rem;
    }
    
    .interaction-bar {
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    
    .interaction-btn {
      padding: 0.4rem 0.5rem;
      font-size: 0.8rem;
    }
    
    .action-row {
      flex-wrap: wrap;
    }
    
    .action-btn {
      font-size: 0.75rem;
      padding: 0.5rem;
    }
  }
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" style="padding: 0.5rem 1rem; background: rgba(124, 58, 237, 0.2); border: 1px solid rgba(124, 58, 237, 0.4); color: #a855f7; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem;">‚Üê Home</a>
    <h1 style="font-size: 1.25rem; font-weight: 800; background: linear-gradient(135deg, #a855f7, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">8BFR Feed</h1>
    <div style="width: 80px;"></div>
  </div>
  
  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="foryou" onclick="switchTab('foryou')">
      üî• For You
    </button>
    <button class="tab" data-tab="friends" onclick="switchTab('friends')">
      üë• Friends
    </button>
  </div>
</header>

<!-- Feed Container -->
<main class="feed-container">
  <div id="feed">
    <!-- Posts will be rendered here -->
  </div>
</main>

<script>
// ===== DATA STORAGE =====
const POSTS_KEY = 'feed_posts_v2';
const INTERACTIONS_KEY = 'feed_interactions_v2';
const USER_KEY = 'currentUser_v1'; // From your auth system

// Mock current user (replace with your actual auth)
const currentUser = {
  id: 'user_001',
  username: localStorage.getItem(USER_KEY) || 'You',
  avatar: 'üòé',
  verified: true
};

// ===== UTILITY FUNCTIONS =====
const $ = (s) => document.querySelector(s);
const $$ = (s) => Array.from(document.querySelectorAll(s));

function getPosts() {
  return JSON.parse(localStorage.getItem(POSTS_KEY) || '[]');
}

function savePosts(posts) {
  localStorage.setItem(POSTS_KEY, JSON.stringify(posts));
}

function getInteractions() {
  return JSON.parse(localStorage.getItem(INTERACTIONS_KEY) || '{}');
}

function saveInteractions(interactions) {
  localStorage.setItem(INTERACTIONS_KEY, JSON.stringify(interactions));
}

// ===== MOCK DATA (Replace with real data from user profiles) =====
function initializeMockData() {
  const existing = getPosts();
  if (existing.length > 0) return; // Already have data
  
  const mockPosts = [
    {
      id: 'post_001',
      userId: 'user_beatmaker1',
      username: 'BeatMaster808',
      avatar: 'üéß',
      verified: true,
      text: 'Just dropped a new beat! üî• What y\'all think?',
      media: null,
      mediaType: null,
      timestamp: Date.now() - 3600000,
      algorithmScore: 95,
      isFriend: true
    },
    {
      id: 'post_002',
      userId: 'user_singer1',
      username: 'VocalQueen',
      avatar: 'üé§',
      verified: true,
      text: 'Recording session vibes ‚ú®',
      media: 'https://via.placeholder.com/600x400/7c3aed/ffffff?text=Studio+Session',
      mediaType: 'image',
      timestamp: Date.now() - 7200000,
      algorithmScore: 88,
      isFriend: false
    },
    {
      id: 'post_003',
      userId: 'user_producer1',
      username: 'ProducerLife',
      avatar: 'üéπ',
      verified: false,
      text: 'New track coming soon! Who wants to collab?',
      media: null,
      mediaType: null,
      timestamp: Date.now() - 10800000,
      algorithmScore: 92,
      isFriend: true
    },
    {
      id: 'post_004',
      userId: 'user_rapper1',
      username: 'MCFlow',
      avatar: 'üéôÔ∏è',
      verified: true,
      text: 'Freestyle Friday! Drop your bars in the comments üî•',
      media: 'https://via.placeholder.com/600x800/a855f7/ffffff?text=Freestyle+Video',
      mediaType: 'video',
      timestamp: Date.now() - 14400000,
      algorithmScore: 97,
      isFriend: false
    },
    {
      id: 'post_005',
      userId: 'user_dj1',
      username: 'DJSpinMaster',
      avatar: 'üíø',
      verified: true,
      text: 'Live set tonight at 9PM! See you there üéâ',
      media: 'https://via.placeholder.com/600x400/00d9ff/ffffff?text=Live+DJ+Set',
      mediaType: 'image',
      timestamp: Date.now() - 18000000,
      algorithmScore: 85,
      isFriend: true
    }
  ];
  
  savePosts(mockPosts);
}

// ===== TAB SWITCHING =====
let currentTab = 'foryou';

function switchTab(tab) {
  currentTab = tab;
  
  // Update tab UI
  $$('.tab').forEach(t => t.classList.remove('active'));
  $(`.tab[data-tab="${tab}"]`).classList.add('active');
  
  // Re-render feed
  renderFeed();
}

// ===== FEED RENDERING =====
function renderFeed() {
  const posts = getPosts();
  const interactions = getInteractions();
  
  // Filter based on tab
  let filteredPosts = posts;
  if (currentTab === 'friends') {
    filteredPosts = posts.filter(p => p.isFriend);
  }
  
  // Sort by algorithm score (higher first)
  filteredPosts.sort((a, b) => b.algorithmScore - a.algorithmScore);
  
  const feedEl = $('#feed');
  
  if (filteredPosts.length === 0) {
    feedEl.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">${currentTab === 'friends' ? 'üë•' : 'üîç'}</div>
        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">
          ${currentTab === 'friends' ? 'No posts from friends yet' : 'No posts yet'}
        </div>
        <div style="font-size: 0.9rem;">
          ${currentTab === 'friends' ? 'Follow some artists to see their posts here!' : 'Check back soon for new content!'}
        </div>
      </div>
    `;
    return;
  }
  
  feedEl.innerHTML = filteredPosts.map(post => {
    const postInteractions = interactions[post.id] || {
      liked: false,
      favorited: false,
      reposted: false,
      following: false,
      likes: Math.floor(Math.random() * 500),
      comments: [],
      reposts: Math.floor(Math.random() * 50),
      favorites: Math.floor(Math.random() * 100)
    };
    
    return `
      <div class="post-card" data-post-id="${post.id}">
        <!-- Post Header -->
        <div class="post-header">
          <div class="post-avatar">${post.avatar}</div>
          <div class="post-user-info">
            <div class="post-username">
              ${post.username}
              ${post.verified ? '<span class="verified-badge">‚úì</span>' : ''}
            </div>
            <div class="post-time">${timeAgo(post.timestamp)}</div>
          </div>
          ${post.userId !== currentUser.id ? `
            <button class="follow-btn ${postInteractions.following ? 'following' : ''}" onclick="toggleFollow('${post.id}')">
              ${postInteractions.following ? 'Following' : 'Follow'}
            </button>
          ` : ''}
        </div>
        
        <!-- Post Content -->
        ${post.text ? `<div class="post-text">${post.text}</div>` : ''}
        
        ${post.media ? `
          <div class="post-media">
            ${post.mediaType === 'video' 
              ? `<video controls><source src="${post.media}" type="video/mp4"></video>`
              : `<img src="${post.media}" alt="Post media">`
            }
          </div>
        ` : ''}
        
        <!-- Interaction Bar -->
        <div class="interaction-bar">
          <button class="interaction-btn ${postInteractions.liked ? 'liked' : ''}" onclick="toggleLike('${post.id}')">
            ${postInteractions.liked ? '‚ù§Ô∏è' : 'ü§ç'}
            <span class="interaction-count">${postInteractions.likes}</span>
          </button>
          
          <button class="interaction-btn" onclick="toggleComments('${post.id}')">
            üí¨
            <span class="interaction-count">${postInteractions.comments.length}</span>
          </button>
          
          <button class="interaction-btn ${postInteractions.reposted ? 'active' : ''}" onclick="toggleRepost('${post.id}')">
            üîÅ
            <span class="interaction-count">${postInteractions.reposts}</span>
          </button>
          
          <button class="interaction-btn" onclick="sharePost('${post.id}')">
            üì§
          </button>
        </div>
        
        <!-- Action Row -->
        <div class="action-row">
          <button class="action-btn ${postInteractions.favorited ? 'active' : ''}" onclick="toggleFavorite('${post.id}')">
            ${postInteractions.favorited ? '‚≠ê' : '‚òÜ'} Favorite
          </button>
          <button class="action-btn" onclick="addToStory('${post.id}')">
            üì∏ Story
          </button>
        </div>
        
        <!-- Comments Section -->
        <div class="comments-section" id="comments-${post.id}">
          <div id="comments-list-${post.id}">
            ${renderComments(postInteractions.comments)}
          </div>
          <div class="comment-input-box">
            <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Add a comment...">
            <button class="comment-submit" onclick="addComment('${post.id}')">Post</button>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

function renderComments(comments) {
  if (!comments || comments.length === 0) {
    return '<div style="text-align: center; padding: 1rem; color: #a855f7; opacity: 0.6; font-size: 0.85rem;">No comments yet</div>';
  }
  
  return comments.map(comment => `
    <div class="comment">
      <div class="comment-header">
        <div class="comment-avatar">${comment.avatar}</div>
        <div class="comment-username">${comment.username}</div>
        <div class="comment-time" style="margin-left: auto;">${timeAgo(comment.timestamp)}</div>
      </div>
      <div class="comment-text">${comment.text}</div>
    </div>
  `).join('');
}

// ===== INTERACTION FUNCTIONS =====
function toggleLike(postId) {
  const interactions = getInteractions();
  if (!interactions[postId]) {
    interactions[postId] = { liked: false, likes: 0, comments: [], reposts: 0, favorites: 0 };
  }
  
  interactions[postId].liked = !interactions[postId].liked;
  interactions[postId].likes += interactions[postId].liked ? 1 : -1;
  
  saveInteractions(interactions);
  renderFeed();
}

function toggleComments(postId) {
  const commentsSection = $(`#comments-${postId}`);
  commentsSection.classList.toggle('open');
}

function addComment(postId) {
  const input = $(`#comment-input-${postId}`);
  const text = input.value.trim();
  if (!text) return;
  
  const interactions = getInteractions();
  if (!interactions[postId]) {
    interactions[postId] = { liked: false, likes: 0, comments: [], reposts: 0, favorites: 0 };
  }
  
  interactions[postId].comments.push({
    username: currentUser.username,
    avatar: currentUser.avatar,
    text: text,
    timestamp: Date.now()
  });
  
  saveInteractions(interactions);
  input.value = '';
  renderFeed();
  
  // Re-open comments
  setTimeout(() => {
    $(`#comments-${postId}`).classList.add('open');
  }, 100);
}

function toggleRepost(postId) {
  const interactions = getInteractions();
  if (!interactions[postId]) {
    interactions[postId] = { liked: false, likes: 0, comments: [], reposts: 0, favorites: 0, reposted: false };
  }
  
  interactions[postId].reposted = !interactions[postId].reposted;
  interactions[postId].reposts += interactions[postId].reposted ? 1 : -1;
  
  saveInteractions(interactions);
  renderFeed();
  
  if (interactions[postId].reposted) {
    showNotification('‚úÖ Reposted to your profile!');
  }
}

function toggleFavorite(postId) {
  const interactions = getInteractions();
  if (!interactions[postId]) {
    interactions[postId] = { liked: false, likes: 0, comments: [], reposts: 0, favorites: 0, favorited: false };
  }
  
  interactions[postId].favorited = !interactions[postId].favorited;
  interactions[postId].favorites += interactions[postId].favorited ? 1 : -1;
  
  saveInteractions(interactions);
  renderFeed();
  
  if (interactions[postId].favorited) {
    showNotification('‚≠ê Added to favorites!');
  }
}

function toggleFollow(postId) {
  const interactions = getInteractions();
  if (!interactions[postId]) {
    interactions[postId] = { liked: false, likes: 0, comments: [], reposts: 0, favorites: 0, following: false };
  }
  
  interactions[postId].following = !interactions[postId].following;
  
  saveInteractions(interactions);
  renderFeed();
  
  if (interactions[postId].following) {
    showNotification('‚úÖ Now following!');
  }
}

function sharePost(postId) {
  showNotification('üì§ Share link copied!');
  // In real app: copy share link to clipboard
}

function addToStory(postId) {
  showNotification('üì∏ Added to your story!');
  // In real app: add to user's story
}

// ===== UTILITY FUNCTIONS =====
function timeAgo(timestamp) {
  const seconds = Math.floor((Date.now() - timestamp) / 1000);
  
  if (seconds < 60) return 'Just now';
  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
  if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
  if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
  return new Date(timestamp).toLocaleDateString();
}

function showNotification(message) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(124, 58, 237, 0.4);
    animation: slideDown 0.3s ease;
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideUp 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 2000);
}

// Add animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideDown {
    from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
    to { transform: translateX(-50%) translateY(0); opacity: 1; }
  }
  @keyframes slideUp {
    from { transform: translateX(-50%) translateY(0); opacity: 1; }
    to { transform: translateX(-50%) translateY(-20px); opacity: 0; }
  }
`;
document.head.appendChild(style);

// ===== INITIALIZATION =====
initializeMockData();
renderFeed();

// ===== HIDE FLOATING BUBBLES & AVATAR (Keep only hamburger, footer, back-to-top) =====
window.addEventListener("load", function(){
  setTimeout(function(){
    // Hide these IDs
    const idsToHide = ['bubbleStack', 'bubble-top-single', 'carrieWrap', 'carrieBubble', 'carrieToggleBar'];
    idsToHide.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });
    
    // Hide these classes (floating bubbles, avatar, etc)
    const classesToHide = ['.bubble-stack', '.floating-bubbles', '.carrie-bubble', '.bubble-container'];
    classesToHide.forEach(cls => {
      document.querySelectorAll(cls).forEach(el => el.style.display = 'none');
    });
    
    // Hide any element with data-bubble or data-carrie attribute
    document.querySelectorAll('[data-bubble]').forEach(el => el.style.display = 'none');
    document.querySelectorAll('[data-role="carrie"], [data-carrie]').forEach(el => el.style.display = 'none');
    
    // KEEP: hamburger menu, footer, back-to-top bubble
    // (These don't have the above IDs/classes/attributes, so they'll stay visible)
  }, 300);
});
</script>

<script src="scripts.js?v=6" defer></script>
</body>
</html>
