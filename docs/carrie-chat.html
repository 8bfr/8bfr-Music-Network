<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat with Carrie ‚Äî 8BFR Music Network</title>
  <meta name="description" content="Chat with Carrie ‚Äî your AI assistant on the 8BFR Music Network." />
  <link rel="icon" href="assets/images/favicon.png" />
  
  <!-- Load Closet Data First -->
  <script src="carrie-closet-data.js?v=3"></script>
  <script src="carrie-memory.js?v=2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Supabase Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Link to external closet CSS -->
  <link rel="stylesheet" href="carrie-closet.css?v=3" />

  <style>
    :root {
      --ring: rgba(124,58,237,.55);
      --glass: rgba(12,6,24,.80);
    }
  
    html, body { scroll-behavior:smooth; }
  
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.30), transparent 60%),
        radial-gradient(900px 400px at 110% 10%, rgba(0,217,255,.22), transparent 60%),
        linear-gradient(#050011,#000);
      color:#eae6ff;
      margin:0;
      min-height:100vh;
      overflow-x:hidden;
    }
  
    header {
      position:relative;
      z-index:5;
      background:rgba(10,0,25,.96);
      border-bottom:1px solid rgba(124,58,237,.5);
      box-shadow:0 18px 40px rgba(0,0,0,.7);
    }
  
    .shell {
      border-radius:20px;
      border:1px solid rgba(129,140,248,.6);
      background:
        radial-gradient(circle at 0 0,rgba(76,29,149,.40),transparent 60%),
        radial-gradient(circle at 100% 0,rgba(14,165,233,.22),transparent 60%),
        rgba(10,6,30,.96);
      box-shadow:0 18px 50px rgba(0,0,0,.8);
    }
  
    #closetPreviewFrame {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      border-radius: 18px;
      border: 1px solid rgba(148,163,255,0.55);
      overflow: hidden;
      height: 800px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-image: url("assets/images/closet/dressingroom.png?v=15");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
    }
  
    #closetPreviewInner {
      position: relative;
      width: 100%;
      max-width: 480px;
      height: 100%;
      transform: translateY(30px);
    }
  
    #closetBaseImg {
      position: absolute;
      inset: 0;
      height: 100%;
      width: auto;
      object-fit: cover;
      display: block;
      z-index: 1;
      left: 50%;
      transform: translateX(-50%);
      filter: drop-shadow(0 0 3px #000);
    }

    body[data-gender="female"][data-skin="light"]{
      --base-width: .89;
      --base-height: .99;
    }

    body[data-gender="female"][data-skin="dark"]{
      --base-width: .63;
      --base-height: .96;
    }

    body[data-gender="male"][data-skin="light"]{
      --base-width: 1.00;
      --base-height: 1.00;
    }

    body[data-gender="male"][data-skin="dark"]{
      --base-width: 0.96;
      --base-height: 1.00;
    }

    body[data-skin] #closetBaseImg{
      transform: translateX(-50%) scaleX(var(--base-width, 1)) scaleY(var(--base-height, 1));
    }
  
    #closetOverlayHost img {
      filter: drop-shadow(0 0 2px #000);
    }
  
    #closetOverlayHost {
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:2;
    }
  
    .layer-overlay {
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:contain;
      pointer-events:none;
      image-rendering:auto;
      --scale: 1;
      --offset-x: 0%;
      --offset-y: 0%;
      --rotate: 0deg;
      --scale-light: var(--scale);
      --offset-x-light: var(--offset-x);
      --offset-y-light: var(--offset-y);
      --rotate-light: var(--rotate);
      --scale-dark: var(--scale);
      --offset-x-dark: var(--offset-x);
      --offset-y-dark: var(--offset-y);
      --rotate-dark: var(--rotate);
      --scale-use: var(--scale);
      --offset-x-use: var(--offset-x);
      --offset-y-use: var(--offset-y);
      --rotate-use: var(--rotate);
      transform: scale(var(--scale-use)) translateX(var(--offset-x-use)) translateY(var(--offset-y-use)) rotate(var(--rotate-use));
    }

    body[data-skin="light"] .layer-overlay{
      --scale-use: var(--scale-light);
      --offset-x-use: var(--offset-x-light);
      --offset-y-use: var(--offset-y-light);
      --rotate-use: var(--rotate-light);
    }

    body[data-skin="dark"] .layer-overlay{
      --scale-use: var(--scale-dark);
      --offset-x-use: var(--offset-x-dark);
      --offset-y-use: var(--offset-y-dark);
      --rotate-use: var(--rotate-dark);
    }
  
    .pill-tag {
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      font-size:.7rem;
      border-radius:999px;
      padding:.15rem .6rem;
      border:1px solid rgba(129,140,248,.85);
      background:rgba(15,23,42,.9);
      text-transform:uppercase;
      letter-spacing:.08em;
    }
  
    .pill-tag-soft {
      border-color:rgba(147,197,253,.55);
      background:rgba(15,23,42,.85);
    }
  
    .seg-btn {
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,255,.45);
      background:rgba(15,23,42,.85);
      cursor:pointer;
      color:#e5e7eb;
      transition:all .12s ease;
    }
  
    .seg-btn.active {
      border-color:#a855f7;
      background:linear-gradient(135deg,#7c3aed,#a855f7);
      color:#fff;
      box-shadow:0 0 0 1px rgba(129,140,248,.7),0 0 16px rgba(168,85,247,.65);
    }
  
    .seg-btn:hover {
      background:rgba(30,64,175,.85);
    }
  
    .tab-btn {
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,255,.35);
      background:rgba(15,23,42,.8);
      cursor:pointer;
      color:#e5e7eb;
      transition:all .12s ease;
      white-space:nowrap;
    }
  
    .tab-btn.active {
      border-color:#38bdf8;
      background:radial-gradient(circle at 0 0,#38bdf8,#6366f1);
      color:#0f172a;
    }
  
    .closet-item-card {
      border-radius:12px;
      border:1px solid rgba(148,163,255,.4);
      background:rgba(15,23,42,.96);
      padding:.45rem .55rem;
      text-align:left;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease, border-color .08s ease, background .08s ease;
      display:flex;
      gap:.45rem;
      align-items:center;
    }
  
    .closet-item-card:hover {
      transform:translateY(-1px);
      border-color:#a855f7;
      box-shadow:0 0 0 1px rgba(129,140,248,.85),0 0 18px rgba(124,58,237,.55);
      background:rgba(30,64,175,.85);
    }
  
    .closet-item-card.active {
      border-color:#22c55e;
      box-shadow:0 0 0 1px rgba(22,163,74,.8),0 0 18px rgba(22,163,74,.7);
      background:rgba(5,46,22,.92);
    }
  
    .closet-item-thumb {
      width:44px;
      height:44px;
      border-radius:10px;
      border:1px solid rgba(148,163,255,.4);
      background:#020617;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex-shrink:0;
    }
  
    .closet-item-thumb img {
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
  
    #closetError {
      border-radius:999px;
      border:1px solid rgba(248,113,113,.8);
      background:rgba(127,29,29,.90);
      padding:.4rem .75rem;
      font-size:11px;
    }
  
    #closetEmpty {
      border-radius:999px;
      border:1px dashed rgba(148,163,255,.5);
      background:rgba(15,23,42,.86);
      padding:.4rem .75rem;
      font-size:11px;
    }
  
    #bubbleStack,
    #bubble-top-single,
    #carrieWrap,
    #globalAvatarSwitch {
      display:none !important;
    }
  
    #carrieToggleBar,
    .carrie-toggle-bar,
    #carrieModeButtons {
      display:none !important;
    }
  
    /* ========== MOBILE RESPONSIVE IMPROVEMENTS ========== */
    @media (max-width:768px){
      .shell { 
        border-radius:16px; 
        padding: 1rem !important;
      }
      
      #closetPreviewFrame {
        max-width:100%;
        height: 650px;
        padding:10px 0;
        background-size: cover;
        background-position: center;
      }
      
      #closetPreviewInner {
        max-width:360px;
        height:100%;
      }
      
      /* Make buttons stack nicely on mobile */
      .seg-btn {
        font-size: 0.65rem !important;
        padding: 0.35rem 0.5rem !important;
      }
      
      /* Chat controls grid - smaller on mobile */
      .chat-controls-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
        gap: 0.4rem !important;
      }
      
      /* Avatar controls - full width buttons on mobile */
      .avatar-controls-box {
        padding: 0.75rem !important;
      }
      
      /* Category tabs - smaller on mobile */
      .tab-btn {
        font-size: 0.7rem !important;
        padding: 0.4rem 0.6rem !important;
      }
      
      /* Items grid - fewer columns on mobile */
      .mini-items-grid {
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)) !important;
        gap: 0.4rem !important;
      }
      
      /* Chat log - more compact */
      .chat-log {
        max-height: 400px !important;
      }
    }
    
    /* Extra small phones */
    @media (max-width:480px){
      .seg-btn {
        font-size: 0.6rem !important;
        padding: 0.3rem 0.4rem !important;
      }
      
      /* Mode buttons - full width on tiny screens */
      .mode-buttons-container {
        flex-direction: column !important;
      }
      
      /* Chat controls - 2 columns max on tiny screens */
      .chat-controls-grid {
        grid-template-columns: 1fr 1fr !important;
      }
      
      .mini-items-grid {
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)) !important;
      }
    }

    /* ========== FEMALE HAIR ‚Äì STRAIGHT ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_blonde{
      transform-origin:center top; --scale:0.50; --offset-x:0%; --offset-y:-12%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_blonde{
      transform-origin:center top; --scale:0.50; --offset-x:0%; --offset-y:-12%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_brown{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_brown{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_copper{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-22%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_copper{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-22%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-21%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-21%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

    /* ========== FEMALE HAIR ‚Äì WAVY ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_blonde{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_blonde{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_brown{
      transform-origin:center top; --scale:0.99; --offset-x:1%; --offset-y:-36%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_brown{
      transform-origin:center top; --scale:0.99; --offset-x:1%; --offset-y:-36%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_copper{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_copper{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-21%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-21%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

   /* STRAIGHT BLACK HAIR */
body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_black{
  transform-origin:center top; --scale:0.46; --offset-x:0%; --offset-y:-15%;
}
body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_black{
  transform-origin:center top; --scale:0.38; --offset-x:0%; --offset-y:-15%;
}

    /* ========== TOPS ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.75; --offset-x:0%; --offset-y:-12%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.65; --offset-x:0%; --offset-y:-6%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.67; --offset-x:-1%; --offset-y:0%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:4.8%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_top_bikini_red{
      transform-origin:center top; --scale:0.37; --offset-x:-1%; --offset-y:38%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_top_bikini_red{
      transform-origin:center top; --scale:0.35; --offset-x:0%; --offset-y:41%;
    }

    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.85; --offset-x:0%; --offset-y:-15%;
    }
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.85; --offset-x:0%; --offset-y:-15%;
    }

    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.90; --offset-x:0%; --offset-y:-7%;
    }
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.90; --offset-x:0%; --offset-y:-7%;
    }

    /* ========== BOTTOMS ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_bottom_shorts{
      transform-origin:center top; --scale:.58; --offset-x:-1%; --offset-y:44%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_bottom_shorts{
      transform-origin:center top; --scale:.48; --offset-x:-0%; --offset-y:56%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_bottom_skirt{
      transform-origin:center top; --scale:.60; --offset-x:-0%; --offset-y:30%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_bottom_skirt{
      transform-origin:center top; --scale:.55; --offset-x:-0%; --offset-y:36%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_bottom_bikini_red{
      transform-origin:center top; --scale:.83; --offset-x:-1%; --offset-y:10%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_bottom_bikini_red{
      transform-origin:center top; --scale:.75; --offset-x:-0%; --offset-y:16%;
    }

    /* ========== JEWELRY ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_necklace{
      transform-origin:center top; --scale:.35; --offset-x:0%; --offset-y:07%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_necklace{
      transform-origin:center top; --scale:.35; --offset-x:0%; --offset-y:09%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_belly{
      transform-origin:center top; --scale:.15; --offset-x:0%; --offset-y:250%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_belly{
      transform-origin:center top; --scale:.15; --offset-x:0%; --offset-y:250%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_ears.layer-left{
      transform-origin:center top; --scale:0.20; --offset-x: -46%; --offset-y: 29%;
    }
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_ears.layer-right{
      transform-origin:center top; --scale:0.20; --offset-x: 46%; --offset-y: 29%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_ears.layer-left{
      transform-origin:center top; --scale:0.20; --offset-x:-46%; --offset-y:32%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_ears.layer-right{
      transform-origin:center top; --scale:0.20; --offset-x:46%; --offset-y:32%;
    }

    body[data-gender="male"][data-skin="light"] .layer-overlay.item-m_jewel_necklace{
      transform-origin:center top; --scale:1; --offset-x:0%; --offset-y:0%;
    }
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-m_jewel_necklace{
      transform-origin:center top; --scale:1; --offset-x:0%; --offset-y:0%;
    }

    
    /* FEMALE LIGHT - LEFT SHOE */
body[data-gender="female"][data-skin="light"] .layer-overlay.layer-shoes-left {
  transform-origin: center center;
  --scale-light: 0.36;
  --offset-x-light: -18%;
  --offset-y-light: 120%;
  --rotate-light: 0deg;
}

/* FEMALE LIGHT - RIGHT SHOE */
body[data-gender="female"][data-skin="light"] .layer-overlay.layer-shoes-right {
  transform-origin: center center;
  --scale-light: 0.36;
  --offset-x-light: 13%;
  --offset-y-light: 120%;
  --rotate-light: 0deg;
}

/* FEMALE DARK - LEFT SHOE */
body[data-gender="female"][data-skin="dark"] .layer-overlay.layer-shoes-left {
  transform-origin: center center;
  --scale-dark: 0.34;
  --offset-x-dark: -20%;
  --offset-y-dark: 122%;
  --rotate-dark: 0deg;
}

/* FEMALE DARK - RIGHT SHOE */
body[data-gender="female"][data-skin="dark"] .layer-overlay.layer-shoes-right {
  transform-origin: center center;
  --scale-dark: 0.34;
  --offset-x-dark: 15%;
  --offset-y-dark: 122%;
  --rotate-dark: 0deg;
}

    /* MALE LIGHT - LEFT SHOE */
    body[data-gender="male"][data-skin="light"] .layer-overlay.layer-shoes-left {
      transform-origin: center center;
      --scale-light: 0.52;
      --offset-x-light: -25%;
      --offset-y-light: 86%;
      --rotate-light: 0deg;
    }

    /* MALE LIGHT - RIGHT SHOE */
    body[data-gender="male"][data-skin="light"] .layer-overlay.layer-shoes-right {
      transform-origin: center center;
      --scale-light: 0.52;
      --offset-x-light: 22%;
      --offset-y-light: 86%;
      --rotate-light: 0deg;
    }

    /* MALE DARK - LEFT SHOE */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.layer-shoes-left {
      transform-origin: center center;
      --scale-dark: 0.52;
      --offset-x-dark: -25%;
      --offset-y-dark: 86%;
      --rotate-dark: 0deg;
    }

    /* MALE DARK - RIGHT SHOE */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.layer-shoes-right {
      transform-origin: center center;
      --scale-dark: 0.52;
      --offset-x-dark: 25%;
      --offset-y-dark: 86%;
      --rotate-dark: 0deg;
    }
    /*EYES*/
    /* ========== EYES ========== */
    /* FEMALE LIGHT - LEFT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: -375%;
      --offset-y-light: 1018%;
    }

    /* FEMALE LIGHT - RIGHT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: 323%;
      --offset-y-light: 1020%;
    }

    /* FEMALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -265%;
      --offset-y-dark: 1108%;
    }

    /* FEMALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 383%;
      --offset-y-dark: 1108%;
    }

    /* MALE LIGHT - LEFT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: -405%;
      --offset-y-light: 968%;
    }

    /* MALE LIGHT - RIGHT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: 393%;
      --offset-y-light: 970%;
    }

    /* MALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -295%;
      --offset-y-dark: 978%;
    }

    /* MALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 523%;
      --offset-y-dark: 978%;
    }

    /* FEMALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -265%;
      --offset-y-dark: 1108%;
    }

    /* FEMALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 383%;
      --offset-y-dark: 1108%;
    }

 /* MALE LIGHT - LEFT EYE (ADJUSTED) */
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-left,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-left,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-left {
  transform-origin: center top;
  --scale-light: 0.01;
  --offset-x-light: -405%;
  --offset-y-light: 968%;
}

/* MALE LIGHT - RIGHT EYE (ADJUSTED) */
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-right,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-right,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-right {
  transform-origin: center top;
  --scale-light: 0.01;
  --offset-x-light: 393%;
  --offset-y-light: 970%;
}

    /* MALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -295%;
      --offset-y-dark: 978%;
    }

    /* MALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 523%;
      --offset-y-dark: 978%;
    }

    /* ITEM THUMBNAILS */
    .mini-items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .mini-item {
      border-radius: 8px;
      border: 1px solid rgba(148,163,255,.4);
      background: rgba(15,23,42,.96);
      padding: 0.4rem;
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: center;
    }

    .mini-item:hover {
      transform: translateY(-2px);
      border-color: #a855f7;
      box-shadow: 0 0 0 1px rgba(129,140,248,.85), 0 0 18px rgba(124,58,237,.55);
      background: rgba(30,64,175,.85);
    }

    .mini-item.active {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(22,163,74,.8), 0 0 18px rgba(22,163,74,.7);
      background: rgba(5,46,22,.92);
    }

    .mini-item.cant-afford {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .mini-item-img {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      border-radius: 6px;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 0.3rem;
    }

    .mini-item-img img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .mini-item-name {
      font-size: 0.7rem;
      color: #e5e7eb;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .item-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      font-size: 0.55rem;
      padding: 0.1rem 0.3rem;
      border-radius: 4px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-active {
      background: rgba(22,163,74,.9);
      color: white;
      border: 1px solid rgba(22,163,74,1);
    }

    .badge-owned {
      background: rgba(59,130,246,.9);
      color: white;
      border: 1px solid rgba(59,130,246,1);
    }

    .badge-price {
      background: rgba(168,85,247,.9);
      color: white;
      border: 1px solid rgba(168,85,247,1);
    }

    .item-category-box {
      border-radius: 12px;
      border: 1px solid rgba(148,163,255,.4);
      background: rgba(15,23,42,.85);
      padding: 0.75rem;
    }

    .category-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: #a855f7;
      margin-bottom: 0.5rem;
    }
    
    /* BUTTON STYLES */
    .btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s ease;
      text-decoration: none;
      border: 1px solid rgba(148,163,255,.4);
      background: rgba(71,85,105,.3);
      color: #e5e7eb;
    }
    
    .btn:hover {
      transform: translateY(-1px);
      background: rgba(71,85,105,.5);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #7c3aed, #a855f7);
      border: 1px solid rgba(168,85,247,.8);
      color: white;
      box-shadow: 0 0 20px rgba(168,85,247,.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(168,85,247,.6);
    }
    
    .btn-closet {
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
      border: 1px solid rgba(56,189,248,.8);
      color: white;
      box-shadow: 0 0 20px rgba(14,165,233,.3);
      font-size: 0.95rem;
      padding: 0.75rem 1.5rem;
    }
    
    .btn-closet:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(14,165,233,.6);
    }
    
    /* COIN ICON */
    .coin-icon {
      width: 1em;
      height: 1em;
      display: inline-block;
      vertical-align: middle;
      margin: 0 0.1em;
    }
    
    /* CHAT STYLES */
    .chat-log {
      max-height: 400px;
      overflow-y: auto;
      padding: 0.5rem;
      background: rgba(5,10,25,.5);
      border-radius: 8px;
      border: 1px solid rgba(148,163,255,.2);
    }
    
    .chat-msg-user, .chat-msg-assistant {
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
      line-height: 1.4;
      display: flex;
      align-items: start;
      gap: 0.5rem;
    }
    
    .chat-msg-user {
      background: linear-gradient(135deg, #7c3aed, #a855f7);
      color: white;
      margin-left: auto;
      max-width: 80%;
    }
    
    .chat-msg-assistant {
      background: rgba(15,23,42,.9);
      color: #e5e7eb;
      border: 1px solid rgba(148,163,255,.3);
      max-width: 80%;
    }
    
    .chat-shell {
      background: rgba(10,2,26,.7);
      border: 1px solid rgba(124,58,237,.4);
      border-radius: 12px;
    }
  </style>
</head>
<body data-no-global-carrie="true" data-gender="female" data-skin="light">
  <header class="px-4 py-4">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg?v=15"
             alt="8BFR logo"
             class="h-9 w-auto"
             onerror="this.onerror=null;this.src='assets/images/8bfr.png?v=15'">
        <div>
          <h1 class="text-xl sm:text-2xl font-extrabold">
            <span class="text-[#a855f7]">Carrie Chat</span>
            <span class="text-xs sm:text-sm font-semibold align-middle ml-1 text-emerald-300/80">beta</span>
          </h1>
          <p class="text-[11px] text-purple-300/80 -mt-0.5">
            Chat with your AI avatar
          </p>
        </div>
      </div>
      <div class="flex flex-col items-end gap-1">
        <a href="https://8bfr.github.io/8bfr-Music-Network/index.html"
           class="text-[#00d9ff] text-[11px] sm:text-xs underline/50 hover:underline">
          ‚¨Ö Back to Home
        </a>
        <div style="font-size:11px; color:#a855f7; display:flex; gap:0.75rem; align-items:center;">
          <span>
            Balance: <span id="coinBalanceHeader" style="font-weight:700;">0</span> 
            <img src="assets/images/icon_8bfr_coin.png" class="coin-icon" alt="coin">
          </span>
          <a href="coinshop.html" class="text-[#00d9ff] underline/50 hover:underline">Buy Coins</a>
          <a href="shop.html" class="text-[#00d9ff] underline/50 hover:underline">Shop</a>
        </div>
      </div>
    </div>
  </header>
  
  <main class="max-w-6xl mx-auto px-4 pb-10 pt-5">
    <div class="shell p-4 sm:p-5 lg:p-6">
      <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
    <!-- Avatar & Items Layout -->
    <div class="avatar-items-layout">
      <!-- Left: Avatar + Chat + Items -->
      <div>
        <!-- Mini Avatar Preview -->
        <div id="closetPreviewFrame">
          <div id="closetPreviewInner">
            <img id="closetBaseImg" src="assets/images/base/female/base_female_light.png?v=15" alt="Carrie Base">
            <div id="closetOverlayHost"></div>
          </div>
        </div>
        
        <!-- Avatar Controls -->
        <div class="avatar-controls-box">
          <!-- Mode Selector -->
          <div style="margin-bottom:0.75rem;">
            <div style="font-size:0.75rem; color:#a855f7; font-weight:600; margin-bottom:0.4rem;">CHAT MODE</div>
            <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
              <button id="modePro" class="seg-btn" data-mode="pro">‚ö° Pro</button>
              <button id="modeCasual" class="seg-btn active" data-mode="casual">üòé Casual</button>
              <button id="modeBFGF" class="seg-btn" data-mode="bfgf">üíï BF/GF</button>
            </div>
          </div>
          
          <div style="margin-bottom:0.75rem;">
            <div style="font-size:0.75rem; color:#a855f7; font-weight:600; margin-bottom:0.4rem;">GENDER</div>
            <div style="display:flex; gap:0.5rem;">
              <button id="genderFemale" class="seg-btn active" data-gender="female">üë© Female</button>
              <button id="genderMale" class="seg-btn" data-gender="male">üë® Male</button>
            </div>
          </div>
          
          <div>
            <div style="font-size:0.75rem; color:#a855f7; font-weight:600; margin-bottom:0.4rem;">SKIN TONE</div>
            <div style="display:flex; gap:0.5rem;">
              <button id="skinLight" class="seg-btn active" data-skin="light">‚òÄÔ∏è Light</button>
              <button id="skinDark" class="seg-btn" data-skin="dark">üåô Dark</button>
            </div>
          </div>

          <a href="carrie-closet.html" class="btn btn-closet" style="margin-top:1rem; width:100%; display:block;">
            üëó Open Full Closet
          </a>
        </div>

        <!-- Chat Shell (Below Avatar) -->
        <div class="chat-shell" style="padding:1rem; margin-top:1rem;">
          <!-- Chat Header -->
          <div style="margin-bottom:.75rem;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:.75rem;">
              <div>
                <div style="font-weight:600; font-size:.95rem; margin-bottom:.25rem;">üí¨ Chat with Carrie</div>
                <div style="font-size:.7rem; opacity:.7;">Ask anything or customize my look!</div>
              </div>
            </div>
            
            <!-- Chat Controls - Mobile Responsive Grid -->
            <div class="chat-controls-grid" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:0.5rem; margin-top:0.75rem;">
              <!-- Owner: Anonymous mode toggle -->
              <label id="anonymousModeLabel" style="display:none; font-size:0.7rem; color:#a855f7; cursor:pointer; align-items:center; gap:0.3rem; background:rgba(124,58,237,.15); border:1px solid rgba(124,58,237,.3); border-radius:6px; padding:0.4rem 0.6rem; white-space:nowrap; justify-content:center;">
                <input type="checkbox" id="anonymousModeToggle" style="cursor:pointer;">
                <span>üëª Anonymous</span>
              </label>
              
              <!-- Select Messages (everyone gets this now) -->
              <button id="selectModeBtn" class="seg-btn" style="font-size:0.7rem; display:none; white-space:nowrap; padding:0.4rem 0.6rem;">
                ‚òëÔ∏è Select
              </button>
              
              <!-- Clear My Chat (everyone can use this) -->
              <button id="clearMyChatBtn" class="seg-btn" style="font-size:0.7rem; display:none; white-space:nowrap; padding:0.4rem 0.6rem;">
                üóëÔ∏è Clear
              </button>
              
              <!-- Clear All Chats (owner only) -->
              <button id="clearAllChatsBtn" class="seg-btn" style="font-size:0.7rem; display:none; background:rgba(239,68,68,.2); border-color:rgba(239,68,68,.4); color:#ef4444; white-space:nowrap; padding:0.4rem 0.6rem;">
                ‚ö†Ô∏è Clear All
              </button>
              
              <!-- Owner: Avatar Trainer button -->
              <button id="trainerBtn" class="seg-btn" style="font-size:0.7rem; display:none; white-space:nowrap; padding:0.4rem 0.6rem;">
                üß† Trainer
              </button>
            </div>
          </div>
          
          <!-- Selection toolbar (hidden by default) -->
          <div id="selectionToolbar" style="display:none; margin-bottom:0.75rem; padding:0.5rem; background:rgba(124,58,237,.15); border:1px solid rgba(124,58,237,.4); border-radius:8px; display:flex; gap:0.5rem; align-items:center; justify-content:space-between;">
            <div style="font-size:0.75rem; color:#a855f7;">
              <span id="selectedCount">0</span> selected
            </div>
            <div style="display:flex; gap:0.5rem;">
              <button id="deleteSelectedBtn" class="seg-btn" style="font-size:0.7rem; background:rgba(239,68,68,.2); border-color:rgba(239,68,68,.6);">
                üóëÔ∏è Delete
              </button>
              <button id="archiveSelectedBtn" class="seg-btn" style="font-size:0.7rem;">
                üì¶ Archive
              </button>
              <button id="cancelSelectBtn" class="seg-btn" style="font-size:0.7rem;">
                Cancel
              </button>
            </div>
          </div>

          <div id="chatLog" class="chat-log">
            <!-- Messages will be dynamically inserted here -->
          </div>

          <div id="typingRow" class="msg-row" style="display:none; margin-top:.5rem;">
            <div class="msg-avatar">
              <img src="assets/images/carrie-avatar.png" alt="assistant" />
            </div>
            <div style="display:flex; gap:4px; align-items:center; padding:8px 12px; background:rgba(17,24,39,.96); border-radius:12px;">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>

          <form id="carrieForm" style="margin-top:1rem; display:flex; gap:.5rem; flex-direction:column;">
            <textarea id="carrieInput" placeholder="Type a message..." rows="2" style="width:100%; background:rgba(15,23,42,.9); border:1px solid rgba(124,58,237,.5); border-radius:8px; padding:.75rem; color:#e5e7eb; font-size:.9rem; resize:vertical;"></textarea>
            <div style="display:flex; gap:.5rem; justify-content:flex-end;">
              <button type="submit" class="btn btn-primary">Send üíú</button>
            </div>
          </form>
        </div>

        <!-- Items Shop (Below Chat) -->
        <div style="margin-top:1.5rem;">
          <!-- Category Tabs -->
          <div style="display:flex; flex-wrap:wrap; gap:0.5rem; margin-bottom:1rem;">
            <button type="button" class="tab-btn active" data-cat="all">All</button>
            <button type="button" class="tab-btn" data-cat="hair">Hair</button>
            <button type="button" class="tab-btn" data-cat="top">Tops</button>
            <button type="button" class="tab-btn" data-cat="bottom">Bottoms</button>
            <button type="button" class="tab-btn" data-cat="jewelry">Jewelry</button>
            <button type="button" class="tab-btn" data-cat="eyes">Eyes</button>
            <button type="button" class="tab-btn" data-cat="shoes">Shoes</button>
          </div>

          <!-- Your Items Section -->
          <div class="item-category-box" style="margin-bottom:1rem;">
            <div class="category-header">
              <span>‚úÖ</span>
              <span>Your Items</span>
            </div>
            <div id="ownedItemsGrid" class="mini-items-grid"></div>
          </div>

          <!-- Shop Section -->
          <div class="item-category-box">
            <div class="category-header">
              <span>üõí</span>
              <span>Shop</span>
            </div>
            <div id="shopItemsGrid" class="mini-items-grid"></div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- Avatar Trainer Modal (Owner Only) -->
  <div id="trainerBackdrop" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); z-index:9999; align-items:center; justify-content:center; padding:1rem; overflow-y:auto;">
    <div style="background:rgba(10,2,26,.98); border:1px solid rgba(124,58,237,.6); border-radius:18px; max-width:700px; width:100%; padding:1.5rem; position:relative; margin:auto;">
      <button id="trainerClose" type="button" style="position:absolute; top:10px; right:10px; background:rgba(124,58,237,.5); border:1px solid rgba(124,58,237,.7); color:#fff; width:28px; height:28px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:16px;">√ó</button>
      
      <div style="font-size:1.3rem; font-weight:700; margin-bottom:.5rem; color:#a855f7;">üß† Avatar Trainer</div>
      <div style="font-size:.8rem; opacity:.75; margin-bottom:1.5rem;">Train Carrie's responses for different modes and avatars</div>
      
      <form id="trainerForm">
        <!-- Apply To Section -->
        <div style="margin-bottom:1.5rem; padding:1rem; background:rgba(124,58,237,.08); border:1px solid rgba(124,58,237,.25); border-radius:10px;">
          <div style="font-size:.85rem; font-weight:600; margin-bottom:.75rem; color:#a855f7;">üìç APPLY TRAINING TO:</div>
          
          <!-- Mode Selection -->
          <div style="margin-bottom:1rem;">
            <label style="display:block; font-size:.7rem; margin-bottom:.4rem; color:#e5e7eb; text-transform:uppercase; letter-spacing:.05em;">Mode</label>
            <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
              <button type="button" class="seg-btn mode-select-btn active" data-mode="all">All Modes</button>
              <button type="button" class="seg-btn mode-select-btn" data-mode="pro">Pro</button>
              <button type="button" class="seg-btn mode-select-btn" data-mode="casual">Casual</button>
              <button type="button" class="seg-btn mode-select-btn" data-mode="bfgf">BF/GF</button>
            </div>
          </div>
          
          <!-- Avatar Selection -->
          <div>
            <label style="display:block; font-size:.7rem; margin-bottom:.4rem; color:#e5e7eb; text-transform:uppercase; letter-spacing:.05em;">Avatar</label>
            <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
              <button type="button" class="seg-btn avatar-select-btn active" data-avatar="all">All Avatars</button>
              <button type="button" class="seg-btn avatar-select-btn" data-avatar="female-light">üë©‚òÄÔ∏è F-Light</button>
              <button type="button" class="seg-btn avatar-select-btn" data-avatar="female-dark">üë©üåô F-Dark</button>
              <button type="button" class="seg-btn avatar-select-btn" data-avatar="male-light">üë®‚òÄÔ∏è M-Light</button>
              <button type="button" class="seg-btn avatar-select-btn" data-avatar="male-dark">üë®üåô M-Dark</button>
            </div>
          </div>
        </div>
        
        <!-- Training Input -->
        <div style="margin-bottom:1rem;">
          <label style="display:block; font-size:.75rem; margin-bottom:.4rem; color:#a855f7; font-weight:600;">TRIGGER (Question/Pattern)</label>
          <input id="trainerQuestion" type="text" placeholder="e.g., 'tell me a joke' or 'what's your favorite color'" style="width:100%; background:rgba(15,23,42,.9); border:1px solid rgba(124,58,237,.5); border-radius:8px; padding:.6rem; color:#e5e7eb; font-size:.85rem;" required />
          <div style="font-size:.65rem; color:#a855f7; opacity:.7; margin-top:.3rem;">Keywords that trigger this response</div>
        </div>
        
        <div style="margin-bottom:1.5rem;">
          <label style="display:block; font-size:.75rem; margin-bottom:.4rem; color:#a855f7; font-weight:600;">RESPONSE</label>
          <textarea id="trainerAnswer" rows="4" placeholder="Carrie will respond with this when triggered..." style="width:100%; background:rgba(15,23,42,.9); border:1px solid rgba(124,58,237,.5); border-radius:8px; padding:.6rem; color:#e5e7eb; font-size:.85rem; resize:vertical;" required></textarea>
          <div style="font-size:.65rem; color:#a855f7; opacity:.7; margin-top:.3rem;">You can use line breaks for multi-line responses</div>
        </div>
        
        <!-- Status Message -->
        <div id="trainerStatus" style="display:none; padding:.6rem; border-radius:8px; margin-bottom:1rem; font-size:.8rem; text-align:center;"></div>
        
        <!-- Action Buttons -->
        <div style="display:flex; gap:.75rem; justify-content:flex-end;">
          <button type="button" id="trainerCancel" style="background:rgba(71,85,105,.3); border:1px solid rgba(148,163,184,.4); color:#e5e7eb; padding:.5rem 1rem; border-radius:8px; cursor:pointer; font-size:.85rem;">
            Cancel
          </button>
          <button type="submit" style="background:linear-gradient(135deg,#7c3aed,#a855f7); border:1px solid rgba(168,85,247,.8); color:#fff; padding:.5rem 1.5rem; border-radius:8px; cursor:pointer; font-weight:600; font-size:.85rem; box-shadow:0 0 15px rgba(168,85,247,.4);">
            üíæ Save Training
          </button>
        </div>
      </form>
      
      <!-- Saved Trainings List -->
      <div id="trainedResponsesList" style="margin-top:2rem; padding-top:1.5rem; border-top:1px solid rgba(124,58,237,.3);">
        <div style="font-size:.9rem; font-weight:600; margin-bottom:.75rem; color:#a855f7;">üìö Saved Responses</div>
        <div id="trainedResponsesGrid" style="max-height:300px; overflow-y:auto;">
          <!-- Populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Hide floating bubbles
    window.addEventListener("load", function(){
      setTimeout(function(){
        const idsToHide = ['bubbleStack', 'bubble-top-single', 'carrieWrap', 'carrieBubble', 'carrieToggleBar'];
        idsToHide.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.style.display = 'none';
        });
        
        const classesToHide = ['.bubble-stack', '.floating-bubbles', '.carrie-bubble', '.bubble-container'];
        classesToHide.forEach(cls => {
          document.querySelectorAll(cls).forEach(el => el.style.display = 'none');
        });
        
        document.querySelectorAll('[data-bubble]').forEach(el => el.style.display = 'none');
        document.querySelectorAll('[data-role="carrie"], [data-carrie]').forEach(el => el.style.display = 'none');
      }, 300);
    });
  </script>
  <script src="carrie-chat.js?v=4"></script>
</body>
  </html>
