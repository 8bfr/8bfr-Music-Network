<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Carrie Closet â€” 8BFR Music Network</title>
  <meta name="description" content="Customize your Carrie, James, or partner avatar with outfits, hair, accessories and more using 8BFR coins." />
  <link rel="icon" href="assets/images/favicon.png" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --ring: rgba(124,58,237,.55);
      --glass: rgba(12,6,24,.80);
    }

    html, body { scroll-behavior:smooth; }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.30), transparent 60%),
        radial-gradient(900px 400px at 110% 10%, rgba(0,217,255,.22), transparent 60%),
        linear-gradient(#050011,#000);
      color:#eae6ff;
      margin:0;
      min-height:100vh;
      overflow-x:hidden;
    }

    header {
      position:relative;
      z-index:5;
      background:rgba(10,0,25,.96);
      border-bottom:1px solid rgba(124,58,237,.5);
      box-shadow:0 18px 40px rgba(0,0,0,.7);
    }

    .shell {
      border-radius:20px;
      border:1px solid rgba(129,140,248,.6);
      background:
        radial-gradient(circle at 0 0,rgba(76,29,149,.40),transparent 60%),
        radial-gradient(circle at 100% 0,rgba(14,165,233,.22),transparent 60%),
        rgba(10,6,30,.96);
      box-shadow:0 18px 50px rgba(0,0,0,.8);
    }

    /* --- Preview frame + layering --- */

    #closetPreviewFrame {
      position:relative;
      width:100%;
      max-width:500px;
      margin:0 auto;
      border-radius:18px;
      border:1px solid rgba(148,163,255,.55);
      background:#020014;
      overflow:hidden;
      aspect-ratio: 500 / 282; /* matches your PNG art size */
      display:flex;
      align-items:center;
      justify-content:center;
    }

    #closetBaseImg {
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }

    #closetOverlayHost {
      position:absolute;
      inset:0;
      pointer-events:none;
    }

    /* Every overlay uses same canvas as base (500Ã—282),
       so everything lines up exactly how you drew it. */
    .layer-overlay {
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:contain;
      pointer-events:none;
    }

    .pill-tag {
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      font-size:.7rem;
      border-radius:999px;
      padding:.15rem .6rem;
      border:1px solid rgba(129,140,248,.85);
      background:rgba(15,23,42,.9);
      text-transform:uppercase;
      letter-spacing:.08em;
    }

    .pill-tag-soft {
      border-color:rgba(147,197,253,.55);
      background:rgba(15,23,42,.85);
    }

    .seg-btn {
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,255,.45);
      background:rgba(15,23,42,.85);
      cursor:pointer;
      color:#e5e7eb;
      transition:all .12s ease;
    }

    .seg-btn.active {
      border-color:#a855f7;
      background:linear-gradient(135deg,#7c3aed,#a855f7);
      color:#fff;
      box-shadow:0 0 0 1px rgba(129,140,248,.7),0 0 16px rgba(168,85,247,.65);
    }

    .seg-btn:hover {
      background:rgba(30,64,175,.85);
    }

    .tab-btn {
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,255,.35);
      background:rgba(15,23,42,.8);
      cursor:pointer;
      color:#e5e7eb;
      transition:all .12s ease;
      white-space:nowrap;
    }

    .tab-btn.active {
      border-color:#38bdf8;
      background:radial-gradient(circle at 0 0,#38bdf8,#6366f1);
      color:#0f172a;
    }

    .closet-item-card {
      border-radius:12px;
      border:1px solid rgba(148,163,255,.4);
      background:rgba(15,23,42,.96);
      padding:.45rem .55rem;
      text-align:left;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease, border-color .08s ease, background .08s ease;
      display:flex;
      gap:.45rem;
      align-items:center;
    }

    .closet-item-card:hover {
      transform:translateY(-1px);
      border-color:#a855f7;
      box-shadow:0 0 0 1px rgba(129,140,248,.85),0 0 18px rgba(124,58,237,.55);
      background:rgba(30,64,175,.85);
    }

    .closet-item-card.active {
      border-color:#22c55e;
      box-shadow:0 0 0 1px rgba(22,163,74,.8),0 0 18px rgba(22,163,74,.7);
      background:rgba(5,46,22,.92);
    }

    .closet-item-thumb {
      width:44px;
      height:44px;
      border-radius:10px;
      border:1px solid rgba(148,163,255,.4);
      background:#020617;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex-shrink:0;
    }

    .closet-item-thumb img {
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }

    #closetError {
      border-radius:999px;
      border:1px solid rgba(248,113,113,.8);
      background:rgba(127,29,29,.90);
      padding:.4rem .75rem;
      font-size:11px;
    }

    #closetEmpty {
      border-radius:999px;
      border:1px dashed rgba(148,163,255,.5);
      background:rgba(15,23,42,.86);
      padding:.4rem .75rem;
      font-size:11px;
    }

    /* Hide global Carrie avatar / bubbles on this page */
    #bubbleStack,
    #bubble-top-single,
    #carrieWrap,
    #globalAvatarSwitch {
      display:none !important;
    }

    #carrieToggleBar,
    .carrie-toggle-bar,
    #carrieModeButtons {
      display:none !important;
    }

    @media (max-width:768px){
      .shell { border-radius:16px; }
    }
  </style>
</head>
<body data-no-global-carrie="true">
  <header class="px-4 py-4">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg"
             alt="8BFR logo"
             class="h-9 w-auto"
             onerror="this.onerror=null;this.src='assets/images/8bfr.png'">
        <div>
          <h1 class="text-xl sm:text-2xl font-extrabold">
            <span class="text-[#a855f7]">Carrie Closet</span>
            <span class="text-xs sm:text-sm font-semibold align-middle ml-1 text-emerald-300/80">beta</span>
          </h1>
          <p class="text-[11px] text-purple-300/80 -mt-0.5">
            Dress your AI avatar for BF / GF chat and future upgrades.
          </p>
        </div>
      </div>
      <div class="flex flex-col items-end gap-1">
        <a href="carrie-chat.html"
           class="text-[#00d9ff] text-[11px] sm:text-xs underline/50 hover:underline">
          â¬… Back to Carrie Chat
        </a>
        <span class="pill-tag pill-tag-soft text-[10px]">
          <span>ðŸª™</span> Coins shop connects from here later
        </span>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-10 pt-5">
    <div class="shell p-4 sm:p-5 lg:p-6">
      <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
        <!-- LEFT: Preview + base controls -->
        <section class="lg:w-[45%] space-y-4">
          <div class="flex items-center justify-between gap-2">
            <div class="flex flex-wrap items-center gap-2">
              <span class="pill-tag text-[10px]">
                ðŸ§¬ Avatar Preview
              </span>
              <span id="closetPreviewLabel" class="text-[11px] text-purple-200/80">
                Female â€¢ Light skin â€¢ Bikini base
              </span>
            </div>
            <span class="text-[10px] text-purple-200/80">
              BF / GF chat only
            </span>
          </div>

          <div id="closetPreviewFrame">
            <img id="closetBaseImg"
                 src="assets/images/base/female/base_female_light.png"
                 alt="Avatar base">
            <div id="closetOverlayHost"></div>
          </div>

          <div class="space-y-3 mt-2">
            <!-- Gender -->
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span class="uppercase tracking-[0.16em] text-[9px] text-purple-200/75">
                  Gender
                </span>
              </div>
              <div class="flex gap-2">
                <button type="button"
                        class="seg-btn active"
                        data-gender="female">
                  â™€ Female
                </button>
                <button type="button"
                        class="seg-btn"
                        data-gender="male">
                  â™‚ Male
                </button>
              </div>
            </div>

            <!-- Skin tone -->
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span class="uppercase tracking-[0.16em] text-[9px] text-purple-200/75">
                  Skin tone
                </span>
              </div>
              <div id="skinToneButtons" class="flex flex-wrap gap-2">
                <!-- Filled by JS -->
              </div>
            </div>
          </div>

          <p class="mt-3 text-[11px] text-purple-200/80">
            Tip: All outfits, hair, and accessories are drawn on the same canvas as the base,
            so what you see here will match BF / GF chat exactly.
          </p>
        </section>

        <!-- RIGHT: Filters + items -->
        <section class="lg:flex-1 space-y-3">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div class="flex flex-wrap items-center gap-2">
              <span class="pill-tag text-[10px]">
                ðŸ›’ Closet Items
              </span>
              <span id="closetGenderLabel" class="text-[11px] text-purple-200/85">
                Showing items for <b>Female</b> avatar
              </span>
            </div>
          </div>

          <!-- Category tabs -->
          <div class="flex flex-wrap gap-2 mt-1">
            <button type="button" class="tab-btn active" data-cat="hair">Hair</button>
            <button type="button" class="tab-btn" data-cat="top">Tops</button>
            <button type="button" class="tab-btn" data-cat="bottom">Bottoms</button>
            <button type="button" class="tab-btn" data-cat="jewelry">Jewelry</button>
            <button type="button" class="tab-btn" data-cat="eyes">Eyes</button>
            <button type="button" class="tab-btn" data-cat="shoes">Shoes</button>
            <button type="button" class="tab-btn" data-cat="all">All</button>
          </div>

          <!-- Error / empty messages -->
          <div id="closetError" class="hidden mt-2 text-red-50 text-[11px]">
            Closet data failed to initialize. Try reloading the page.
          </div>

          <div id="closetEmpty" class="hidden mt-2 text-purple-100/90 text-[11px]">
            No items for this category yet. Try switching categories or gender.
          </div>

          <!-- Items grid -->
          <div id="closetItemsGrid" class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2.5">
            <!-- JS will inject cards -->
          </div>

          <p class="mt-3 text-[10px] text-purple-300/75">
            In the full release, each item will cost 8BFR coins and connect to your
            <a href="coinshop.html" class="underline text-sky-300 hover:text-sky-200">Coin Shop</a>.
            For now this is a visual beta so you can design outfits without charging coins.
          </p>
        </section>
      </div>
    </div>

    <p class="mt-4 text-[11px] text-purple-300/70 text-center max-w-3xl mx-auto">
      Default male base has shorts and no shirt. Default female base uses a bikini.
      Tops, bottoms, hair, eyes, jewelry, and shoes layer over those bases.
    </p>
  </main>

  <!-- Global UI (menu / etc) -->
  <script src="scripts.js?v=1" defer></script>

  <!-- INLINE closet data + logic (no external JS needed) -->
  <script>
    (function () {
      // ---- Paths for base bodies ----
      const BASES = {
        female: {
          light: "assets/images/base/female/base_female_light.png",
          medium: "assets/images/base/female/base_female_medium.png",
          dark: "assets/images/base/female/base_female_dark.png",
        },
        male: {
          light: "assets/images/base/male/base_male_light.png",
          medium: "assets/images/base/male/base_male_medium.png",
          dark: "assets/images/base/male/base_male_dark.png",
        },
      };

      const SKIN_TONES = {
        female: [
          { key: "light", label: "Light" },
          { key: "medium", label: "Medium" },
          { key: "dark", label: "Dark" },
        ],
        male: [
          { key: "light", label: "Light" },
          { key: "medium", label: "Medium" },
          { key: "dark", label: "Dark" },
        ],
      };

      // ---- Closet items (use your real files) ----
      const closetItems = [
        // HAIR â€” straight (female)
        {
          id: "hair_straight_blonde",
          label: "Straight â€¢ Blonde",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_blonde.png",
          cost: 25,
        },
        {
          id: "hair_straight_brown",
          label: "Straight â€¢ Brown",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_brown.png",
          cost: 25,
        },
        {
          id: "hair_straight_copper",
          label: "Straight â€¢ Copper",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_copper.png",
          cost: 25,
        },
        {
          id: "hair_straight_ginger",
          label: "Straight â€¢ Ginger",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_ginger.png",
          cost: 25,
        },
        {
          id: "hair_straight_pastel_blue",
          label: "Straight â€¢ Pastel blue",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_pastel_blue.png",
          cost: 25,
        },
        {
          id: "hair_straight_pastel_pink",
          label: "Straight â€¢ Pastel pink",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_pastel_pink.png",
          cost: 25,
        },
        {
          id: "hair_straight_pastel_purple",
          label: "Straight â€¢ Pastel purple",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_pastel_purple.png",
          cost: 25,
        },
        {
          id: "hair_straight_platinum",
          label: "Straight â€¢ Platinum blonde",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/straight/female_straight_platinum_blonde.png",
          cost: 25,
        },

        // HAIR â€” wavy (female)
        {
          id: "hair_wavy_blonde",
          label: "Wavy â€¢ Blonde",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_wavy_blonde.png",
          cost: 25,
        },
        {
          id: "hair_wavy_brown",
          label: "Wavy â€¢ Brown",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_wavy_brown.png",
          cost: 25,
        },
        {
          id: "hair_wavy_copper",
          label: "Wavy â€¢ Copper",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_wavy_copper.png",
          cost: 25,
        },
        {
          id: "hair_wavy_ginger",
          label: "Wavy â€¢ Ginger",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_wavy_ginger.png",
          cost: 25,
        },
        {
          id: "hair_wavy_pastel_blue",
          label: "Wavy â€¢ Pastel blue",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_pastel_blue.png",
          cost: 25,
        },
        {
          id: "hair_wavy_pastel_pink",
          label: "Wavy â€¢ Pastel pink",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_wavy_pastel_pink.png",
          cost: 25,
        },
        {
          id: "hair_wavy_pastel_purple",
          label: "Wavy â€¢ Pastel purple",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_wavy_pastel_purple.png",
          cost: 25,
        },
        {
          id: "hair_wavy_platinum",
          label: "Wavy â€¢ Platinum blonde",
          category: "hair",
          layer: "hair",
          gender: "female",
          src: "assets/images/hair/wavy/female_wavy_platinum_blonde.png",
          cost: 25,
        },

        // TOPS â€” female & unisex
        {
          id: "top_female_bikini",
          label: "Bikini top",
          category: "top",
          layer: "top",
          gender: "female",
          src: "assets/images/female_cloths/female_bikini.png",
          cost: 15,
        },
        {
          id: "top_unisex_tee",
          label: "Unisex tee shirt",
          category: "top",
          layer: "top",
          gender: "unisex",
          src: "assets/images/unisex/cloths/unisex_tee-shirt.png",
          cost: 20,
        },
        {
          id: "top_unisex_tank",
          label: "Unisex tank top",
          category: "top",
          layer: "top",
          gender: "unisex",
          src: "assets/images/unisex/cloths/unisex_tank-top.png",
          cost: 18,
        },

        // BOTTOMS â€” female
        {
          id: "bottom_female_shorts",
          label: "Shorts",
          category: "bottom",
          layer: "bottom",
          gender: "female",
          src: "assets/images/female_cloths/female_shorts.png",
          cost: 18,
        },
        {
          id: "bottom_female_skirt",
          label: "Skirt",
          category: "bottom",
          layer: "bottom",
          gender: "female",
          src: "assets/images/female_cloths/female_skirt.png",
          cost: 18,
        },

        // JEWELRY â€” female
        {
          id: "jewel_female_necklace",
          label: "Gold necklace (F)",
          category: "jewelry",
          layer: "necklace",
          gender: "female",
          src: "assets/images/female_jewlery/female_gold_necklace.png",
          cost: 30,
        },
        {
          id: "jewel_female_earrings",
          label: "Gold earrings (F)",
          category: "jewelry",
          layer: "ears",
          gender: "female",
          src: "assets/images/female_jewlery/female_gold_ear-ring.png",
          cost: 25,
        },
        {
          id: "jewel_female_belly",
          label: "Gold belly ring (F)",
          category: "jewelry",
          layer: "belly",
          gender: "female",
          src: "assets/images/female_jewlery/female_gold_belly-ring.png",
          cost: 25,
        },

        // JEWELRY â€” male
        {
          id: "jewel_male_necklace",
          label: "Gold necklace (M)",
          category: "jewelry",
          layer: "necklace",
          gender: "male",
          src: "assets/images/male_jewlery/male_gold_necklace.png",
          cost: 30,
        },

        // EYES â€” unisex (full pair on canvas)
        {
          id: "eyes_blue",
          label: "Eyes â€¢ Blue",
          category: "eyes",
          layer: "eyes",
          gender: "unisex",
          src: "assets/images/unisex/eyes/unisex_eyes_blue.png",
          cost: 10,
        },
        {
          id: "eyes_green",
          label: "Eyes â€¢ Green",
          category: "eyes",
          layer: "eyes",
          gender: "unisex",
          src: "assets/images/unisex/eyes/unisex_eyes_green.png",
          cost: 10,
        },
        {
          id: "eyes_brown",
          label: "Eyes â€¢ Brown",
          category: "eyes",
          layer: "eyes",
          gender: "unisex",
          src: "assets/images/unisex/eyes/unisex_eyes_brown.png",
          cost: 10,
        },

        // SHOES â€” unisex (both feet on canvas)
        {
          id: "shoes_unisex",
          label: "Shoes",
          category: "shoes",
          layer: "shoes",
          gender: "unisex",
          src: "assets/images/unisex/shoes/unisex_shoes.png",
          cost: 15,
        },
        {
          id: "shoes_sandles",
          label: "Sandals",
          category: "shoes",
          layer: "shoes",
          gender: "unisex",
          src: "assets/images/unisex/shoes/unisex_sandles.png",
          cost: 15,
        },
      ];

      // ---- DOM refs ----
      const baseImg = document.getElementById("closetBaseImg");
      const overlayHost = document.getElementById("closetOverlayHost");
      const grid = document.getElementById("closetItemsGrid");
      const errorBox = document.getElementById("closetError");
      const emptyBox = document.getElementById("closetEmpty");
      const previewLabel = document.getElementById("closetPreviewLabel");
      const genderLabel = document.getElementById("closetGenderLabel");
      const skinToneButtonsEl = document.getElementById("skinToneButtons");

      const genderButtons = Array.from(
        document.querySelectorAll(".seg-btn[data-gender]")
      );
      const tabButtons = Array.from(
        document.querySelectorAll(".tab-btn[data-cat]")
      );

      if (!baseImg || !overlayHost || !grid) {
        if (errorBox) {
          errorBox.classList.remove("hidden");
          errorBox.textContent =
            "Closet failed to initialize. Some required elements are missing.";
        }
        return;
      }

      // ---- Layers: one <img> per layer, reused (no stacking bugs) ----
      const LAYER_KEYS = [
        "hair",
        "eyes",
        "top",
        "bottom",
        "necklace",
        "ears",
        "belly",
        "shoes",
      ];

      const layerImgs = {};
      LAYER_KEYS.forEach((key) => {
        const img = document.createElement("img");
        img.className = "layer-overlay layer-" + key;
        img.alt = "";
        overlayHost.appendChild(img);
        layerImgs[key] = img;
      });

      // ---- State ----
      let currentGender = "female";
      let currentSkinToneKey = "light";
      let currentCategory = "hair";

      // activeSelections[layerKey] = closetItem or null
      let activeSelections = {};
      LAYER_KEYS.forEach((key) => (activeSelections[key] = null));

      // ---- Helpers ----
      function setBaseImage() {
        const baseByGender = BASES[currentGender];
        const src =
          (baseByGender && baseByGender[currentSkinToneKey]) ||
          baseByGender.light;
        baseImg.src = src;

        const toneDef = SKIN_TONES[currentGender].find(
          (t) => t.key === currentSkinToneKey
        );
        const toneLabel = toneDef ? toneDef.label : "Light";
        const baseLabel =
          currentGender === "female" ? "Bikini base" : "Shorts base";

        if (previewLabel) {
          const genderWord =
            currentGender === "female" ? "Female" : "Male";
          previewLabel.textContent =
            genderWord + " â€¢ " + toneLabel + " skin â€¢ " + baseLabel;
        }
        if (genderLabel) {
          const gWord = currentGender === "female" ? "Female" : "Male";
          genderLabel.innerHTML =
            'Showing items for <b>' + gWord + "</b> avatar";
        }
      }

      function applySelections() {
        LAYER_KEYS.forEach((layerKey) => {
          const img = layerImgs[layerKey];
          const item = activeSelections[layerKey];
          if (!img) return;
          if (item) {
            img.src = item.src;
            img.style.display = "block";
          } else {
            img.removeAttribute("src");
            img.style.display = "none";
          }
        });
      }

      function clearSelectionsForGenderChange() {
        activeSelections = {};
        LAYER_KEYS.forEach((key) => (activeSelections[key] = null));
        applySelections();
      }

      function renderSkinToneButtons() {
        if (!skinToneButtonsEl) return;
        skinToneButtonsEl.innerHTML = "";

        const tones = SKIN_TONES[currentGender] || [];
        tones.forEach((tone) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.textContent = tone.label;
          btn.className =
            "seg-btn" + (tone.key === currentSkinToneKey ? " active" : "");
          btn.dataset.skin = tone.key;
          btn.style.fontSize = "10px";

          btn.addEventListener("click", () => {
            currentSkinToneKey = tone.key;
            renderSkinToneButtons();
            setBaseImage();
          });

          skinToneButtonsEl.appendChild(btn);
        });
      }

      function itemVisibleForCurrent(item) {
        if (currentCategory !== "all" && item.category !== currentCategory) {
          return false;
        }
        return (
          item.gender === "unisex" ||
          item.gender === currentGender
        );
      }

      function renderItems() {
        grid.innerHTML = "";
        if (errorBox) errorBox.classList.add("hidden");
        if (emptyBox) emptyBox.classList.add("hidden");

        const visible = closetItems.filter(itemVisibleForCurrent);

        if (!visible.length) {
          if (emptyBox) emptyBox.classList.remove("hidden");
          return;
        }

        visible.forEach((item) => {
          const card = document.createElement("button");
          card.type = "button";
          card.className = "closet-item-card";
          card.dataset.itemId = item.id;

          const thumb = document.createElement("div");
          thumb.className = "closet-item-thumb";

          const img = document.createElement("img");
          img.src = item.src;
          img.alt = item.label;
          thumb.appendChild(img);

          const info = document.createElement("div");
          info.style.flex = "1 1 auto";

          const title = document.createElement("div");
          title.textContent = item.label;
          title.style.fontSize = "11px";

          const meta = document.createElement("div");
          meta.style.fontSize = "10px";
          meta.style.opacity = "0.8";
          const catLabel = item.category.charAt(0).toUpperCase() + item.category.slice(1);
          const coinText = item.cost ? item.cost + " coins" : "Free (beta)";
          meta.textContent = catLabel + " â€¢ " + coinText;

          info.appendChild(title);
          info.appendChild(meta);

          card.appendChild(thumb);
          card.appendChild(info);

          // active highlight
          const currentSelected = activeSelections[item.layer];
          if (currentSelected && currentSelected.id === item.id) {
            card.classList.add("active");
          }

          card.addEventListener("click", () => {
            const already =
              activeSelections[item.layer] &&
              activeSelections[item.layer].id === item.id;

            // click again = remove, otherwise select
            activeSelections[item.layer] = already ? null : item;
            applySelections();
            renderItems(); // re-render to update active highlight
          });

          grid.appendChild(card);
        });
      }

      function setCategory(cat) {
        currentCategory = cat;
        tabButtons.forEach((btn) => {
          btn.classList.toggle("active", btn.dataset.cat === cat);
        });
        renderItems();
      }

      function initGenderButtons() {
        genderButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const g = btn.dataset.gender === "male" ? "male" : "female";
            if (g === currentGender) return;
            currentGender = g;
            genderButtons.forEach((b) =>
              b.classList.toggle("active", b === btn)
            );
            // reset skin tone + selections on gender change
            currentSkinToneKey = "light";
            clearSelectionsForGenderChange();
            renderSkinToneButtons();
            setBaseImage();
            renderItems();
          });
        });
      }

      function initTabs() {
        tabButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const cat = btn.dataset.cat || "hair";
            setCategory(cat);
          });
        });
      }

      // ---- Init ----
      try {
        initGenderButtons();
        initTabs();
        renderSkinToneButtons();
        setBaseImage();
        setCategory("hair");
      } catch (err) {
        console.warn("Carrie Closet init error:", err);
        if (errorBox) {
          errorBox.classList.remove("hidden");
          errorBox.textContent =
            "Closet hit an error while loading. Try refreshing the page.";
        }
      }
    })();
  </script>
</body>
</html>
