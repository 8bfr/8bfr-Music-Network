
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Carrie Closet â€” 8BFR Music Network</title>
  <meta name="description" content="Customize your Carrie, James, or partner avatar with outfits, hair, accessories and more using 8BFR coins." />
  <link rel="icon" href="assets/images/favicon.png?v=15" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --ring: rgba(124,58,237,.55);
      --glass: rgba(12,6,24,.80);
    }
  
    html, body { scroll-behavior:smooth; }
  
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.30), transparent 60%),
        radial-gradient(900px 400px at 110% 10%, rgba(0,217,255,.22), transparent 60%),
        linear-gradient(#050011,#000);
      color:#eae6ff;
      margin:0;
      min-height:100vh;
      overflow-x:hidden;
    }
  
    header {
      position:relative;
      z-index:5;
      background:rgba(10,0,25,.96);
      border-bottom:1px solid rgba(124,58,237,.5);
      box-shadow:0 18px 40px rgba(0,0,0,.7);
    }
  
    .shell {
      border-radius:20px;
      border:1px solid rgba(129,140,248,.6);
      background:
        radial-gradient(circle at 0 0,rgba(76,29,149,.40),transparent 60%),
        radial-gradient(circle at 100% 0,rgba(14,165,233,.22),transparent 60%),
        rgba(10,6,30,.96);
      box-shadow:0 18px 50px rgba(0,0,0,.8);
    }
  
    #closetPreviewFrame {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      border-radius: 18px;
      border: 1px solid rgba(148,163,255,0.55);
      overflow: hidden;
      height: 800px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-image: url("assets/images/closet/dressingroom.png?v=15");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
    }
  
    #closetPreviewInner {
      position: relative;
      width: 100%;
      max-width: 480px;
      height: 100%;
      transform: translateY(30px);
    }
  
    #closetBaseImg {
      position: absolute;
      inset: 0;
      height: 100%;
      width: auto;
      object-fit: cover;
      display: block;
      z-index: 1;
      left: 50%;
      transform: translateX(-50%);
      filter: drop-shadow(0 0 3px #000);
    }

    body[data-gender="female"][data-skin="light"]{
      --base-width: .89;
      --base-height: .99;
    }

    body[data-gender="female"][data-skin="dark"]{
      --base-width: .63;
      --base-height: .96;
    }

    body[data-gender="male"][data-skin="light"]{
      --base-width: 1.00;
      --base-height: 1.00;
    }

    body[data-gender="male"][data-skin="dark"]{
      --base-width: 0.96;
      --base-height: 1.00;
    }

    body[data-skin] #closetBaseImg{
      transform: translateX(-50%) scaleX(var(--base-width, 1)) scaleY(var(--base-height, 1));
    }
  
    #closetOverlayHost img {
      filter: drop-shadow(0 0 2px #000);
    }
  
    #closetOverlayHost {
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:2;
    }
  
    .layer-overlay {
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:contain;
      pointer-events:none;
      image-rendering:auto;
      --scale: 1;
      --offset-x: 0%;
      --offset-y: 0%;
      --rotate: 0deg;
      --scale-light: var(--scale);
      --offset-x-light: var(--offset-x);
      --offset-y-light: var(--offset-y);
      --rotate-light: var(--rotate);
      --scale-dark: var(--scale);
      --offset-x-dark: var(--offset-x);
      --offset-y-dark: var(--offset-y);
      --rotate-dark: var(--rotate);
      --scale-use: var(--scale);
      --offset-x-use: var(--offset-x);
      --offset-y-use: var(--offset-y);
      --rotate-use: var(--rotate);
      transform: scale(var(--scale-use)) translateX(var(--offset-x-use)) translateY(var(--offset-y-use)) rotate(var(--rotate-use));
    }

    body[data-skin="light"] .layer-overlay{
      --scale-use: var(--scale-light);
      --offset-x-use: var(--offset-x-light);
      --offset-y-use: var(--offset-y-light);
      --rotate-use: var(--rotate-light);
    }

    body[data-skin="dark"] .layer-overlay{
      --scale-use: var(--scale-dark);
      --offset-x-use: var(--offset-x-dark);
      --offset-y-use: var(--offset-y-dark);
      --rotate-use: var(--rotate-dark);
    }
  
    .pill-tag {
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      font-size:.7rem;
      border-radius:999px;
      padding:.15rem .6rem;
      border:1px solid rgba(129,140,248,.85);
      background:rgba(15,23,42,.9);
      text-transform:uppercase;
      letter-spacing:.08em;
    }
  
    .pill-tag-soft {
      border-color:rgba(147,197,253,.55);
      background:rgba(15,23,42,.85);
    }
  
    .seg-btn {
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,255,.45);
      background:rgba(15,23,42,.85);
      cursor:pointer;
      color:#e5e7eb;
      transition:all .12s ease;
    }
  
    .seg-btn.active {
      border-color:#a855f7;
      background:linear-gradient(135deg,#7c3aed,#a855f7);
      color:#fff;
      box-shadow:0 0 0 1px rgba(129,140,248,.7),0 0 16px rgba(168,85,247,.65);
    }
  
    .seg-btn:hover {
      background:rgba(30,64,175,.85);
    }
  
    .tab-btn {
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,255,.35);
      background:rgba(15,23,42,.8);
      cursor:pointer;
      color:#e5e7eb;
      transition:all .12s ease;
      white-space:nowrap;
    }
  
    .tab-btn.active {
      border-color:#38bdf8;
      background:radial-gradient(circle at 0 0,#38bdf8,#6366f1);
      color:#0f172a;
    }
  
    .closet-item-card {
      border-radius:12px;
      border:1px solid rgba(148,163,255,.4);
      background:rgba(15,23,42,.96);
      padding:.45rem .55rem;
      text-align:left;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease, border-color .08s ease, background .08s ease;
      display:flex;
      gap:.45rem;
      align-items:center;
    }
  
    .closet-item-card:hover {
      transform:translateY(-1px);
      border-color:#a855f7;
      box-shadow:0 0 0 1px rgba(129,140,248,.85),0 0 18px rgba(124,58,237,.55);
      background:rgba(30,64,175,.85);
    }
  
    .closet-item-card.active {
      border-color:#22c55e;
      box-shadow:0 0 0 1px rgba(22,163,74,.8),0 0 18px rgba(22,163,74,.7);
      background:rgba(5,46,22,.92);
    }
  
    .closet-item-thumb {
      width:44px;
      height:44px;
      border-radius:10px;
      border:1px solid rgba(148,163,255,.4);
      background:#020617;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex-shrink:0;
    }
  
    .closet-item-thumb img {
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
  
    #closetError {
      border-radius:999px;
      border:1px solid rgba(248,113,113,.8);
      background:rgba(127,29,29,.90);
      padding:.4rem .75rem;
      font-size:11px;
    }
  
    #closetEmpty {
      border-radius:999px;
      border:1px dashed rgba(148,163,255,.5);
      background:rgba(15,23,42,.86);
      padding:.4rem .75rem;
      font-size:11px;
    }
  
    #bubbleStack,
    #bubble-top-single,
    #carrieWrap,
    #globalAvatarSwitch {
      display:none !important;
    }
  
    #carrieToggleBar,
    .carrie-toggle-bar,
    #carrieModeButtons {
      display:none !important;
    }
  
    @media (max-width:768px){
      .shell { border-radius:16px; }
      #closetPreviewFrame {
        max-width:100%;
        height: 650px;
        padding:10px 0;
        background-size: cover;
        background-position: center;
      }
      #closetPreviewInner {
        max-width:360px;
        height:100%;
      }
    }

    /* ========== FEMALE HAIR â€“ STRAIGHT ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_blonde{
      transform-origin:center top; --scale:0.50; --offset-x:0%; --offset-y:-12%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_blonde{
      transform-origin:center top; --scale:0.50; --offset-x:0%; --offset-y:-12%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_brown{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_brown{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_copper{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-22%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_copper{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-22%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-21%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-21%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:-20%;
    }

body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_black{
  transform-origin:center top; --scale:.20; --offset-x:0%; --offset-y:-20%;
}
body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_black{
  transform-origin:center top; --scale:.20; --offset-x:0%; --offset-y:-20%;
}
    /* ========== FEMALE HAIR â€“ WAVY ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_blonde{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_blonde{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_brown{
      transform-origin:center top; --scale:0.99; --offset-x:1%; --offset-y:-36%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_brown{
      transform-origin:center top; --scale:0.99; --offset-x:1%; --offset-y:-36%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_copper{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_copper{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_ginger{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_pastel_blue{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-21%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_pastel_pink{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-21%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_wavy_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_wavy_pastel_purple{
      transform-origin:center top; --scale:0.60; --offset-x:-1%; --offset-y:-20%;
    }



    
body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_hair_straight_black{
  transform-origin:center top; --scale:.75; --offset-x:0%; --offset-y:-20%;
}
body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_hair_straight_black{
  transform-origin:center top; --scale:.75; --offset-x:0%; --offset-y:-20%;
}

    /* ========== TOPS ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.75; --offset-x:0%; --offset-y:-12%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.65; --offset-x:0%; --offset-y:-6%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.67; --offset-x:-1%; --offset-y:0%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.60; --offset-x:0%; --offset-y:4.8%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_top_bikini_red{
      transform-origin:center top; --scale:0.37; --offset-x:-1%; --offset-y:38%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_top_bikini_red{
      transform-origin:center top; --scale:0.35; --offset-x:0%; --offset-y:41%;
    }

    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.85; --offset-x:0%; --offset-y:-15%;
    }
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_top_tank{
      transform-origin:center top; --scale:0.85; --offset-x:0%; --offset-y:-15%;
    }

    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.90; --offset-x:0%; --offset-y:-7%;
    }
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_top_tee{
      transform-origin:center top; --scale:0.90; --offset-x:0%; --offset-y:-4%;
    }

    /* ========== BOTTOMS ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_bottom_shorts{
      transform-origin:center top; --scale:.58; --offset-x:-1%; --offset-y:44%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_bottom_shorts{
      transform-origin:center top; --scale:.48; --offset-x:-0%; --offset-y:56%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_bottom_skirt{
      transform-origin:center top; --scale:.60; --offset-x:-0%; --offset-y:30%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_bottom_skirt{
      transform-origin:center top; --scale:.55; --offset-x:-0%; --offset-y:36%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_bottom_bikini_red{
      transform-origin:center top; --scale:.83; --offset-x:-1%; --offset-y:10%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_bottom_bikini_red{
      transform-origin:center top; --scale:.75; --offset-x:-0%; --offset-y:16%;
    }

    /* ========== JEWELRY ========== */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_necklace{
      transform-origin:center top; --scale:.35; --offset-x:0%; --offset-y:07%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_necklace{
      transform-origin:center top; --scale:.35; --offset-x:0%; --offset-y:09%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_belly{
      transform-origin:center top; --scale:.15; --offset-x:0%; --offset-y:250%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_belly{
      transform-origin:center top; --scale:.15; --offset-x:0%; --offset-y:250%;
    }

    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_ears.layer-left{
      transform-origin:center top; --scale:0.20; --offset-x: -46%; --offset-y: 29%;
    }
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-f_jewel_ears.layer-right{
      transform-origin:center top; --scale:0.20; --offset-x: 46%; --offset-y: 29%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_ears.layer-left{
      transform-origin:center top; --scale:0.20; --offset-x:-46%; --offset-y:32%;
    }
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-f_jewel_ears.layer-right{
      transform-origin:center top; --scale:0.20; --offset-x:46%; --offset-y:32%;
    }

    body[data-gender="male"][data-skin="light"] .layer-overlay.item-m_jewel_necklace{
      transform-origin:center top; --scale:1; --offset-x:0%; --offset-y:0%;
    }
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-m_jewel_necklace{
      transform-origin:center top; --scale:1; --offset-x:0%; --offset-y:0%;
    }

    
    /* ========== SHOES ========== */
    /* FEMALE LIGHT - LEFT SHOE */
    body[data-gender="female"][data-skin="light"] .layer-overlay.layer-shoes-left {
      transform-origin: center center;
      --scale-light: 0.36;
      --offset-x-light: -28%;
      --offset-y-light: 140%;
      --rotate-light: 0deg;
    }

    /* FEMALE LIGHT - RIGHT SHOE */
    body[data-gender="female"][data-skin="light"] .layer-overlay.layer-shoes-right {
      transform-origin: center center;
      --scale-light: 0.36;
      --offset-x-light: 23%;
      --offset-y-light: 140%;
      --rotate-light: 0deg;
    }

    /* FEMALE DARK - LEFT SHOE */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.layer-shoes-left {
      transform-origin: center center;
      --scale-dark: 0.34;
      --offset-x-dark: -30%;
      --offset-y-dark: 142%;
      --rotate-dark: 0deg;
    }

    /* FEMALE DARK - RIGHT SHOE */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.layer-shoes-right {
      transform-origin: center center;
      --scale-dark: 0.34;
      --offset-x-dark: 25%;
      --offset-y-dark: 142%;
      --rotate-dark: 0deg;
    }

    /* MALE LIGHT - LEFT SHOE */
    body[data-gender="male"][data-skin="light"] .layer-overlay.layer-shoes-left {
      transform-origin: center center;
      --scale-light: 0.52;
      --offset-x-light: -25%;
      --offset-y-light: 86%;
      --rotate-light: 0deg;
    }

    /* MALE LIGHT - RIGHT SHOE */
    body[data-gender="male"][data-skin="light"] .layer-overlay.layer-shoes-right {
      transform-origin: center center;
      --scale-light: 0.52;
      --offset-x-light: 22%;
      --offset-y-light: 86%;
      --rotate-light: 0deg;
    }

    /* MALE DARK - LEFT SHOE */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.layer-shoes-left {
      transform-origin: center center;
      --scale-dark: 0.52;
      --offset-x-dark: -25%;
      --offset-y-dark: 86%;
      --rotate-dark: 0deg;
    }

    /* MALE DARK - RIGHT SHOE */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.layer-shoes-right {
      transform-origin: center center;
      --scale-dark: 0.52;
      --offset-x-dark: 25%;
      --offset-y-dark: 86%;
      --rotate-dark: 0deg;
    }
    /*EYES*/
    /* ========== EYES ========== */
    /* FEMALE LIGHT - LEFT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: -375%;
      --offset-y-light: 1018%;
    }

    /* FEMALE LIGHT - RIGHT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="female"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: 323%;
      --offset-y-light: 1020%;
    }

    /* FEMALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -265%;
      --offset-y-dark: 1108%;
    }

    /* FEMALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 383%;
      --offset-y-dark: 1108%;
    }

    /* MALE LIGHT - LEFT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: -405%;
      --offset-y-light: 968%;
    }

    /* MALE LIGHT - RIGHT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-light: 0.01;
      --offset-x-light: 393%;
      --offset-y-light: 970%;
    }

    /* MALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -295%;
      --offset-y-dark: 978%;
    }

    /* MALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 523%;
      --offset-y-dark: 978%;
    }

    /* FEMALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -265%;
      --offset-y-dark: 1108%;
    }

    /* FEMALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="female"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 383%;
      --offset-y-dark: 1108%;
    }

 /* MALE LIGHT - LEFT EYE (ADJUSTED) */
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-left,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-left,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-left {
  transform-origin: center top;
  --scale-light: 0.01;
  --offset-x-light: -405%;
  --offset-y-light: 968%;
}

/* MALE LIGHT - RIGHT EYE (ADJUSTED) */
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_blue.layer-right,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_green.layer-right,
body[data-gender="male"][data-skin="light"] .layer-overlay.item-u_eyes_brown.layer-right {
  transform-origin: center top;
  --scale-light: 0.01;
  --offset-x-light: 393%;
  --offset-y-light: 970%;
}

    /* MALE DARK - LEFT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-left,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-left {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: -295%;
      --offset-y-dark: 978%;
    }

    /* MALE DARK - RIGHT EYE (ADJUSTED) */
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_blue.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_green.layer-right,
    body[data-gender="male"][data-skin="dark"] .layer-overlay.item-u_eyes_brown.layer-right {
      transform-origin: center top;
      --scale-dark: 0.01;
      --offset-x-dark: 523%;
      --offset-y-dark: 978%;
    }
  </style>
</head>
<body data-no-global-carrie="true" data-gender="female" data-skin="light">
  <header class="px-4 py-4">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg?v=15"
             alt="8BFR logo"
             class="h-9 w-auto"
             onerror="this.onerror=null;this.src='assets/images/8bfr.png?v=15'">
        <div>
          <h1 class="text-xl sm:text-2xl font-extrabold">
            <span class="text-[#a855f7]">Carrie Closet</span>
            <span class="text-xs sm:text-sm font-semibold align-middle ml-1 text-emerald-300/80">beta</span>
          </h1>
          <p class="text-[11px] text-purple-300/80 -mt-0.5">
            Dress your AI avatar for BF / GF chat and future upgrades.
          </p>
        </div>
      </div>
      <div class="flex flex-col items-end gap-1">
        <a href="carrie-chat.html"
           class="text-[#00d9ff] text-[11px] sm:text-xs underline/50 hover:underline">
          â¬… Back to Carrie Chat
        </a>
        <span class="pill-tag pill-tag-soft text-[10px]">
          <span>ðŸª™</span> Coins shop connects from here later
        </span>
      </div>
    </div>
  </header>
  
  <main class="max-w-6xl mx-auto px-4 pb-10 pt-5">
    <div class="shell p-4 sm:p-5 lg:p-6">
      <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
        <!-- LEFT: Preview + base controls -->
        <section class="lg:w-[60%] space-y-4">
          <div class="flex items-center justify-between gap-2">
            <div class="flex flex-wrap items-center gap-2">
              <span class="pill-tag text-[10px]">
                ðŸ§¬ Avatar Preview
              </span>
              <span id="closetPreviewLabel" class="text-[11px] text-purple-200/80">
                Female â€¢ Light skin â€¢ Bikini base
              </span>
            </div>
            <span class="text-[10px] text-purple-200/80">
              BF / GF chat only
            </span>
          </div>
  
          <div id="closetPreviewFrame">
            <div id="closetPreviewInner">
              <img id="closetBaseImg"
                   src="assets/images/base/female/base_female_light.png?v=15"
                   alt="Avatar base">
              <div id="closetOverlayHost"></div>
            </div>
          </div>
  
          <div class="space-y-3 mt-2">
            <!-- Gender -->
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span class="uppercase tracking-[0.16em] text-[9px] text-purple-200/75">
                  Gender
                </span>
              </div>
              <div class="flex gap-2">
                <button type="button"
                        class="seg-btn active"
                        data-gender="female">
                  â™€ Female
                </button>
                <button type="button"
                        class="seg-btn"
                        data-gender="male">
                  â™‚ Male
                </button>
              </div>
            </div>
  
            <!-- Skin tone -->
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span class="uppercase tracking-[0.16em] text-[9px] text-purple-200/75">
                  Skin tone
                </span>
              </div>
              <div id="skinToneButtons" class="flex flex-wrap gap-2">
                <!-- Filled by JS -->
              </div>
            </div>
          </div>
  
          <p class="mt-3 text-[11px] text-purple-200/80">
            Female/Dark eyes & shoes are perfect. Others need adjusting. Test each combination!
          </p>
        </section>
  
        <!-- RIGHT: Filters + items -->
        <section class="lg:flex-1 space-y-3">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div class="flex flex-wrap items-center gap-2">
              <span class="pill-tag text-[10px]">
                ðŸ›’ Closet Items
              </span>
              <span id="closetGenderLabel" class="text-[11px] text-purple-200/85">
                Showing items for <b>Female</b> avatar
              </span>
            </div>
          </div>
  
          <!-- Category tabs -->
          <div class="flex flex-wrap gap-2 mt-1">
            <button type="button" class="tab-btn active" data-cat="hair">Hair</button>
            <button type="button" class="tab-btn" data-cat="top">Tops</button>
            <button type="button" class="tab-btn" data-cat="bottom">Bottoms</button>
            <button type="button" class="tab-btn" data-cat="jewelry">Jewelry</button>
            <button type="button" class="tab-btn" data-cat="eyes">Eyes</button>
            <button type="button" class="tab-btn" data-cat="shoes">Shoes</button>
            <button type="button" class="tab-btn" data-cat="all">All</button>
          </div>
  
          <!-- Error / empty messages -->
          <div id="closetError" class="hidden mt-2 text-red-50 text-[11px]">
            Closet data failed to load. Please check carrie-closet-data.js.
          </div>
  
          <div id="closetEmpty" class="hidden mt-2 text-purple-100/90 text-[11px]">
            No items for this category yet. Try switching categories or gender.
          </div>
  
          <!-- Items grid -->
          <div id="closetItemsGrid" class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2.5">
            <!-- JS will inject cards -->
          </div>
  
          <p class="mt-3 text-[10px] text-purple-300/75">
            In the full release, each item will cost 8BFR coins and connect to your
            <a href="coinshop.html" class="underline text-sky-300 hover:text-sky-200">Coin Shop</a>.
            For now this is a visual beta so you can design outfits without charging coins.
          </p>
        </section>
      </div>
    </div>
  
    <p class="mt-4 text-[11px] text-purple-300/70 text-center max-w-3xl mx-auto">
      Default male base has shorts and no shirt. Default female base uses a bikini.
      Tops, bottoms, hair, eyes, jewelry, and shoes layer over those bases.
    </p>
  </main>

  <!-- Embedded Data + Logic (same as before) -->
  <script src="https://cdn.jsdelivr.net/npm/[email protected]/dist/papaparse.min.js"></script>
  <script>
// carrie-closet-data.js
(function() {
  const base = "assets/images";
  function item(opts) {
    return Object.assign({
      id: "", gender: "female", category: "hair", cat: "hair", slot: "hair",
      name: "", label: "", coins: 0, img: "", imgLeft: "", imgRight: "", imgDark: ""
    }, opts);
  }

  const items = [
    item({ id: "f_hair_straight_blonde", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Blonde", label: "straight â€¢ blonde", coins: 20, img: base + "/hair/straight/female_straight_blonde.png" }),
    item({ id: "f_hair_straight_brown", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Brown", label: "straight â€¢ brown", coins: 15, img: base + "/hair/straight/female_straight_brown.png" }),
    item({ id: "f_hair_straight_copper", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Copper", label: "straight â€¢ copper", coins: 22, img: base + "/hair/straight/female_straight_copper.png" }),
    item({ id: "f_hair_straight_ginger", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Ginger", label: "straight â€¢ ginger", coins: 22, img: base + "/hair/straight/female_straight_ginger.png" }),
    item({ id: "f_hair_straight_pastel_blue", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Pastel Blue", label: "straight â€¢ pastel blue", coins: 25, img: base + "/hair/straight/female_straight_pastel_blue.png" }),
    item({ id: "f_hair_straight_pastel_pink", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Pastel Pink", label: "straight â€¢ pastel pink", coins: 25, img: base + "/hair/straight/female_straight_pastel_pink.png" }),
    item({ id: "f_hair_straight_pastel_purple", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Pastel Purple", label: "straight â€¢ pastel purple", coins: 25, img: base + "/hair/straight/female_straight_pastel_purple.png" }),
    item({ id: "f_hair_straight_black", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Straight Black", label: "straight â€¢ black", coins: 15, img: base + "/hair/straight/female_straight_black.png" }),
    item({ id: "f_hair_wavy_blonde", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Blonde", label: "wavy â€¢ blonde", coins: 20, img: base + "/hair/wavy/female_wavy_blonde.png" }),
    item({ id: "f_hair_wavy_brown", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Brown", label: "wavy â€¢ brown", coins: 15, img: base + "/hair/wavy/female_wavy_brown.png" }),
    item({ id: "f_hair_wavy_copper", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Copper", label: "wavy â€¢ copper", coins: 22, img: base + "/hair/wavy/female_wavy_copper.png" }),
    item({ id: "f_hair_wavy_ginger", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Ginger", label: "wavy â€¢ ginger", coins: 22, img: base + "/hair/wavy/female_wavy_ginger.png" }),
    item({ id: "f_hair_wavy_pastel_blue", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Pastel Blue", label: "wavy â€¢ pastel blue", coins: 25, img: base + "/hair/wavy/female_wavy_pastel_blue.png" }),
    item({ id: "f_hair_wavy_pastel_pink", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Pastel Pink", label: "wavy â€¢ pastel pink", coins: 25, img: base + "/hair/wavy/female_wavy_pastel_pink.png" }),
    item({ id: "f_hair_wavy_pastel_purple", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Pastel Purple", label: "wavy â€¢ pastel purple", coins: 25, img: base + "/hair/wavy/female_wavy_pastel_purple.png" }),
    item({ id: "f_hair_wavy_black", gender: "female", category: "hair", cat: "hair", slot: "hair", name: "Wavy Black", label: "wavy â€¢ black", coins: 18, img: base + "/hair/wavy/female_wavy_black.png" }),
    item({ id: "u_top_tank", gender: "unisex", category: "top", cat: "top", slot: "top", name: "8BFR Tank Top", label: "unisex tank", coins: 15, img: base + "/unisex/cloths/unisex_tank-top_v1.png" }),
    item({ id: "u_top_tee", gender: "unisex", category: "top", cat: "top", slot: "top", name: "8BFR Tee", label: "unisex tee", coins: 15, img: base + "/unisex/cloths/unisex_tee-shirt.png" }),
    item({ id: "f_top_bikini_red", gender: "female", category: "top", cat: "top", slot: "top", name: "Red Bikini Top", label: "bikini top â€¢ red", coins: 12, img: base + "/female_cloths/female_bikini-top_red.png" }),
    item({ id: "f_bottom_shorts", gender: "female", category: "bottom", cat: "bottom", slot: "bottom", name: "Denim Shorts", label: "female shorts", coins: 15, img: base + "/female_cloths/female_shorts.png" }),
    item({ id: "f_bottom_skirt", gender: "female", category: "bottom", cat: "bottom", slot: "bottom", name: "Mini Skirt", label: "female skirt", coins: 18, img: base + "/female_cloths/female_skirt.png" }),
    item({ id: "f_bottom_bikini_red", gender: "female", category: "bottom", cat: "bottom", slot: "bottom", name: "Red Bikini Bottom", label: "bikini bottom â€¢ red", coins: 12, img: base + "/female_cloths/female_bikini-bottom_redv2.png", imgDark: base + "/female_cloths/female_bikini-bottom_red_dark.png" }),
    item({ id: "f_jewel_necklace", gender: "female", category: "jewelry", cat: "jewelry", slot: "necklace", name: "Gold Necklace", label: "necklace", coins: 20, img: base + "/female_jewlery/female_gold_necklace.png", imgDark: base + "/female_jewlery/female_gold_necklace.png" }),
    item({ id: "f_jewel_belly", gender: "female", category: "jewelry", cat: "jewelry", slot: "belly", name: "Belly Ring", label: "belly ring", coins: 15, img: base + "/female_jewlery/female_belly-ring.png" }),
    item({ id: "f_jewel_ears", gender: "female", category: "jewelry", cat: "jewelry", slot: "ears", name: "Gold Earrings", label: "ear rings", coins: 18, img: base + "/female_jewlery/female_gold_ear-ring_left.png", imgLeft: base + "/female_jewlery/female_gold_ear-ring_left.png", imgRight: base + "/female_jewlery/female_gold_ear-ring_right.png" }),
    item({ id: "u_eyes_blue", gender: "unisex", category: "eyes", cat: "eyes", slot: "eyes", name: "Blue Eyes", label: "blue", coins: 10, img: base + "/unisex/eyes/unisex_eyes_blue_left.png", imgLeft: base + "/unisex/eyes/unisex_eyes_blue_left.png", imgRight: base + "/unisex/eyes/unisex_eyes_blue_right.png" }),
    item({ id: "u_eyes_green", gender: "unisex", category: "eyes", cat: "eyes", slot: "eyes", name: "Green Eyes", label: "green", coins: 10, img: base + "/unisex/eyes/unisex_eyes_green_left.png", imgLeft: base + "/unisex/eyes/unisex_eyes_green_left.png", imgRight: base + "/unisex/eyes/unisex_eyes_green_right.png" }),
    item({ id: "u_eyes_brown", gender: "unisex", category: "eyes", cat: "eyes", slot: "eyes", name: "Brown Eyes", label: "brown", coins: 10, img: base + "/unisex/eyes/unisex_eyes_brown_left.png", imgLeft: base + "/unisex/eyes/unisex_eyes_brown_left.png", imgRight: base + "/unisex/eyes/unisex_eyes_brown_right.png" }),
    item({ id: "u_shoes_sneakers", gender: "unisex", category: "shoes", cat: "shoes", slot: "shoes", name: "Sneakers", label: "unisex shoes", coins: 14, img: base + "/unisex/shoes/unisex_shoes_left.png", imgLeft: base + "/unisex/shoes/unisex_shoes_left.png", imgRight: base + "/unisex/shoes/unisex_shoes_right.png" })
  ];

  window.CARRIE_CLOSET_ITEMS = items;
})();
  </script>
  
  <script>
// carrie-closet.js - Main closet logic  
(function() {
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  const grid = $("#closetItemsGrid");
  const emptyMsg = $("#closetEmpty");
  const errBox = $("#closetError");
  const overlayHost = $("#closetOverlayHost");
  const previewLabel = $("#closetPreviewLabel");
  const closetGenderLabel = $("#closetGenderLabel");
  const skinToneButtons = $("#skinToneButtons");

  let currentGender = localStorage.getItem('closet_gender') || "female";
  let currentSkin = localStorage.getItem('closet_skin') || "light";
  let currentCat = "hair";

  const equippedSets = {
    female: { hair: null, top: null, bottom: null, eyes: null, shoes: null, necklace: null, ears: null, belly: null },
    male: { hair: null, top: null, bottom: null, eyes: null, shoes: null, necklace: null, ears: null, belly: null }
  };

  let equipped = equippedSets[currentGender];
  const zBySlot = { shoes: 10, bottom: 30, belly: 35, top: 40, necklace: 45, eyes: 50, ears: 55, hair: 60 };

  function safeItems() {
    const items = window.CARRIE_CLOSET_ITEMS;
    return Array.isArray(items) ? items : null;
  }

  function setBaseImage() {
    const baseImg = $("#closetBaseImg");
    if (baseImg) {
      baseImg.src = `assets/images/base/${currentGender}/base_${currentGender}_${currentSkin}.png?v=15`;
    }
  }

  function updateLabels() {
    const gLabel = currentGender === "female" ? "Female" : "Male";
    const sLabel = currentSkin === "light" ? "Light skin" : "Dark skin";
    if (previewLabel) previewLabel.textContent = `${gLabel} â€¢ ${sLabel} â€¢ Bikini base`;
    if (closetGenderLabel) closetGenderLabel.innerHTML = `Showing items for <b>${gLabel}</b> avatar`;
  }

  function buildSkinButtons() {
    if (!skinToneButtons) return;
    skinToneButtons.innerHTML = "";
    const skins = [
      { key: "light", label: "â˜€ï¸ Light" },
      { key: "dark", label: "ðŸŒ™ Dark" }
    ];
    skins.forEach(s => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "seg-btn" + (currentSkin === s.key ? " active" : "");
      btn.textContent = s.label;
      btn.dataset.skin = s.key;
      btn.addEventListener("click", () => {
        currentSkin = s.key;
        localStorage.setItem('closet_skin', currentSkin);
        document.body.dataset.skin = currentSkin;
        $$("#skinToneButtons .seg-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        setBaseImage();
        updateLabels();
        renderOverlays();
      });
      skinToneButtons.appendChild(btn);
    });
  }

  function filterItems(items) {
    return items.filter(it => {
      const gOK = it.gender === "unisex" || it.gender === currentGender;
      if (!gOK) return false;
      if (currentCat === "all") return true;
      return it.category === currentCat || it.cat === currentCat;
    });
  }

  function cardForItem(itemObj) {
    const card = document.createElement("div");
    card.className = "closet-item-card";

    const thumbWrap = document.createElement("div");
    thumbWrap.className = "closet-item-thumb";
    const t = document.createElement("img");
    t.src = itemObj.img;
    t.alt = itemObj.name || itemObj.id;
    thumbWrap.appendChild(t);

    const meta = document.createElement("div");
    meta.className = "flex-1 min-w-0";
    const title = document.createElement("div");
    title.className = "text-[12px] font-semibold truncate";
    title.textContent = itemObj.name || itemObj.id;
    const sub = document.createElement("div");
    sub.className = "text-[10px] text-purple-200/70 truncate";
    sub.textContent = itemObj.label || itemObj.category;
    meta.appendChild(title);
    meta.appendChild(sub);

    card.appendChild(thumbWrap);
    card.appendChild(meta);

    const slot = itemObj.slot;
    const isOn = equipped[slot] && equipped[slot].id === itemObj.id;
    if (isOn) card.classList.add("active");

    card.addEventListener("click", () => {
      if (equipped[slot] && equipped[slot].id === itemObj.id) {
        equipped[slot] = null;
      } else {
        equipped[slot] = itemObj;
      }
      renderItems();
      renderOverlays();
      saveEquipped();
    });

    return card;
  }

  function saveEquipped() {
    const saveData = {};
    Object.keys(equipped).forEach(slot => {
      if (equipped[slot]) saveData[slot] = equipped[slot].id;
    });
    localStorage.setItem(`closet_equipped_${currentGender}`, JSON.stringify(saveData));
  }

  function loadEquipped() {
    const saved = localStorage.getItem(`closet_equipped_${currentGender}`);
    if (!saved) return;
    
    try {
      const saveData = JSON.parse(saved);
      const items = safeItems();
      if (!items) return;
      
      Object.keys(saveData).forEach(slot => {
        const itemId = saveData[slot];
        const itemObj = items.find(it => it.id === itemId);
        if (itemObj) equipped[slot] = itemObj;
      });
    } catch (e) {
      console.error("Error loading saved outfit:", e);
    }
  }

  function renderItems() {
    const items = safeItems();
    if (!items || !grid) {
      if (errBox) errBox.classList.remove("hidden");
      return;
    }
    const list = filterItems(items);
    grid.innerHTML = "";
    if (list.length === 0) {
      if (emptyMsg) emptyMsg.classList.remove("hidden");
    } else {
      if (emptyMsg) emptyMsg.classList.add("hidden");
      list.forEach(it => grid.appendChild(cardForItem(it)));
    }
  }

  function clearOverlays() {
    if (!overlayHost) return;
    overlayHost.innerHTML = "";
  }

  function addOverlayImg(itemObj) {
    if (!overlayHost || !itemObj) return;
    const slot = itemObj.slot;

    if (slot === "eyes") {
      const left = document.createElement("img");
      left.src = itemObj.imgLeft || itemObj.img;
      left.className = `layer-overlay layer-left item-${itemObj.id}`;
      left.style.zIndex = zBySlot.eyes;

      const right = document.createElement("img");
      right.src = itemObj.imgRight || itemObj.img;
      right.className = `layer-overlay layer-right item-${itemObj.id}`;
      right.style.zIndex = zBySlot.eyes;

      overlayHost.appendChild(left);
      overlayHost.appendChild(right);
      return;
    }

    if (slot === "ears") {
      const left = document.createElement("img");
      left.src = itemObj.imgLeft || itemObj.img;
      left.className = `layer-overlay layer-left item-${itemObj.id}`;
      left.style.zIndex = zBySlot.ears;

      const right = document.createElement("img");
      right.src = itemObj.imgRight || itemObj.img;
      right.className = `layer-overlay layer-right item-${itemObj.id}`;
      right.style.zIndex = zBySlot.ears;

      overlayHost.appendChild(left);
      overlayHost.appendChild(right);
      return;
    }

    if (slot === "shoes") {
      const left = document.createElement("img");
      left.src = itemObj.imgLeft || itemObj.img;
      left.className = `layer-overlay layer-shoes-left item-${itemObj.id}`;
      left.style.zIndex = zBySlot.shoes;

      const right = document.createElement("img");
      right.src = itemObj.imgRight || itemObj.img;
      right.className = `layer-overlay layer-shoes-right item-${itemObj.id}`;
      right.style.zIndex = zBySlot.shoes;

      overlayHost.appendChild(left);
      overlayHost.appendChild(right);
      return;
    }

    const img = document.createElement("img");
    if (currentSkin === "dark" && itemObj.imgDark) {
      img.src = itemObj.imgDark;
    } else {
      img.src = itemObj.img;
    }
    img.className = `layer-overlay item-${itemObj.id}`;
    img.style.zIndex = zBySlot[slot] || 20;
    overlayHost.appendChild(img);
  }

  function renderOverlays() {
    clearOverlays();
    Object.keys(equipped).forEach(slot => {
      if (equipped[slot]) addOverlayImg(equipped[slot]);
    });
  }

  function initTabs() {
    $$(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        $$(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentCat = btn.dataset.cat || "hair";
        renderItems();
      });
    });
  }

  function initGenderButtons() {
    $$(".seg-btn[data-gender]").forEach(btn => {
      btn.addEventListener("click", () => {
        $$(".seg-btn[data-gender]").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentGender = btn.dataset.gender === "male" ? "male" : "female";
        localStorage.setItem('closet_gender', currentGender);
        document.body.dataset.gender = currentGender;
        equipped = equippedSets[currentGender];
        loadEquipped();
        setBaseImage();
        updateLabels();
        renderItems();
        renderOverlays();
      });
    });
  }

  function init() {
    const items = safeItems();
    if (!items) {
      if (errBox) errBox.classList.remove("hidden");
      return;
    }
    if (errBox) errBox.classList.add("hidden");

    document.body.dataset.gender = currentGender;
    document.body.dataset.skin = currentSkin;

    initTabs();
    initGenderButtons();
    buildSkinButtons();
    
    $$(".seg-btn[data-gender]").forEach(btn => {
      if (btn.dataset.gender === currentGender) {
        btn.classList.add("active");
      } else {
        btn.classList.remove("active");
      }
    });
    
    setBaseImage();
    updateLabels();
    loadEquipped();
    renderItems();
    renderOverlays();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
  </script>
</body>
</html>
```
