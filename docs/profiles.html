
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>All Profiles - 8BFR Music Network</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { padding-bottom: 70px; background: linear-gradient(#0b0014, #000); }
    .profile-card { 
      background: rgba(12,6,24,0.7); 
      border: 1px solid rgba(124,58,237,0.35); 
      border-radius: 16px; 
      padding: 1.5rem; 
      transition: all 0.3s ease; 
      cursor: pointer; 
    }
    .profile-card:hover { 
      border-color: #7c3aed; 
      transform: translateY(-4px); 
      box-shadow: 0 4px 20px rgba(124,58,237,0.35); 
    }
    .profile-avatar { 
      width: 80px; 
      height: 80px; 
      border-radius: 50%; 
      background: linear-gradient(135deg, #7c3aed, #a855f7); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 2rem; 
      margin-bottom: 1rem; 
    }
    .badge { 
      background: rgba(12,0,25,0.9); 
      border: 1px solid #7c3aed; 
      padding: 0.3rem 0.6rem; 
      border-radius: 12px; 
      font-size: 0.75rem; 
      display: inline-block;
      margin: 0.2rem;
    }
    .badge.founder { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2)); border-color: rgba(245, 158, 11, 0.5); color: #f59e0b; }
    .filter-btn { 
      background: rgba(12,0,25,0.9); 
      color: #eae6ff; 
      border: 1px solid rgba(124,58,237,0.35); 
      padding: 0.5rem 1rem; 
      border-radius: 8px; 
      cursor: pointer; 
      transition: all 0.3s ease; 
      font-size: 0.9rem;
      font-weight: 600;
    }
    .filter-btn.active { background: #7c3aed; border-color: #7c3aed; }
    .filter-btn:hover { border-color: #7c3aed; }
    
    .hamburger { display: none; cursor: pointer; flex-direction: column; gap: 5px; padding: 0.5rem; z-index: 1001; position: relative; }
    .hamburger span { width: 28px; height: 3px; background: #b47cff; border-radius: 2px; transition: all 0.3s ease; }
    .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
    .hamburger.active span:nth-child(2) { opacity: 0; }
    .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }
    .nav-menu { display: flex; gap: 1rem; flex-wrap: wrap; }
    .nav-menu li { list-style: none; }
    .nav-menu a { color: #a8c7ff; text-decoration: none; font-weight: 600; transition: color 0.3s ease; }
    .nav-menu a:hover { color: #00d9ff; }
    .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0, 0, 0, 0.8); opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 999; }
    .menu-overlay.active { opacity: 1; pointer-events: all; }
    
    @media (max-width: 768px) {
      .hamburger { display: flex; }
      .nav-menu { position: fixed; top: 0; right: -100%; width: 80%; max-width: 320px; height: 100vh; background: linear-gradient(135deg, #1a0033, #0a0014); flex-direction: column; padding: 6rem 2rem 2rem; transition: right 0.3s ease; z-index: 1000; border-left: 2px solid #5a00c8; }
      .nav-menu.active { right: 0; }
      .nav-menu li { margin-bottom: 1.5rem; }
    }
  </style>
</head>
<body>

  <header id="top" style="background: linear-gradient(90deg, #320054, #120014); border-bottom: 2px solid #5a00c8; box-shadow: 0 0 25px rgba(112, 0, 255, 0.25); padding: 1.5rem 1rem;">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg" alt="8BFR logo" class="h-10 w-auto" onerror="this.onerror=null;this.src='assets/images/8bfr.png'">
        <div>
          <h1 style="font-family: 'Bebas Neue', cursive; font-size: 1.8rem; letter-spacing: 2px; background: linear-gradient(90deg, #9F00FF, #00A3FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            8BFR MUSIC NETWORK
          </h1>
          <p class="text-xs text-purple-300/80 -mt-1">All Profiles</p>
        </div>
      </div>
      
      <div class="hamburger" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </div>
      
      <nav>
        <ul class="nav-menu">
          <li><a href="index.html">üè† Home</a></li>
          <li><a href="profile.html">üë§ My Profile</a></li>
          <li><a href="profiles.html">üë• All Profiles</a></li>
          <li><a href="feed.html">üì∞ Feed</a></li>
          <li><a href="radio.html">üìª Radio</a></li>
          <li><a href="contact.html">‚úâÔ∏è Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="menu-overlay" onclick="toggleMenu()"></div>

  <div class="max-w-6xl mx-auto px-4 mt-5">
    <input type="text" id="searchBox" placeholder="üîç Search by username..." 
           class="w-full p-4 bg-[rgba(12,6,24,0.7)] border border-purple-500/40 rounded-lg text-white mb-4"
           style="font-family: 'Work Sans', sans-serif;"
           oninput="searchProfiles()">
    
    <div class="flex gap-2 mb-4 flex-wrap">
      <button class="filter-btn active" onclick="filterProfiles('all')">All</button>
      <button class="filter-btn" onclick="filterProfiles('artist')">üé§ Artists</button>
      <button class="filter-btn" onclick="filterProfiles('beatmaker')">üéöÔ∏è Beatmakers</button>
      <button class="filter-btn" onclick="filterProfiles('producer')">üéß Producers</button>
      <button class="filter-btn" onclick="filterProfiles('verified')">üõ°Ô∏è Verified</button>
      <button class="filter-btn" onclick="filterProfiles('founder')">‚ö° Founders</button>
    </div>

    <div class="text-center mb-4" style="color: #b47cff; font-size: 1.1rem; font-weight: 600;">
      <span id="profileCount">Loading...</span>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="profilesGrid">
      <p class="col-span-full text-center text-purple-300/60 py-8">Loading profiles...</p>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    let allProfiles = [];
    let currentFilter = 'all';

    function toggleMenu() {
      document.querySelector('.nav-menu').classList.toggle('active');
      document.querySelector('.hamburger').classList.toggle('active');
      document.querySelector('.menu-overlay').classList.toggle('active');
    }

    async function loadProfiles() {
      const { data, error } = await supabase.from('profiles').select('*').order('created_at', { ascending: false });
      
      if (error) {
        alert('Error loading profiles: ' + error.message);
        return;
      }
      
      allProfiles = data || [];
      displayProfiles(allProfiles);
    }

    function displayProfiles(profiles) {
      const grid = document.getElementById('profilesGrid');
      document.getElementById('profileCount').textContent = profiles.length + ' profiles found';

      if (profiles.length === 0) {
        grid.innerHTML = '<p class="col-span-full text-center text-purple-300/60 py-8">No profiles found</p>';
        return;
      }

      const badgeIcons = {
        'artist': 'üé§', 'beatmaker': 'üéöÔ∏è', 'producer': 'üéß', 'verified': 'üõ°Ô∏è',
        'founder': '‚ö°', 'owner': 'üëë', 'admin': '‚öôÔ∏è', 'mod': 'üí¨', 'g7': 'üëë'
      };

      grid.innerHTML = profiles.map(p => {
        const roles = p.roles_ordered || p.tags || [];
        const primaryRole = roles[0] || 'user';
        
        const badgesHtml = roles.slice(0, 5).map(role => {
          const css = role === 'founder' ? 'founder' : '';
          return `<span class="badge ${css}">${badgeIcons[role] || 'üè∑Ô∏è'} ${role}</span>`;
        }).join('');
        
        return `
          <div class="profile-card" onclick="window.location.href='profile.html?id=${p.user_id}'">
            <div class="profile-avatar">${badgeIcons[primaryRole] || 'üë§'}</div>
            <h3 class="text-lg font-bold mb-1" style="color: #eae6ff;">${p.username || 'Unknown'}</h3>
            <div class="text-purple-400 text-sm mb-2">${primaryRole.toUpperCase()}${p.verified_artist ? ' üõ°Ô∏è' : ''}</div>
            ${p.bio ? `<p class="text-purple-200/70 text-sm mb-3">${p.bio.substring(0, 100)}...</p>` : ''}
            <div class="mb-3">${badgesHtml}</div>
            <div class="text-xs text-purple-400/60">Joined ${new Date(p.created_at).toLocaleDateString()}</div>
          </div>
        `;
      }).join('');
    }

    function filterProfiles(filter) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      currentFilter = filter;
      
      let filtered = allProfiles;
      
      if (filter === 'verified') {
        filtered = allProfiles.filter(p => p.verified_artist);
      } else if (filter !== 'all') {
        filtered = allProfiles.filter(p => {
          const roles = p.roles_ordered || p.tags || [];
          return roles.includes(filter);
        });
      }
      
      displayProfiles(filtered);
    }

    function searchProfiles() {
      const q = document.getElementById('searchBox').value.toLowerCase();
      
      if (!q) {
        filterProfiles(currentFilter);
        return;
      }
      
      let filtered = allProfiles;
      
      if (currentFilter === 'verified') {
        filtered = filtered.filter(p => p.verified_artist);
      } else if (currentFilter !== 'all') {
        filtered = filtered.filter(p => {
          const roles = p.roles_ordered || p.tags || [];
          return roles.includes(currentFilter);
        });
      }
      
      filtered = filtered.filter(p => {
        const username = (p.username || '').toLowerCase();
        const bio = (p.bio || '').toLowerCase();
        return username.includes(q) || bio.includes(q);
      });
      
      displayProfiles(filtered);
    }

    loadProfiles();
  </script>
  <script src="scripts.js" defer></script>
</body>
</html>
