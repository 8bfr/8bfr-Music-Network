
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>All Profiles - 8BFR Music Network</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { padding-bottom: 70px; }
    .profile-card { background: rgba(12,6,24,0.7); border: 1px solid rgba(124,58,237,0.35); border-radius: 16px; padding: 1.5rem; transition: all 0.3s ease; cursor: pointer; }
    .profile-card:hover { border-color: #7c3aed; transform: translateY(-4px); box-shadow: 0 4px 20px rgba(124,58,237,0.35); }
    .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a855f7); display: flex; align-items: center; justify-content: center; font-size: 2rem; margin-bottom: 1rem; }
    .badge { background: rgba(12,0,25,0.9); border: 1px solid #7c3aed; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.75rem; }
    .filter-btn { background: rgba(12,0,25,0.9); color: #eae6ff; border: 1px solid rgba(124,58,237,0.35); padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; }
    .filter-btn.active { background: #7c3aed; border-color: #7c3aed; }
    #debugBox { position: fixed; top: 10px; right: 10px; background: black; border: 2px solid yellow; padding: 10px; max-width: 300px; max-height: 400px; overflow-y: auto; font-size: 11px; color: yellow; z-index: 9999; }
  </style>
</head>
<body>
  <div id="debugBox"></div>

  <header id="top" class="px-4 py-4">
    <div class="max-w-6xl mx-auto flex items-end justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg" alt="8BFR logo" class="h-10 w-auto" onerror="this.onerror=null;this.src='assets/images/8bfr.png'">
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold">üë• ALL PROFILES</h1>
          <p class="text-xs sm:text-sm text-purple-300/80 -mt-1">Browse all creators</p>
        </div>
      </div>
      <a href="index.html" class="text-[#00d9ff] underline/50 hover:underline">Home</a>
    </div>
  </header>

  <div class="max-w-6xl mx-auto px-4 mt-5">
    <input type="text" id="searchBox" placeholder="üîç Search..." class="w-full p-4 bg-[rgba(12,6,24,0.7)] border border-purple-500/40 rounded-lg text-white mb-4" oninput="searchProfiles()">
    
    <div class="flex gap-2 mb-4 flex-wrap">
      <button class="filter-btn active" onclick="filterByRole('all')">All</button>
      <button class="filter-btn" onclick="filterByRole('artist')">üé§ Artists</button>
      <button class="filter-btn" onclick="filterByRole('beatmaker')">üéöÔ∏è Beatmakers</button>
      <button class="filter-btn" onclick="filterByRole('verified')">üõ°Ô∏è Verified</button>
    </div>

    <div class="text-center mb-4 text-purple-300">
      <span id="profileCount">0</span> profiles found
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="profilesGrid">
      <p class="col-span-full text-center text-yellow-300 py-8">Loading...</p>
    </div>
  </div>

  <script>
    const DEBUG = document.getElementById('debugBox');
    function log(msg) {
      DEBUG.innerHTML += msg + '<br>';
      DEBUG.scrollTop = DEBUG.scrollHeight;
    }

    const SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    let allProfiles = [];

    async function init() {
      log('Loading profiles...');
      const { data, error } = await supabase.from('profiles').select('*');
      
      if (error) {
        log('ERROR: ' + error.message);
        document.getElementById('profilesGrid').innerHTML = '<p class="col-span-full text-red-400">Error: ' + error.message + '</p>';
        return;
      }
      
      log('Got ' + (data?.length || 0) + ' profiles');
      if (data && data.length > 0) {
        log('Sample: ' + data[0].username);
      }
      
      allProfiles = data || [];
      displayProfiles(allProfiles);
    }

    function displayProfiles(profiles) {
      const grid = document.getElementById('profilesGrid');
      document.getElementById('profileCount').textContent = profiles.length;

      if (profiles.length === 0) {
        grid.innerHTML = '<p class="col-span-full text-center text-purple-300/60 py-8">No profiles</p>';
        return;
      }

      grid.innerHTML = profiles.map(p => `
        <div class="profile-card">
          <div class="profile-avatar">üë§</div>
          <h3 class="text-lg font-bold">${p.username || 'Unknown'}</h3>
          <div class="text-purple-400 text-sm">${p.role || 'user'}</div>
        </div>
      `).join('');
    }

    function filterByRole(role) {
      log('Filter: ' + role);
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      
      const filtered = role === 'all' ? allProfiles : allProfiles.filter(p => p.role === role || p.tags?.includes(role));
      log('Showing ' + filtered.length);
      displayProfiles(filtered);
    }

    function searchProfiles() {
      const q = document.getElementById('searchBox').value.toLowerCase();
      log('Search: ' + q);
      if (!q) { displayProfiles(allProfiles); return; }
      
      const filtered = allProfiles.filter(p => 
        (p.username || '').toLowerCase().includes(q) ||
        (p.role || '').toLowerCase().includes(q)
      );
      log('Found ' + filtered.length);
      displayProfiles(filtered);
    }

    init();
  </script>
</body>
</html>
