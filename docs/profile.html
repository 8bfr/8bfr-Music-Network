<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - 8BFR Music Network</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #ffaa00;
            --secondary: #ff8800;
            --dark: #0a0a0a;
            --dark-card: #1a1a1a;
            --success: #00ff88;
            --text: #ffffff;
            --border: #333333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Work Sans', sans-serif; background: var(--dark); color: var(--text); line-height: 1.6; }
        .header { background: linear-gradient(135deg, var(--dark-card), #000); border-bottom: 2px solid var(--primary); padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-family: 'Bebas Neue', cursive; font-size: 2rem; background: linear-gradient(90deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        .card { background: var(--dark-card); border: 1px solid var(--border); border-radius: 8px; padding: 2rem; margin-bottom: 1.5rem; }
        .card h2 { color: var(--primary); margin-bottom: 1rem; font-family: 'Bebas Neue', cursive; font-size: 1.8rem; }
        .profile-header { display: flex; gap: 2rem; align-items: center; margin-bottom: 2rem; }
        .avatar { width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 3rem; }
        .profile-info h3 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .badges { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; }
        .badge { background: var(--dark); border: 1px solid var(--primary); padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.85rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group textarea { width: 100%; padding: 0.75rem; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-family: 'Work Sans', sans-serif; }
        .btn { background: var(--primary); color: white; border: none; padding: 0.75rem 2rem; border-radius: 4px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; margin-right: 0.5rem; }
        .btn:hover { background: var(--secondary); transform: translateY(-2px); }
        .btn-secondary { background: var(--secondary); }
        .music-upload { display: none; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üë§ MY PROFILE</h1>
        <a href="index.html" class="btn btn-secondary">üè† Home</a>
    </div>

    <div class="container">
        <div class="card">
            <div class="profile-header">
                <div class="avatar" id="profileAvatar">üë§</div>
                <div class="profile-info">
                    <h3 id="profileUsername">Loading...</h3>
                    <p id="profileRole" style="color: var(--primary);"></p>
                    <div class="badges" id="profileBadges"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Edit Profile</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="editUsername">
                </div>
                <div class="form-group">
                    <label>Display Name:</label>
                    <input type="text" id="editDisplayName">
                </div>
            </div>
            <div class="form-group">
                <label>Bio:</label>
                <textarea id="editBio" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="editEmail">
            </div>
            <button class="btn" onclick="saveProfile()">üíæ Save Changes</button>
        </div>

        <!-- Show only for artists/beatmakers -->
        <div class="card music-upload" id="musicUploadSection">
            <h2>üéµ Music Upload</h2>
            <div class="form-group">
                <label>Track Title:</label>
                <input type="text" id="trackTitle">
            </div>
            <div class="form-group">
                <label>Music File:</label>
                <input type="file" id="musicFile" accept="audio/*">
            </div>
            <button class="btn" onclick="uploadMusic()">üì§ Upload Track</button>
        </div>

        <!-- Show only for verified artists/beatmakers -->
        <div class="card music-upload" id="verificationSection">
            <h2>üõ°Ô∏è Verification Status</h2>
            <p id="verificationStatus">Not Verified</p>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let currentUser = null;

        async function init() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            currentUser = user;
            loadProfile();
        }

        async function loadProfile() {
            const { data: profile } = await supabase.from('profiles').select('*').eq('user_id', currentUser.id).single();
            
            if (!profile) {
                alert('Profile not found');
                return;
            }

            document.getElementById('profileUsername').textContent = profile.username || 'No Username';
            document.getElementById('profileRole').textContent = profile.role?.toUpperCase() || 'USER';
            document.getElementById('editUsername').value = profile.username || '';
            document.getElementById('editDisplayName').value = profile.display_name || '';
            document.getElementById('editBio').value = profile.bio || '';
            document.getElementById('editEmail').value = profile.email || '';

            // Display badges
            const badgeIcons = {
                'artist': 'üé§', 'beatmaker': 'üéöÔ∏è', 'producer': 'üéß', 'verified': 'üõ°Ô∏è',
                'donor': 'üí∞', 'vip_member': 'üéñÔ∏è', 'founder': '‚ö°'
            };
            
            const tags = profile.tags || [];
            const badgesHtml = tags.map(tag => `<span class="badge">${badgeIcons[tag] || 'üè∑Ô∏è'} ${tag}</span>`).join('');
            document.getElementById('profileBadges').innerHTML = badgesHtml || '<span style="color: #999;">No badges</span>';

            // Show music upload for artists/beatmakers
            if (tags.includes('artist') || tags.includes('beatmaker')) {
                document.getElementById('musicUploadSection').style.display = 'block';
            }

            // Show verification status
            if (tags.includes('artist') || tags.includes('beatmaker')) {
                document.getElementById('verificationSection').style.display = 'block';
                document.getElementById('verificationStatus').innerHTML = profile.verified_artist ? 
                    '<span style="color: var(--success);">‚úÖ Verified Artist/Beatmaker</span>' : 
                    '<span style="color: #999;">‚è≥ Not Verified</span>';
            }
        }

        async function saveProfile() {
            const username = document.getElementById('editUsername').value;
            const displayName = document.getElementById('editDisplayName').value;
            const bio = document.getElementById('editBio').value;
            const email = document.getElementById('editEmail').value;

            await supabase.from('profiles').update({
                username,
                display_name: displayName,
                bio,
                email
            }).eq('user_id', currentUser.id);

            alert('‚úÖ Profile updated!');
            loadProfile();
        }

        async function uploadMusic() {
            alert('Music upload feature coming soon!');
        }

        init();
    </script>
</body>
</html>
