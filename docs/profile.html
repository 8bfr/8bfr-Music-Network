
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Profile - 8BFR Music Network</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { padding-bottom: 70px; }
    .profile-header { background: rgba(12,6,24,0.7); border: 1px solid rgba(124,58,237,0.35); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
    .profile-avatar { width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed, #a855f7); display: flex; align-items: center; justify-content: center; font-size: 3rem; margin-bottom: 1rem; }
    .badge { background: rgba(12,0,25,0.9); border: 1px solid #7c3aed; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.85rem; margin: 0.25rem; display: inline-block; }
    .card { background: rgba(12,6,24,0.7); border: 1px solid rgba(124,58,237,0.35); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
    .btn { background: #7c3aed; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
    .btn:hover { background: #6d28d9; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
    .form-group input, .form-group textarea { width: 100%; padding: 0.75rem; background: rgba(12,0,25,0.9); border: 1px solid rgba(124,58,237,0.35); border-radius: 4px; color: white; }
  </style>
</head>
<body>

  <header id="top" class="px-4 py-4">
    <div class="max-w-6xl mx-auto flex items-end justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg" alt="8BFR logo" class="h-10 w-auto" onerror="this.onerror=null;this.src='assets/images/8bfr.png'">
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold">üë§ MY PROFILE</h1>
          <p class="text-xs sm:text-sm text-purple-300/80 -mt-1">View and edit your profile</p>
        </div>
      </div>
      <a href="index.html" class="text-[#00d9ff] underline/50 hover:underline">Home</a>
    </div>
  </header>

  <div class="max-w-6xl mx-auto px-4 mt-5">
    
    <!-- Profile Display -->
    <div class="profile-header">
      <div class="flex gap-6 items-start flex-wrap">
        <div class="profile-avatar" id="profileAvatar">üë§</div>
        <div class="flex-1">
          <h2 class="text-3xl font-bold mb-2" id="profileUsername">Loading...</h2>
          <p class="text-purple-400 mb-2" id="profileRole"></p>
          <p class="text-purple-200/80 mb-4" id="profileBio"></p>
          <div id="profileBadges"></div>
        </div>
      </div>
    </div>

    <!-- Edit Profile Card -->
    <div class="card">
      <h2 class="text-2xl font-bold mb-4 text-purple-400">‚úèÔ∏è Edit Profile</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-group">
          <label>Username:</label>
          <input type="text" id="editUsername">
        </div>
        <div class="form-group">
          <label>Display Name:</label>
          <input type="text" id="editDisplayName">
        </div>
      </div>
      <div class="form-group">
        <label>Bio:</label>
        <textarea id="editBio" rows="4"></textarea>
      </div>
      <div class="form-group">
        <label>Email:</label>
        <input type="email" id="editEmail">
      </div>
      <button class="btn" onclick="saveProfile()">üíæ Save Changes</button>
    </div>

    <!-- Artist Features (if has artist badge) -->
    <div class="card" id="artistSection" style="display:none;">
      <h2 class="text-2xl font-bold mb-4 text-purple-400">üé§ Artist Tools</h2>
      <p class="text-purple-200/80">Music upload and management features coming soon!</p>
    </div>

    <!-- Beatmaker Features (if has beatmaker badge) -->
    <div class="card" id="beatmakerSection" style="display:none;">
      <h2 class="text-2xl font-bold mb-4 text-purple-400">üéöÔ∏è Beatmaker Tools</h2>
      <p class="text-purple-200/80">Beat upload and licensing features coming soon!</p>
    </div>

  </div>

  <script>
    const SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    let currentUser = null;

    async function init() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        window.location.href = 'login.html';
        return;
      }
      currentUser = user;
      await loadProfile();
    }

    async function loadProfile() {
      const { data: profile, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('user_id', currentUser.id)
        .single();
      
      if (error || !profile) {
        alert('Profile not found!');
        return;
      }

      // Display profile
      document.getElementById('profileUsername').textContent = profile.username || 'No Username';
      document.getElementById('profileRole').textContent = (profile.role || 'user').toUpperCase();
      document.getElementById('profileBio').textContent = profile.bio || 'No bio yet';
      
      // Fill edit form
      document.getElementById('editUsername').value = profile.username || '';
      document.getElementById('editDisplayName').value = profile.display_name || '';
      document.getElementById('editBio').value = profile.bio || '';
      document.getElementById('editEmail').value = profile.email || '';

      // Display badges
      const badgeIcons = {
        'artist': 'üé§', 'beatmaker': 'üéöÔ∏è', 'producer': 'üéß', 'owner': 'üëë',
        'g7': 'üëë', 'admin': '‚öôÔ∏è', 'mod': 'üí¨', 'verified': 'üõ°Ô∏è',
        'founder': '‚ö°', 'vip_member': 'üéñÔ∏è', 'rapper': 'üé§', 'songwriter': 'üéº',
        'engineer': 'üéõÔ∏è', '8bfrfan': 'üü£', 'beta_tester': 'üß™', 'early_supporter': 'üé´'
      };
      
      const tags = profile.tags || [];
      const badgesHtml = tags.map(tag => 
        `<span class="badge">${badgeIcons[tag] || 'üè∑Ô∏è'} ${tag}</span>`
      ).join('');
      document.getElementById('profileBadges').innerHTML = badgesHtml || '<span class="text-purple-300/50">No badges</span>';

      // Show role-specific sections
      if (tags.includes('artist')) {
        document.getElementById('artistSection').style.display = 'block';
      }
      if (tags.includes('beatmaker')) {
        document.getElementById('beatmakerSection').style.display = 'block';
      }
    }

    async function saveProfile() {
      const username = document.getElementById('editUsername').value;
      const displayName = document.getElementById('editDisplayName').value;
      const bio = document.getElementById('editBio').value;
      const email = document.getElementById('editEmail').value;

      if (!username) {
        alert('Username is required');
        return;
      }

      const { error } = await supabase
        .from('profiles')
        .update({
          username,
          display_name: displayName,
          bio,
          email
        })
        .eq('user_id', currentUser.id);

      if (error) {
        alert('Error: ' + error.message);
      } else {
        alert('‚úÖ Profile updated!');
        loadProfile();
      }
    }

    init();
  </script>
  <script src="scripts.js" defer></script>
</body>
</html>
 
