<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Item Shop â€” 8BFR Music Network</title>
  <link rel="icon" href="assets/images/favicon.png?v=15">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="carrie-closet-data.js?v=3"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.30), transparent 60%),
        radial-gradient(900px 400px at 110% 10%, rgba(0,217,255,.22), transparent 60%),
        linear-gradient(#050011,#000);
      color: #eae6ff;
      margin: 0;
      min-height: 100vh;
    }
    
    header {
      background: rgba(10,0,25,.96);
      border-bottom: 1px solid rgba(124,58,237,.5);
      box-shadow: 0 18px 40px rgba(0,0,0,.7);
    }
    
    .tab-btn {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,255,.35);
      background: rgba(15,23,42,.8);
      cursor: pointer;
      color: #e5e7eb;
      transition: all .12s ease;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      border-color: #38bdf8;
      background: radial-gradient(circle at 0 0, #38bdf8, #6366f1);
      color: #0f172a;
    }
    
    .item-card {
      background: rgba(15,23,42,.96);
      border: 1px solid rgba(124,58,237,.4);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.15s ease;
      cursor: pointer;
    }
    
    .item-card:hover {
      transform: translateY(-2px);
      border-color: #a855f7;
      box-shadow: 0 0 0 1px rgba(129,140,248,.85), 0 0 20px rgba(124,58,237,.6);
    }
    
    .item-card.owned {
      border-color: #22c55e;
      opacity: 0.6;
      cursor: default;
    }
    
    .item-img {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 8px;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 0.75rem;
      position: relative;
    }
    
    .item-img img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    
    .price-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      background: rgba(168,85,247,.2);
      border: 1px solid rgba(168,85,247,.5);
      border-radius: 999px;
      padding: 0.25rem 0.5rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: #a855f7;
    }
    
    .owned-badge {
      background: rgba(34,197,94,.2);
      border: 1px solid rgba(34,197,94,.6);
      color: #22c55e;
    }
  </style>
</head>
<body>
  <header class="px-4 py-4">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg?v=15"
             alt="8BFR logo"
             class="h-9 w-auto"
             onerror="this.onerror=null;this.src='assets/images/8bfr.png?v=15'">
        <div>
          <h1 class="text-xl sm:text-2xl font-extrabold">
            <span class="text-[#a855f7]">Item Shop</span>
          </h1>
          <p class="text-[11px] text-purple-300/80 -mt-0.5">
            Browse and buy avatar items with your 8BFR coins
          </p>
        </div>
      </div>
      <div class="flex flex-col items-end gap-1">
        <a href="https://8bfr.github.io/8bfr-Music-Network/index.html"
           class="text-[#00d9ff] text-[11px] sm:text-xs underline/50 hover:underline">
          â¬… Back to Home
        </a>
        <div style="font-size:11px; color:#a855f7;">
          Balance: <span id="coinBalance" style="font-weight:700;">0</span> <img src="assets/images/icon_8bfr_coin.png" style="width:1em; height:1em; display:inline-block; vertical-align:middle;">
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-10 pt-6">
    <!-- Category Tabs -->
    <div class="flex flex-wrap gap-2 mb-6">
      <button type="button" class="tab-btn active" data-cat="all">All Items</button>
      <button type="button" class="tab-btn" data-cat="hair">Hair</button>
      <button type="button" class="tab-btn" data-cat="top">Tops</button>
      <button type="button" class="tab-btn" data-cat="bottom">Bottoms</button>
      <button type="button" class="tab-btn" data-cat="jewelry">Jewelry</button>
      <button type="button" class="tab-btn" data-cat="eyes">Eyes</button>
      <button type="button" class="tab-btn" data-cat="shoes">Shoes</button>
    </div>

    <!-- Gender Filter -->
    <div class="flex gap-2 mb-6">
      <button type="button" class="tab-btn active" data-gender="all">All</button>
      <button type="button" class="tab-btn" data-gender="female">Female</button>
      <button type="button" class="tab-btn" data-gender="male">Male</button>
      <button type="button" class="tab-btn" data-gender="unisex">Unisex</button>
    </div>

    <!-- Items Grid -->
    <div id="itemsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
      <!-- Populated by JavaScript -->
    </div>

    <!-- Links -->
    <div class="mt-10 flex flex-wrap justify-center gap-4">
      <a href="coinshop.html" class="text-[#00d9ff] text-sm underline hover:opacity-80">
        <img src="assets/images/icon_8bfr_coin.png" style="width:1em; height:1em; display:inline-block; vertical-align:middle;"> Buy More Coins
      </a>
      <a href="carrie-chat.html" class="text-[#00d9ff] text-sm underline hover:opacity-80">
        ðŸ’¬ Back to Chat
      </a>
    </div>
  </main>

  <script>
    let currentCategory = "all";
    let currentGender = "all";
    let coins = parseInt(localStorage.getItem("carrieCoins_v1") || "0");
    let ownedItems = JSON.parse(localStorage.getItem("carrieOwnedItems_v1") || "[]");

    function updateCoinDisplay() {
      document.getElementById("coinBalance").textContent = coins.toLocaleString();
    }

    function filterItems() {
      const items = window.CARRIE_CLOSET_ITEMS || [];
      
      return items.filter(item => {
        // Category filter
        const categoryToSlot = {
          "hair": "hair",
          "top": "top",
          "bottom": "bottom",
          "jewelry": ["necklace", "ears", "belly"],
          "eyes": "eyes",
          "shoes": "shoes"
        };
        
        let categoryMatch = true;
        if (currentCategory !== "all") {
          const slots = categoryToSlot[currentCategory];
          if (Array.isArray(slots)) {
            categoryMatch = slots.includes(item.slot);
          } else {
            categoryMatch = item.slot === slots;
          }
        }
        
        // Gender filter
        let genderMatch = true;
        if (currentGender !== "all") {
          genderMatch = item.gender === currentGender;
        }
        
        return categoryMatch && genderMatch;
      });
    }

    function renderItems() {
      const grid = document.getElementById("itemsGrid");
      const filtered = filterItems();
      
      grid.innerHTML = "";
      
      if (filtered.length === 0) {
        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:3rem; color:#a855f7; opacity:.7;">No items found in this category</div>';
        return;
      }
      
      filtered.forEach(item => {
        const owned = ownedItems.includes(item.id);
        const card = document.createElement("div");
        card.className = "item-card" + (owned ? " owned" : "");
        
        card.innerHTML = `
          <div class="item-img">
            <img src="${item.img}" alt="${item.name}">
          </div>
          <div style="font-size:0.85rem; font-weight:600; margin-bottom:0.5rem; color:#e5e7eb;">${item.name}</div>
          <div style="display:flex; justify-content:space-between; align-items:center;">
            ${owned 
              ? '<span class="price-tag owned-badge">âœ… Owned</span>'
              : `<span class="price-tag">${item.price} <img src="assets/images/icon_8bfr_coin.png" style="width:1em; height:1em; display:inline-block; vertical-align:middle;"></span>`
            }
          </div>
        `;
        
        if (!owned) {
          card.addEventListener("click", () => purchaseItem(item));
        }
        
        grid.appendChild(card);
      });
    }

    function purchaseItem(item) {
      if (ownedItems.includes(item.id)) {
        alert("You already own this item!");
        return;
      }
      
      if (coins < item.price) {
        if (confirm(`Not enough coins! You need ${item.price} coins but only have ${coins}. Buy more coins?`)) {
          window.location.href = "coinshop.html";
        }
        return;
      }
      
      if (confirm(`Purchase ${item.name} for ${item.price} coins?`)) {
        coins -= item.price;
        ownedItems.push(item.id);
        
        localStorage.setItem("carrieCoins_v1", coins.toString());
        localStorage.setItem("carrieOwnedItems_v1", JSON.stringify(ownedItems));
        
        updateCoinDisplay();
        renderItems();
        
        alert(`âœ… Successfully purchased ${item.name}!`);
      }
    }

    // Category tabs
    document.querySelectorAll('[data-cat]').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('[data-cat]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentCategory = this.dataset.cat;
        renderItems();
      });
    });

    // Gender tabs
    document.querySelectorAll('[data-gender]').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('[data-gender]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentGender = this.dataset.gender;
        renderItems();
      });
    });

    // Initialize
    updateCoinDisplay();
    renderItems();
  </script>
</body>
</html>
