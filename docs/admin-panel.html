<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Panel ‚Äî 8BFR Music Network</title>
<link rel="icon" href="assets/images/favicon.png" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  * { box-sizing: border-box; }
  body {
    background: linear-gradient(#0b0014, #000);
    color: #eae6ff;
    font-family: system-ui, -apple-system, sans-serif;
    margin: 0;
    padding: 0;
  }
  
  .header {
    background: rgba(15, 0, 30, 0.95);
    border-bottom: 1px solid rgba(124, 58, 237, 0.5);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
  }
  
  .admin-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  .section {
    background: rgba(12, 6, 24, 0.8);
    border: 1px solid rgba(124, 58, 237, 0.35);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  .section-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #a855f7;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
    font-size: 0.9rem;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    color: white;
  }
  
  .btn-success {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
  }
  
  .btn-danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
  }
  
  .btn-secondary {
    background: rgba(124, 58, 237, 0.2);
    border: 1px solid rgba(124, 58, 237, 0.5);
    color: #a855f7;
  }
  
  .input-field {
    width: 100%;
    padding: 0.75rem;
    background: rgba(18, 3, 39, 0.8);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 8px;
    color: #fff;
    font-size: 0.95rem;
    margin-bottom: 0.75rem;
  }
  
  .input-field:focus {
    outline: none;
    border-color: #a855f7;
  }
  
  .card {
    background: rgba(12, 6, 24, 0.9);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
  }
  
  .tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  
  .tab {
    padding: 0.6rem 1.2rem;
    background: rgba(124, 58, 237, 0.1);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 8px;
    color: #a855f7;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .tab.active {
    background: rgba(124, 58, 237, 0.3);
    border-color: #a855f7;
  }
  
  .grid-2 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1rem;
  }
</style>
</head>
<body>

<header class="header">
  <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
    <a href="index.html" style="color: #a855f7; text-decoration: none; font-weight: 600;">‚Üê Home</a>
    <h1 style="font-size: 1.25rem; font-weight: 800; background: linear-gradient(135deg, #f59e0b, #d97706); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
      ‚öôÔ∏è Admin Panel
    </h1>
    <div id="adminName" style="font-size: 0.9rem; color: #a855f7;"></div>
  </div>
</header>

<main class="admin-container">
  
  <!-- üìä OVERVIEW -->
  <section class="section">
    <div class="section-title">üìä Admin Overview</div>
    
    <div class="grid-2">
      <div class="card">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì¢</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #a855f7;" id="pendingCount">0</div>
        <div style="font-size: 0.9rem; opacity: 0.8;">Pending Posts</div>
      </div>
      
      <div class="card">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üö©</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #ef4444;" id="flaggedCount">0</div>
        <div style="font-size: 0.9rem; opacity: 0.8;">Flagged Content</div>
      </div>
      
      <div class="card">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üë•</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;" id="userCount">0</div>
        <div style="font-size: 0.9rem; opacity: 0.8;">Total Users</div>
      </div>
      
      <div class="card">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìù</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #00d9ff;" id="postCount">0</div>
        <div style="font-size: 0.9rem; opacity: 0.8;">Total Posts</div>
      </div>
    </div>
  </section>
  
  <!-- üì¢ AD APPROVALS -->
  <section class="section">
    <div class="section-title">üì¢ Ad Approvals</div>
    
    <div id="pendingAdsList"></div>
  </section>
  
  <!-- üõ°Ô∏è CONTENT MODERATION -->
  <section class="section">
    <div class="section-title">üõ°Ô∏è Content Moderation</div>
    
    <div class="tabs">
      <button class="tab active" onclick="switchModTab('flagged')">Flagged Content</button>
      <button class="tab" onclick="switchModTab('pending')">Pending Approval</button>
      <button class="tab" onclick="switchModTab('recent')">Recent Posts</button>
    </div>
    
    <!-- FLAGGED CONTENT -->
    <div id="flaggedContent">
      <div id="flaggedList"></div>
    </div>
    
    <!-- PENDING APPROVAL -->
    <div id="pendingContent" style="display: none;">
      <div id="pendingList"></div>
    </div>
    
    <!-- RECENT POSTS -->
    <div id="recentContent" style="display: none;">
      <div id="recentList"></div>
    </div>
  </section>
  
  <!-- üí¨ CHAT MODERATION -->
  <section class="section">
    <div class="section-title">üí¨ Chat Moderation</div>
    
    <div class="tabs">
      <button class="tab active" onclick="switchChatTab('recent')">Recent Messages</button>
      <button class="tab" onclick="switchChatTab('flagged')">Flagged Messages</button>
      <button class="tab" onclick="switchChatTab('users')">Chat Users</button>
    </div>
    
    <!-- RECENT MESSAGES -->
    <div id="chatRecent">
      <div id="chatRecentList"></div>
    </div>
    
    <!-- FLAGGED MESSAGES -->
    <div id="chatFlagged" style="display: none;">
      <div id="chatFlaggedList"></div>
    </div>
    
    <!-- CHAT USERS -->
    <div id="chatUsers" style="display: none;">
      <input type="text" class="input-field" placeholder="Search chat users..." id="chatUserSearch" onkeyup="searchChatUsers()">
      <div id="chatUsersList"></div>
    </div>
  </section>
  
  <!-- üëÆ MOD MANAGEMENT -->
  <section class="section">
    <div class="section-title">üëÆ Mod Management</div>
    
    <div class="grid-2">
      <div>
        <h3 style="color: #a855f7; font-weight: 600; margin-bottom: 0.75rem;">Current Mods</h3>
        <div id="currentModsList"></div>
      </div>
      
      <div>
        <h3 style="color: #a855f7; font-weight: 600; margin-bottom: 0.75rem;">Add New Mod</h3>
        <input type="text" class="input-field" id="newModUsername" placeholder="Username">
        <button class="btn btn-primary" onclick="addMod()">‚ûï Add as Mod</button>
      </div>
    </div>
  </section>
  
  <!-- üë• USER MANAGEMENT -->
  <section class="section">
    <div class="section-title">üë• User Management</div>
    
    <div class="grid-2">
      <div>
        <h3 style="color: #a855f7; font-weight: 600; margin-bottom: 0.75rem;">Search Users</h3>
        <input type="text" class="input-field" id="userSearch" placeholder="Search by username..." onkeyup="searchUsers()">
        <div id="userSearchResults"></div>
      </div>
      
      <div>
        <h3 style="color: #a855f7; font-weight: 600; margin-bottom: 0.75rem;">Quick Actions</h3>
        
        <button class="btn btn-secondary" onclick="viewBannedUsers()" style="width: 100%; margin-bottom: 0.5rem;">
          üö´ View Banned Users
        </button>
        
        <button class="btn btn-secondary" onclick="viewWarnings()" style="width: 100%; margin-bottom: 0.5rem;">
          ‚ö†Ô∏è View Warnings
        </button>
        
        <button class="btn btn-secondary" onclick="viewReports()" style="width: 100%; margin-bottom: 0.5rem;">
          üìã View Reports
        </button>
      </div>
    </div>
  </section>
  
  <!-- üõç SHOP MODERATION -->
  <section class="section">
    <div class="section-title">üõç Shop Moderation</div>
    
    <div class="tabs">
      <button class="tab active" onclick="switchShopTab('pending')">Pending Items</button>
      <button class="tab" onclick="switchShopTab('flagged')">Flagged Items</button>
      <button class="tab" onclick="switchShopTab('all')">All Items</button>
    </div>
    
    <div id="shopPending">
      <div id="shopPendingList"></div>
    </div>
    
    <div id="shopFlagged" style="display: none;">
      <div id="shopFlaggedList"></div>
    </div>
    
    <div id="shopAll" style="display: none;">
      <div id="shopAllList"></div>
    </div>
  </section>
  
  <!-- üìù ANNOUNCEMENTS -->
  <section class="section">
    <div class="section-title">üìù Create Announcement</div>
    
    <input type="text" class="input-field" id="announcementTitle" placeholder="Announcement title...">
    
    <textarea class="input-field" id="announcementText" placeholder="Announcement message..." style="min-height: 100px;"></textarea>
    
    <select class="input-field" id="announcementType">
      <option value="info">‚ÑπÔ∏è Info</option>
      <option value="update">‚ú® Update</option>
      <option value="warning">‚ö†Ô∏è Warning</option>
      <option value="feature">üéâ New Feature</option>
    </select>
    
    <button class="btn btn-primary" onclick="createAnnouncement()">üì¢ Post Announcement</button>
  </section>
  
  <!-- üìä ACTIVITY LOGS -->
  <section class="section">
    <div class="section-title">üìä Activity Logs</div>
    
    <div id="activityLogs"></div>
  </section>
  
</main>

<script src="scripts.js?v=6" defer></script>

<script>
// Check ADMIN or OWNER access
const currentUser = {
  username: localStorage.getItem('username') || 'Admin',
  role: localStorage.getItem('userRole') || 'guest'
};

if (currentUser.role !== 'owner' && currentUser.role !== 'admin') {
  alert('‚ö†Ô∏è Access Denied - Admin or Owner Only');
  window.location.href = 'index.html';
}

document.getElementById('adminName').textContent = `üë§ ${currentUser.username}`;

// ===== LOAD STATS =====
function loadStats() {
  // Count flagged content
  const flagged = JSON.parse(localStorage.getItem('flagged_content') || '[]');
  document.getElementById('flaggedCount').textContent = flagged.length;
  
  // Count pending content
  const pending = JSON.parse(localStorage.getItem('pending_content') || '[]');
  document.getElementById('pendingCount').textContent = pending.length;
  
  // Count users
  let userCount = 0;
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('profile_')) userCount++;
  }
  document.getElementById('userCount').textContent = userCount;
  
  // Count posts
  const posts = JSON.parse(localStorage.getItem('feed_posts') || '[]');
  document.getElementById('postCount').textContent = posts.length;
}

// ===== CONTENT MODERATION =====
function loadFlaggedContent() {
  const flagged = JSON.parse(localStorage.getItem('flagged_content') || '[]');
  const container = document.getElementById('flaggedList');
  
  if (flagged.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #a855f7; opacity: 0.7;">No flagged content</div>';
    return;
  }
  
  container.innerHTML = flagged.map((item, index) => `
    <div class="card">
      <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 0.75rem;">
        <div style="flex: 1;">
          <div style="font-weight: 700; margin-bottom: 0.25rem;">${item.title || 'Untitled'}</div>
          <div style="font-size: 0.85rem; color: #a855f7;">By: ${item.author || 'Unknown'}</div>
          <div style="font-size: 0.85rem; color: #ef4444; margin-top: 0.5rem;">
            üö© Reason: ${item.reason || 'Not specified'}
          </div>
        </div>
      </div>
      
      <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
        <button class="btn btn-success" onclick="approveContent(${index})">‚úÖ Approve</button>
        <button class="btn btn-secondary" onclick="hideContent(${index})">üëÅÔ∏è Hide (notify owner)</button>
        <button class="btn btn-danger" onclick="removeContent(${index})">üóëÔ∏è Remove</button>
        <button class="btn btn-secondary" onclick="warnUser('${item.author}')">‚ö†Ô∏è Warn User</button>
      </div>
    </div>
  `).join('');
}

function hideContent(index) {
  const flagged = JSON.parse(localStorage.getItem('flagged_content') || '[]');
  const item = flagged[index];
  
  if (!confirm('Hide this content? Owner will be notified.')) return;
  
  // Mark as hidden
  item.hidden = true;
  item.hiddenBy = currentUser.username;
  item.hiddenAt = Date.now();
  
  // Remove from flagged
  flagged.splice(index, 1);
  localStorage.setItem('flagged_content', JSON.stringify(flagged));
  
  // Notify owner
  const notifications = JSON.parse(localStorage.getItem('owner_notifications') || '[]');
  notifications.push({
    type: 'content_hidden',
    action: 'hide_content',
    contentId: item.id,
    contentTitle: item.title || 'Untitled',
    hiddenBy: currentUser.username,
    timestamp: Date.now(),
    read: false
  });
  localStorage.setItem('owner_notifications', JSON.stringify(notifications));
  
  // Log action
  logAction('hide_content', item.id, 'content');
  
  alert('üëÅÔ∏è Content hidden and owner notified');
  loadFlaggedContent();
  loadStats();
}

function approveContent(index) {
  const flagged = JSON.parse(localStorage.getItem('flagged_content') || '[]');
  const item = flagged[index];
  
  if (!confirm('Approve this content?')) return;
  
  // Remove from flagged
  flagged.splice(index, 1);
  localStorage.setItem('flagged_content', JSON.stringify(flagged));
  
  // Log action
  logAction('approve_content', item.id, 'content');
  
  alert('‚úÖ Content approved');
  loadFlaggedContent();
  loadStats();
}

function removeContent(index) {
  const flagged = JSON.parse(localStorage.getItem('flagged_content') || '[]');
  const item = flagged[index];
  
  if (!confirm('Remove this content permanently?')) return;
  
  // Remove from flagged
  flagged.splice(index, 1);
  localStorage.setItem('flagged_content', JSON.stringify(flagged));
  
  // Log action
  logAction('remove_content', item.id, 'content');
  
  alert('üóëÔ∏è Content removed');
  loadFlaggedContent();
  loadStats();
}

function warnUser(username) {
  const reason = prompt('Warning reason:');
  if (!reason) return;
  
  const warnings = JSON.parse(localStorage.getItem('user_warnings') || '[]');
  warnings.push({
    username: username,
    reason: reason,
    issuedBy: currentUser.username,
    timestamp: Date.now()
  });
  localStorage.setItem('user_warnings', JSON.stringify(warnings));
  
  logAction('warn_user', username, 'user');
  
  alert(`‚ö†Ô∏è Warning sent to ${username}`);
}

// ===== USER SEARCH =====
function searchUsers() {
  const query = document.getElementById('userSearch').value.toLowerCase().trim();
  const container = document.getElementById('userSearchResults');
  
  if (!query) {
    container.innerHTML = '';
    return;
  }
  
  const results = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (!key.startsWith('profile_')) continue;
    
    try {
      const profile = JSON.parse(localStorage.getItem(key) || '{}');
      if (profile.name && profile.name.toLowerCase().includes(query)) {
        results.push({ key, ...profile });
      }
    } catch(e) {}
  }
  
  if (results.length === 0) {
    container.innerHTML = '<div style="color: #a855f7; opacity: 0.7; padding: 1rem; font-size: 0.9rem;">No users found</div>';
    return;
  }
  
  container.innerHTML = results.map(user => `
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 700;">${user.name}</div>
          <div style="font-size: 0.85rem; color: #a855f7;">ID: ${user.key}</div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <button class="btn btn-secondary" style="padding: 0.5rem 0.75rem; font-size: 0.8rem;" onclick="viewUserProfile('${user.key}')">View</button>
          <button class="btn btn-danger" style="padding: 0.5rem 0.75rem; font-size: 0.8rem;" onclick="banUser('${user.key}')">Ban</button>
        </div>
      </div>
    </div>
  `).join('');
}

function viewUserProfile(profileKey) {
  const profileId = profileKey.replace('profile_', '');
  window.location.href = `profile.html?id=${profileId}`;
}

function banUser(profileKey) {
  const profile = JSON.parse(localStorage.getItem(profileKey) || '{}');
  
  if (!confirm(`Ban user "${profile.name}"?`)) return;
  
  const banned = JSON.parse(localStorage.getItem('banned_users') || '[]');
  banned.push({
    profileKey: profileKey,
    username: profile.name,
    bannedBy: currentUser.username,
    timestamp: Date.now()
  });
  localStorage.setItem('banned_users', JSON.stringify(banned));
  
  logAction('ban_user', profileKey, 'user');
  
  alert(`üö´ User "${profile.name}" has been banned`);
}

// ===== ANNOUNCEMENTS =====
function createAnnouncement() {
  const title = document.getElementById('announcementTitle').value.trim();
  const text = document.getElementById('announcementText').value.trim();
  const type = document.getElementById('announcementType').value;
  
  if (!title || !text) {
    alert('‚ö†Ô∏è Please fill in title and message');
    return;
  }
  
  const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
  announcements.unshift({
    id: 'ann_' + Date.now(),
    title: title,
    message: text,
    type: type,
    author: currentUser.username,
    timestamp: Date.now()
  });
  localStorage.setItem('announcements', JSON.stringify(announcements));
  
  logAction('create_announcement', title, 'announcement');
  
  alert('üì¢ Announcement posted!');
  
  // Clear form
  document.getElementById('announcementTitle').value = '';
  document.getElementById('announcementText').value = '';
}

// ===== AD APPROVALS =====
function loadPendingAds() {
  const pendingAds = JSON.parse(localStorage.getItem('home_ads_pending') || '[]');
  const container = document.getElementById('pendingAdsList');
  
  if (pendingAds.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #a855f7; opacity: 0.7;">No pending ads</div>';
    return;
  }
  
  container.innerHTML = pendingAds.map((ad, index) => `
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
        <div>
          <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">${ad.title || 'Untitled Ad'}</div>
          <div style="color: #a855f7; font-size: 0.85rem;">By: ${ad.username || 'Unknown'}</div>
        </div>
      </div>
      
      <div style="background: rgba(124, 58, 237, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
        ${ad.imageUrl ? `<img src="${ad.imageUrl}" style="width: 100%; border-radius: 8px; margin-bottom: 0.5rem;">` : ''}
        <div style="font-weight: 700; margin-bottom: 0.25rem;">${ad.title || ''}</div>
        <div style="font-size: 0.9rem; color: #a855f7;">${ad.description || ''}</div>
      </div>
      
      <div style="margin: 1rem 0;">
        <strong style="color: #a855f7;">Duration:</strong> ${ad.hours || 1} hour(s) ($${ad.hours || 1})
      </div>
      
      <textarea id="adMsg_${index}" class="input-field" placeholder="Message to sender (if rejecting)..." style="min-height: 60px;"></textarea>
      
      <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
        <button class="btn btn-success" onclick="approveAd(${index})">‚úÖ Approve</button>
        <button class="btn btn-danger" onclick="rejectAd(${index})">‚ùå Reject</button>
      </div>
    </div>
  `).join('');
}

function approveAd(index) {
  const pending = JSON.parse(localStorage.getItem('home_ads_pending') || '[]');
  const ad = pending[index];
  
  if (!confirm(`Approve ad: "${ad.title}"?`)) return;
  
  // Move to active
  const active = JSON.parse(localStorage.getItem('feed_ads_active') || '[]');
  active.push({
    ...ad,
    startTime: Date.now(),
    endTime: Date.now() + (ad.hours * 60 * 60 * 1000),
    approved: true,
    approvedBy: currentUser.username
  });
  
  // Remove from pending
  pending.splice(index, 1);
  
  localStorage.setItem('feed_ads_active', JSON.stringify(active));
  localStorage.setItem('home_ads_pending', JSON.stringify(pending));
  
  logAction('approve_ad', ad.id, 'ad');
  
  alert('‚úÖ Ad approved!');
  loadPendingAds();
}

function rejectAd(index) {
  const message = document.getElementById(`adMsg_${index}`).value.trim();
  
  if (!message) {
    alert('‚ö†Ô∏è Please enter a message explaining why');
    return;
  }
  
  const pending = JSON.parse(localStorage.getItem('home_ads_pending') || '[]');
  const ad = pending[index];
  
  // Notify user
  const notifications = JSON.parse(localStorage.getItem('user_notifications_' + ad.userId) || '[]');
  notifications.push({
    type: 'ad_rejected',
    title: ad.title,
    message: message,
    from: currentUser.username,
    timestamp: Date.now()
  });
  localStorage.setItem('user_notifications_' + ad.userId, JSON.stringify(notifications));
  
  // Remove from pending
  pending.splice(index, 1);
  localStorage.setItem('home_ads_pending', JSON.stringify(pending));
  
  logAction('reject_ad', ad.id, 'ad');
  
  alert('‚ùå Ad rejected and user notified');
  loadPendingAds();
}

// ===== CHAT MODERATION =====
function loadRecentChat() {
  const messages = JSON.parse(localStorage.getItem('chat_messages') || '[]');
  const container = document.getElementById('chatRecentList');
  
  if (messages.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #a855f7; opacity: 0.7;">No chat messages</div>';
    return;
  }
  
  container.innerHTML = messages.slice(-50).reverse().map((msg, index) => `
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: start;">
        <div style="flex: 1;">
          <div style="font-weight: 700; margin-bottom: 0.25rem;">${msg.username || 'Anonymous'}</div>
          <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">${msg.message || ''}</div>
          <div style="font-size: 0.75rem; color: #a855f7; opacity: 0.7;">
            ${new Date(msg.timestamp).toLocaleString()}
          </div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <button class="btn btn-secondary" style="padding: 0.4rem 0.75rem; font-size: 0.8rem;" onclick="hideChatMessage(${messages.length - 1 - index})">
            üëÅÔ∏è Hide
          </button>
          <button class="btn btn-danger" style="padding: 0.4rem 0.75rem; font-size: 0.8rem;" onclick="kickFromChat('${msg.username}')">
            üö™ Kick
          </button>
          <button class="btn btn-danger" style="padding: 0.4rem 0.75rem; font-size: 0.8rem;" onclick="muteInChat('${msg.username}')">
            üîá Mute
          </button>
        </div>
      </div>
    </div>
  `).join('');
}

function hideChatMessage(index) {
  if (!confirm('Hide this message?')) return;
  
  const messages = JSON.parse(localStorage.getItem('chat_messages') || '[]');
  const msg = messages[index];
  
  msg.hidden = true;
  msg.hiddenBy = currentUser.username;
  localStorage.setItem('chat_messages', JSON.stringify(messages));
  
  logAction('hide_chat_message', msg.id, 'chat');
  
  alert('üëÅÔ∏è Message hidden');
  loadRecentChat();
}

function kickFromChat(username) {
  if (!confirm(`Kick ${username} from chat?`)) return;
  
  const kicked = JSON.parse(localStorage.getItem('chat_kicked') || '[]');
  kicked.push({
    username: username,
    kickedBy: currentUser.username,
    timestamp: Date.now(),
    duration: 3600000 // 1 hour
  });
  localStorage.setItem('chat_kicked', JSON.stringify(kicked));
  
  logAction('kick_chat', username, 'user');
  
  alert(`üö™ ${username} kicked from chat for 1 hour`);
}

function muteInChat(username) {
  if (!confirm(`Mute ${username} in chat?`)) return;
  
  const muted = JSON.parse(localStorage.getItem('chat_muted') || '[]');
  muted.push({
    username: username,
    mutedBy: currentUser.username,
    timestamp: Date.now(),
    permanent: true
  });
  localStorage.setItem('chat_muted', JSON.stringify(muted));
  
  logAction('mute_chat', username, 'user');
  
  alert(`üîá ${username} muted in chat`);
}

function searchChatUsers() {
  const query = document.getElementById('chatUserSearch').value.toLowerCase().trim();
  // Implement chat user search
  alert('Chat user search coming soon');
}

// ===== MOD MANAGEMENT =====
function loadMods() {
  const mods = JSON.parse(localStorage.getItem('site_mods') || '[]');
  const container = document.getElementById('currentModsList');
  
  if (mods.length === 0) {
    container.innerHTML = '<div style="color: #a855f7; opacity: 0.7; font-size: 0.9rem;">No mods assigned</div>';
    return;
  }
  
  container.innerHTML = mods.map((mod, index) => `
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 700;">${mod.username}</div>
          <div style="font-size: 0.85rem; color: #a855f7;">
            Added by ${mod.addedBy} on ${new Date(mod.timestamp).toLocaleDateString()}
          </div>
        </div>
        <button class="btn btn-danger" style="padding: 0.5rem 0.75rem; font-size: 0.8rem;" onclick="removeMod(${index})">
          ‚ùå Remove
        </button>
      </div>
    </div>
  `).join('');
}

function addMod() {
  const username = document.getElementById('newModUsername').value.trim();
  
  if (!username) {
    alert('‚ö†Ô∏è Please enter a username');
    return;
  }
  
  const mods = JSON.parse(localStorage.getItem('site_mods') || '[]');
  
  if (mods.some(m => m.username === username)) {
    alert('‚ö†Ô∏è User is already a mod');
    return;
  }
  
  mods.push({
    username: username,
    addedBy: currentUser.username,
    timestamp: Date.now()
  });
  
  localStorage.setItem('site_mods', JSON.stringify(mods));
  
  // Set user role to mod
  const profileKey = 'profile_' + username.toLowerCase().replace(/\s+/g, '_');
  const profile = JSON.parse(localStorage.getItem(profileKey) || '{}');
  if (profile.name) {
    localStorage.setItem('userRole_' + username, 'mod');
  }
  
  logAction('add_mod', username, 'user');
  
  alert(`‚úÖ ${username} added as mod`);
  document.getElementById('newModUsername').value = '';
  loadMods();
}

function removeMod(index) {
  const mods = JSON.parse(localStorage.getItem('site_mods') || '[]');
  const mod = mods[index];
  
  if (!confirm(`Remove ${mod.username} as mod?`)) return;
  
  mods.splice(index, 1);
  localStorage.setItem('site_mods', JSON.stringify(mods));
  
  // Remove mod role
  localStorage.removeItem('userRole_' + mod.username);
  
  logAction('remove_mod', mod.username, 'user');
  
  alert(`‚ùå ${mod.username} removed as mod`);
  loadMods();
}

// ===== TAB SWITCHING =====
function switchModTab(tab) {
  document.querySelectorAll('#flaggedContent, #pendingContent, #recentContent').forEach(el => el.style.display = 'none');
  
  if (tab === 'flagged') {
    document.getElementById('flaggedContent').style.display = 'block';
    loadFlaggedContent();
  } else if (tab === 'pending') {
    document.getElementById('pendingContent').style.display = 'block';
  } else if (tab === 'recent') {
    document.getElementById('recentContent').style.display = 'block';
  }
}

function switchShopTab(tab) {
  document.querySelectorAll('#shopPending, #shopFlagged, #shopAll').forEach(el => el.style.display = 'none');
  
  if (tab === 'pending') {
    document.getElementById('shopPending').style.display = 'block';
  } else if (tab === 'flagged') {
    document.getElementById('shopFlagged').style.display = 'block';
  } else if (tab === 'all') {
    document.getElementById('shopAll').style.display = 'block';
  }
}

// ===== LOGGING =====
function logAction(action, targetId, targetType) {
  const logs = JSON.parse(localStorage.getItem('admin_activity_log') || '[]');
  
  logs.push({
    action: action,
    targetId: targetId,
    targetType: targetType,
    performedBy: currentUser.username,
    role: currentUser.role,
    timestamp: Date.now()
  });
  
  if (logs.length > 1000) logs.shift();
  localStorage.setItem('admin_activity_log', JSON.stringify(logs));
  
  loadActivityLogs();
}

function loadActivityLogs() {
  const logs = JSON.parse(localStorage.getItem('admin_activity_log') || '[]');
  const container = document.getElementById('activityLogs');
  
  if (logs.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #a855f7; opacity: 0.7;">No activity logged</div>';
    return;
  }
  
  container.innerHTML = logs.slice(-20).reverse().map(log => {
    const date = new Date(log.timestamp).toLocaleString();
    return `
      <div style="background: rgba(124, 58, 237, 0.05); padding: 0.75rem; border-radius: 6px; margin-bottom: 0.5rem; font-size: 0.9rem;">
        <strong>${log.performedBy}</strong> - ${log.action} - ${log.targetType}: ${log.targetId}
        <div style="color: #a855f7; font-size: 0.8rem; opacity: 0.7; margin-top: 0.25rem;">${date}</div>
      </div>
    `;
  }).join('');
}

// ===== INIT =====
loadStats();
loadFlaggedContent();
loadActivityLogs();

// Hide bubbles
window.addEventListener("load", function(){
  setTimeout(function(){
    const idsToHide = ['bubbleStack', 'bubble-top-single', 'carrieWrap', 'carrieBubble', 'carrieToggleBar'];
    idsToHide.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });
    
    const classesToHide = ['.bubble-stack', '.floating-bubbles', '.carrie-bubble', '.bubble-container'];
    classesToHide.forEach(cls => {
      document.querySelectorAll(cls).forEach(el => el.style.display = 'none');
    });
    
    document.querySelectorAll('[data-bubble]').forEach(el => el.style.display = 'none');
    document.querySelectorAll('[data-role="carrie"], [data-carrie]').forEach(el => el.style.display = 'none';
  }, 300);
});
</script>

</body>
</html>
