<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>8BFR Admin Panel ‚Äî Ads & Discounts</title>
<link rel="icon" href="assets/images/favicon.png">
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --ring: rgba(124,58,237,.55);
  --glass: rgba(12,6,24,.70);
}
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(#0b0014,#000);
  color: #eae6ff;
  min-height: 100vh;
  padding-bottom: 50px;
}
header {
  background: rgba(15,0,30,.9);
  border-bottom:1px solid rgba(124,58,237,.5);
  padding: 1rem 2rem;
}
h1,h2,h3 { font-weight: 700; }
.btn {
  display:inline-block;
  background:#120327;
  border:1px solid rgba(124,58,237,.6);
  color:#eae6ff;
  padding:.5rem .8rem;
  border-radius:.75rem;
  text-decoration:none;
  font-size:.9rem;
  transition:all 0.2s;
}
.btn:hover{ background:#190536; }
.btn-primary{ background:#7c3aed; border-color:#7c3aed; color:#fff; }
.btn-primary:hover{ filter:brightness(1.05); }
.admin-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
.admin-table th, .admin-table td { border: 1px solid rgba(124,58,237,.4); padding: 0.6rem; text-align: left; }
.admin-table th { background: rgba(124,58,237,.15); }
textarea { width:100%; padding:.5rem; border-radius:.5rem; background:#0c0618; color:#fff; border:1px solid rgba(124,58,237,.4); }
.modal-bg {
  position: fixed; inset:0; background: rgba(0,0,0,.7);
  display:none; justify-content:center; align-items:center; z-index:50;
}
.modal { background:#0c0618; padding:1.5rem; border-radius:12px; border:1px solid rgba(124,58,237,.5); width:90%; max-width:400px; }
.modal textarea { margin-top:.5rem; }
.modal-buttons { margin-top:1rem; display:flex; justify-content:flex-end; gap:.5rem; }
.ad-preview { width:100px; height:60px; object-fit:cover; border-radius:8px; border:1px solid rgba(124,58,237,.5); }
section { max-width: 6xl; margin:2rem auto; padding:0 1rem; }
</style>
</head>
<body>

<header class="flex justify-between items-center">
  <h1 class="text-2xl">8BFR Admin Panel</h1>
  <a href="index.html" class="btn btn-primary">Back to Home</a>
</header>

<section>
  <h2 class="text-xl mb-2">üñºÔ∏è Manage Ads</h2>
  <table class="admin-table">
    <thead>
      <tr>
        <th>Preview</th>
        <th>Ad Title</th>
        <th>User</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="adsTableBody">
      <!-- Filled dynamically by JS -->
    </tbody>
  </table>
</section>

<section>
  <h2 class="text-xl mb-2">üí∞ Discount Codes</h2>
  <div class="flex gap-2 mb-2">
    <input type="text" id="discountCodeInput" placeholder="Code" class="bg-black/30 px-2 py-1 rounded text-white">
    <input type="number" id="discountPercentInput" placeholder="Discount %" class="bg-black/30 px-2 py-1 rounded text-white w-24">
    <button class="btn btn-primary" onclick="addDiscountCode()">Add Code</button>
  </div>
  <table class="admin-table">
    <thead>
      <tr><th>Code</th><th>Discount %</th><th>Active</th><th>Action</th></tr>
    </thead>
    <tbody id="discountTableBody"></tbody>
  </table>
</section>

<section>
  <h2 class="text-xl mb-2">üõí Buy Ad (Test PayPal)</h2>
  <div id="paypal-button-container"></div>
</section>

<!-- Decline Modal -->
<div id="declineModal" class="modal-bg">
  <div class="modal">
    <h3 class="font-bold">Decline Ad</h3>
    <p>Leave a message for the user:</p>
    <textarea id="declineMessage" rows="4"></textarea>
    <div class="modal-buttons">
      <button class="btn" onclick="closeDeclineModal()">Cancel</button>
      <button class="btn btn-primary" onclick="confirmDecline()">Send</button>
    </div>
  </div>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=AWx0LwdZ_sCyCE5gEj9mL1ha7ZbG_eZLE_R636KjLXFMV1pOfmGwNg9prM5kVKQspvnpNLJDZxPp100G&currency=USD"></script>
<script>
let ads = [
  {id:1,title:"Neon Beats Promo",user:"BeatMaster808",img:"assets/images/ad_banner_1.jpg",status:"pending",message:""},
  {id:2,title:"AI Lyrics Tool",user:"Nova Rae",img:"assets/images/ad_banner_2.jpg",status:"pending",message:""},
];
let discounts = [];

let currentDeclineAd = null;

function renderAds(){
  const tbody = document.getElementById('adsTableBody');
  tbody.innerHTML = '';
  ads.forEach(ad=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><img src="${ad.img}" class="ad-preview"></td>
      <td>${ad.title}</td>
      <td>${ad.user}</td>
      <td>${ad.status}${ad.status==='declined'?`<br><small>${ad.message}</small>`:''}</td>
      <td>
        <button class="btn btn-primary" onclick="approveAd(${ad.id})">Approve</button>
        <button class="btn" onclick="declineAd(${ad.id})">Decline</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function approveAd(id){
  const ad = ads.find(a=>a.id===id);
  if(ad){ ad.status='approved'; ad.message=''; renderAds(); }
}

function declineAd(id){
  currentDeclineAd = ads.find(a=>a.id===id);
  if(currentDeclineAd){
    document.getElementById('declineMessage').value = '';
    document.getElementById('declineModal').style.display='flex';
  }
}

function closeDeclineModal(){ document.getElementById('declineModal').style.display='none'; }

function confirmDecline(){
  if(currentDeclineAd){
    currentDeclineAd.status='declined';
    currentDeclineAd.message = document.getElementById('declineMessage').value;
    currentDeclineAd = null;
    closeDeclineModal();
    renderAds();
  }
}

// Discount code functions
function addDiscountCode(){
  const code = document.getElementById('discountCodeInput').value.trim();
  const percent = parseInt(document.getElementById('discountPercentInput').value);
  if(code && percent>0){
    discounts.push({code,percent,active:true});
    renderDiscounts();
    document.getElementById('discountCodeInput').value='';
    document.getElementById('discountPercentInput').value='';
  }
}

function renderDiscounts(){
  const tbody = document.getElementById('discountTableBody');
  tbody.innerHTML = '';
  discounts.forEach((d,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${d.code}</td><td>${d.percent}%</td><td>${d.active?'Yes':'No'}</td>
      <td><button class="btn" onclick="toggleDiscount(${i})">${d.active?'Disable':'Enable'}</button> <button class="btn btn-primary" onclick="deleteDiscount(${i})">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}

function toggleDiscount(i){ discounts[i].active=!discounts[i].active; renderDiscounts(); }
function deleteDiscount(i){ discounts.splice(i,1); renderDiscounts(); }

renderAds();
renderDiscounts();

// PayPal button
paypal.Buttons({
  style: { color: 'purple', shape: 'rect', label: 'pay' },
  createOrder: function(data, actions) {
    return actions.order.create({
      purchase_units: [{
        amount: { value: '10.00' },
        description: '8BFR Ad Purchase'
      }]
    });
  },
  onApprove: function(data, actions) {
    return actions.order.capture().then(function(details) {
      alert('Transaction completed by '+details.payer.name.given_name);
      // You can move the purchased ad to pending here
    });
  }
}).render('#paypal-button-container');
</script>

</body>
</html>
