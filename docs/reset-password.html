<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reset password — 8BFR</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body{font-family:system-ui;background:#060017;color:#eae6ff;padding:24px}
    .card{max-width:480px;margin:40px auto;padding:20px;border-radius:12px;background:#0c0618;border:1px solid rgba(124,58,237,.25)}
    input,button{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(124,58,237,.2);margin-top:8px}
    button{background:#7c3aed;color:#fff;border-color:#7c3aed;cursor:pointer}
    .note{font-size:0.9rem;color:#dcd4ff;margin-top:10px}
    .error{color:#fecaca;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Reset your password</h2>
    <p class="note">Enter your email to receive a reset link. The link will take you to the change-password page.</p>

    <form id="resetForm" novalidate>
      <input id="email" type="email" required placeholder="you@example.com" />
      <button type="submit">Send reset email</button>
      <p id="msg" class="error" aria-live="polite"></p>
    </form>
  </div>

  <script>
    (function(){
      const SUPABASE_URL = "https://novbuvwpjnxwwvdekjhr.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0";
      const { createClient } = supabase;
      const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const form = document.getElementById('resetForm');
      const emailEl = document.getElementById('email');
      const msg = document.getElementById('msg');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';
        const email = (emailEl.value || '').trim();
        if (!email) { msg.textContent = 'Please enter your email.'; return; }

        try {
          // Ensure this redirect matches where you host change-password.html
          const redirectTo = window.location.origin + '/change-password.html';
          const { error } = await client.auth.resetPasswordForEmail(email, { redirectTo });
          if (error) {
            msg.textContent = error.message || 'Unable to send reset email.';
          } else {
            msg.style.color = 'lightgreen';
            msg.textContent = 'If that email is registered you will receive a reset link shortly.';
          }
        } catch (err) {
          console.error(err);
          msg.textContent = 'Unexpected error — try again later.';
        }
      });
    })();
  </script>
</body>
</html>
