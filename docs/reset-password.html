<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reset password — 8BFR Music Network</title>
  <style>
    :root{ --bg1: #0b0014; --accent: #7c3aed; --glass: rgba(12,6,24,.88); }
    html,body{ height:100%; margin:0; font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:
      radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.35), transparent 60%),
      radial-gradient(900px 400px at 110% 10%, rgba(0,217,255,.22), transparent 60%),
      linear-gradient(#0b0014,#000); color:#eae6ff; }
    .container{ max-width:680px; width:94%; margin:6vh auto; }
    .card{ background:var(--glass); border:1px solid rgba(124,58,237,.18); padding:28px; border-radius:12px; box-shadow:0 8px 40px rgba(0,0,0,.6); }
    h1{ margin:0 0 10px 0; font-size:20px; letter-spacing:.2px; }
    p.lead{ margin:0 0 18px 0; color:#cfc7ff; }
    label{ display:block; margin-bottom:6px; font-size:13px; color:#ded7ff; }
    input[type="email"]{ width:100%; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,.06); background:rgba(255,255,255,.02); color:inherit; box-sizing:border-box; }
    button{ margin-top:12px; padding:10px 14px; background:linear-gradient(90deg,var(--accent),#00d9ff); color:#040014; border:0; border-radius:8px; cursor:pointer; font-weight:600; width:100%; }
    button:disabled{ background:#666; cursor:not-allowed; }
    .muted{ color:#bfb6ff; font-size:13px; margin-top:10px; }
    .error{ color:#ffb4b4; background: rgba(255,80,80,0.06); padding:8px 10px; border-radius:8px; margin-top:12px; }
    .success{ color:#44ff88; background: rgba(68,255,136,0.06); padding:8px 10px; border-radius:8px; margin-top:12px; }
    a.small{ color:#cfc7ff; text-decoration:underline; font-size:13px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Reset your password</h1>
      <p class="lead">Enter your email and we'll send you a link to reset your password.</p>

      <form id="resetForm" novalidate>
        <label for="email">Email</label>
        <input id="email" name="email" type="email" placeholder="you@example.com" required />
        
        <div id="msg" class="success" style="display:none;"></div>
        <div id="error" class="error" style="display:none;"></div>

        <button id="sendBtn" type="submit">Send reset email</button>

        <p class="muted" style="margin-top:18px">
          Already have a reset link? <a class="small" href="change-password.html">Click here</a>
        </p>
      </form>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
    
    const form = document.getElementById('resetForm');
    const emailInput = document.getElementById('email');
    const msg = document.getElementById('msg');
    const err = document.getElementById('error');
    const sendBtn = document.getElementById('sendBtn');

    function showMsg(text) {
      err.style.display = 'none';
      msg.textContent = text;
      msg.style.display = 'block';
    }
    
    function showError(text) {
      msg.style.display = 'none';
      err.textContent = text;
      err.style.display = 'block';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = emailInput.value.trim();
      
      if (!email) {
        showError('Please enter your email address.');
        return;
      }
      
      sendBtn.disabled = true;
      sendBtn.textContent = 'Sending...';
      msg.style.display = 'none';
      err.style.display = 'none';
      
      try {
        // Call Supabase API directly with explicit redirect_to
        const response = await fetch(`${SUPABASE_URL}/auth/v1/recover`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'apikey': SUPABASE_ANON_KEY
          },
          body: JSON.stringify({
            email: email,
            options: {
              redirect_to: 'https://8bfr.github.io/8bfr-Music-Network/change-password.html'
            }
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || errorData.msg || 'Failed to send reset email');
        }
        
        showMsg('✅ Password reset email sent! Check your inbox and click the link to reset your password.');
        emailInput.value = '';
        
      } catch (error) {
        console.error('Reset error:', error);
        showError(error.message || 'An error occurred. Please try again.');
      } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = 'Send reset email';
      }
    });
  </script>
</body>
</html>
