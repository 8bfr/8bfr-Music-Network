<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stories ‚Äî 8BFR Music Network</title>
<meta name="description" content="View stories from the 8BFR community - See what's happening now.">
<link rel="icon" href="assets/images/favicon.png">
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  background: linear-gradient(#0b0014, #000);
  color: #eae6ff;
  font-family: system-ui, -apple-system, sans-serif;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  padding-bottom: 70px;
}

.card {
  border: 1px solid rgba(124, 58, 237, 0.4);
  background: rgba(12, 6, 24, 0.8);
  border-radius: 16px;
  box-shadow: 0 0 24px rgba(124, 58, 237, 0.2);
  padding: 2rem;
  margin-bottom: 2rem;
}

.btn {
  display: inline-block;
  background: #7c3aed;
  border: 1px solid #7c3aed;
  color: #fff;
  padding: 0.75rem 1.5rem;
  border-radius: 0.75rem;
  text-decoration: none;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn:hover {
  background: #6d28d9;
  transform: translateY(-1px);
}

.btn-secondary {
  background: transparent;
  color: #a855f7;
  border: 1px solid rgba(124, 58, 237, 0.6);
}

.btn-secondary:hover {
  background: rgba(124, 58, 237, 0.2);
}

.story-card {
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  cursor: pointer;
  aspect-ratio: 9/16;
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.3), rgba(0, 217, 255, 0.2));
  border: 2px solid transparent;
  transition: all 0.2s;
}

.story-card:hover {
  border-color: #a855f7;
  transform: scale(1.02);
  box-shadow: 0 8px 30px rgba(124, 58, 237, 0.4);
}

.story-card.has-image {
  background-size: cover;
  background-position: center;
}

.story-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.7));
  padding: 1rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.story-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid #fff;
  object-fit: cover;
}

.story-username {
  font-weight: 600;
  font-size: 0.9rem;
  color: #fff;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.story-time {
  font-size: 0.75rem;
  opacity: 0.9;
  color: #fff;
}

.story-views {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.75rem;
  color: #fff;
}

.create-story {
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  cursor: pointer;
  aspect-ratio: 9/16;
  background: linear-gradient(135deg, #7c3aed, #a855f7);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  border: 2px dashed rgba(255, 255, 255, 0.3);
  transition: all 0.2s;
}

.create-story:hover {
  border-color: #fff;
  transform: scale(1.02);
  box-shadow: 0 8px 30px rgba(124, 58, 237, 0.6);
}

.create-story-icon {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
}
</style>
</head>
<body>

<header class="px-4 py-4 bg-[rgba(15,0,30,.95)] border-b border-purple-500/40 sticky top-0 z-50 backdrop-blur-md">
  <div class="max-w-6xl mx-auto flex items-center justify-between">
    <a href="index.html" class="btn-secondary btn">‚Üê Home</a>
    <h1 class="text-xl font-bold">Stories</h1>
    <a href="story-upload.html" class="btn" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
      ‚ûï Create
    </a>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8">
  
  <!-- Hero -->
  <div style="text-align: center; margin-bottom: 3rem;">
    <div style="font-size: 3.5rem; margin-bottom: 1rem;">üì∏</div>
    <h2 style="font-size: 2rem; font-weight: bold; margin-bottom: 0.75rem; text-shadow: 0 0 20px rgba(168, 85, 247, 0.6);">
      Community Stories
    </h2>
    <p style="font-size: 1.1rem; opacity: 0.9; max-width: 600px; margin: 0 auto;">
      See what's happening right now in the 8BFR community
    </p>
  </div>

  <!-- Stories Grid -->
  <div id="storiesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    <!-- Stories loaded dynamically -->
  </div>

  <!-- Empty State -->
  <div id="emptyState" style="display: none; text-align: center; padding: 4rem 2rem;">
    <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">üì≠</div>
    <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.75rem;">No Stories Yet</h3>
    <p style="opacity: 0.8; margin-bottom: 1.5rem;">Be the first to share what's happening!</p>
    <a href="story-upload.html" class="btn">üì∏ Create Your First Story</a>
  </div>

  <!-- Info Card -->
  <div class="card" style="background: rgba(0, 217, 255, 0.05); border-color: rgba(0, 217, 255, 0.3);">
    <h3 style="font-weight: 600; margin-bottom: 1rem; color: #00d9ff; font-size: 1.1rem;">üìå How Stories Work</h3>
    <div style="display: grid; gap: 0.75rem; font-size: 0.95rem; line-height: 1.6;">
      <div>‚è±Ô∏è <strong>24 Hours:</strong> Stories disappear after 24 hours automatically</div>
      <div>üì∏ <strong>Share Moments:</strong> Upload photos, text updates, or video links</div>
      <div>üëÅÔ∏è <strong>See Who Viewed:</strong> Check who's seen your stories</div>
      <div>üí¨ <strong>Get Replies:</strong> Followers can reply to your stories</div>
      <div>üéµ <strong>Promote Music:</strong> Share new releases, behind-the-scenes, and more</div>
    </div>
  </div>

</main>

<!-- Bottom Navigation -->
<nav class="fixed bottom-0 left-0 right-0 z-50 bg-[rgba(15,0,30,0.95)] backdrop-blur-md border-t border-purple-500/40">
  <div class="max-w-6xl mx-auto px-2 py-2">
    <div class="flex items-center justify-around gap-1">
      <a href="index.html" class="bottom-nav-item">
        <div class="bottom-nav-icon">üè†</div>
        <div class="bottom-nav-label">Home</div>
      </a>
      <a href="search.html" class="bottom-nav-item">
        <div class="bottom-nav-icon">üîç</div>
        <div class="bottom-nav-label">Search</div>
      </a>
      <a href="feed.html" class="bottom-nav-item">
        <div class="bottom-nav-icon">üì∞</div>
        <div class="bottom-nav-label">Feed</div>
      </a>
      <a href="radio.html" class="bottom-nav-item">
        <div class="bottom-nav-icon">üìª</div>
        <div class="bottom-nav-label">Radio</div>
      </a>
      <a href="shop.html" class="bottom-nav-item">
        <div class="bottom-nav-icon">üõí</div>
        <div class="bottom-nav-label">Shop</div>
      </a>
    </div>
  </div>
</nav>

<style>
.bottom-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem 0.75rem;
  text-decoration: none;
  color: #a855f7;
  transition: all 0.2s;
  border-radius: 0.5rem;
  flex: 1;
  max-width: 100px;
}
.bottom-nav-item:hover {
  background: rgba(124, 58, 237, 0.2);
  color: #c084fc;
}
.bottom-nav-icon {
  font-size: 1.25rem;
  line-height: 1;
}
.bottom-nav-label {
  font-size: 0.7rem;
  font-weight: 600;
  text-align: center;
}
</style>

<script src="scripts.js?v=6" defer></script>

<script>
// Stories System
const StoriesSystem = {
  stories: [],
  currentUser: 'CurrentUser', // Will be replaced with actual user system
  
  init() {
    this.loadStories();
    this.cleanExpiredStories();
    this.renderStories();
    this.createSampleStories();
  },
  
  loadStories() {
    const stored = localStorage.getItem('user_stories');
    this.stories = stored ? JSON.parse(stored) : [];
  },
  
  saveStories() {
    localStorage.setItem('user_stories', JSON.stringify(this.stories));
  },
  
  cleanExpiredStories() {
    const now = Date.now();
    const validStories = this.stories.filter(story => {
      const age = now - new Date(story.timestamp).getTime();
      return age < 24 * 60 * 60 * 1000; // 24 hours
    });
    
    if (validStories.length !== this.stories.length) {
      this.stories = validStories;
      this.saveStories();
    }
  },
  
  createSampleStories() {
    if (this.stories.length === 0) {
      const samples = [
        {
          id: Date.now() + 1,
          userId: '8BFR',
          username: '8BFR',
          avatar: 'assets/images/default_user_32_40.png',
          type: 'text',
          content: 'New track dropping tonight! üî•',
          background: 'linear-gradient(135deg, #7c3aed, #a855f7)',
          timestamp: new Date().toISOString(),
          views: 47,
          replies: []
        },
        {
          id: Date.now() + 2,
          userId: 'NovaRae',
          username: 'Nova Rae',
          avatar: 'assets/images/default_user_35_40_girl.png',
          type: 'text',
          content: 'Writing session vibes ‚ú®üìù',
          background: 'linear-gradient(135deg, #ec4899, #8b5cf6)',
          timestamp: new Date(Date.now() - 3600000).toISOString(),
          views: 23,
          replies: []
        },
        {
          id: Date.now() + 3,
          userId: 'KDrip',
          username: 'K. Drip',
          avatar: 'assets/images/default_user_41_%2B.png',
          type: 'text',
          content: 'New beat pack coming soon üéπüîä',
          background: 'linear-gradient(135deg, #06b6d4, #3b82f6)',
          timestamp: new Date(Date.now() - 7200000).toISOString(),
          views: 31,
          replies: []
        }
      ];
      
      this.stories = samples;
      this.saveStories();
    }
  },
  
  groupStoriesByUser() {
    const grouped = {};
    this.stories.forEach(story => {
      if (!grouped[story.userId]) {
        grouped[story.userId] = {
          userId: story.userId,
          username: story.username,
          avatar: story.avatar,
          stories: []
        };
      }
      grouped[story.userId].stories.push(story);
    });
    
    // Sort stories within each user by timestamp
    Object.values(grouped).forEach(user => {
      user.stories.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
    });
    
    return Object.values(grouped);
  },
  
  renderStories() {
    const grouped = this.groupStoriesByUser();
    const grid = document.getElementById('storiesGrid');
    const emptyState = document.getElementById('emptyState');
    
    grid.innerHTML = '';
    
    // Always show "Create Story" card first
    grid.innerHTML += this.createNewStoryCard();
    
    if (grouped.length === 0) {
      emptyState.style.display = 'block';
      return;
    }
    
    emptyState.style.display = 'none';
    
    grouped.forEach(userStories => {
      grid.innerHTML += this.createStoryCard(userStories);
    });
  },
  
  createNewStoryCard() {
    return `
      <a href="story-upload.html" class="create-story">
        <div class="create-story-icon">‚ûï</div>
        <div style="font-weight: 600; color: #fff; text-align: center;">
          Create Story
        </div>
      </a>
    `;
  },
  
  createStoryCard(userStories) {
    const latestStory = userStories.stories[userStories.stories.length - 1];
    const timeAgo = this.getTimeAgo(latestStory.timestamp);
    const totalViews = userStories.stories.reduce((sum, s) => sum + (s.views || 0), 0);
    
    let backgroundStyle = '';
    if (latestStory.type === 'image' && latestStory.imageUrl) {
      backgroundStyle = `background-image: url('${latestStory.imageUrl}'); background-size: cover; background-position: center;`;
    } else if (latestStory.type === 'text' && latestStory.background) {
      backgroundStyle = `background: ${latestStory.background};`;
    }
    
    return `
      <div class="story-card ${latestStory.type === 'image' ? 'has-image' : ''}" 
           style="${backgroundStyle}"
           onclick="viewStory('${userStories.userId}', 0)">
        <div class="story-overlay">
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <img src="${userStories.avatar}" class="story-avatar" alt="${userStories.username}">
            <div>
              <div class="story-username">${userStories.username}</div>
              <div class="story-time">${timeAgo}</div>
            </div>
          </div>
          ${latestStory.type === 'text' ? `
            <div style="text-align: center; font-size: 1.1rem; font-weight: 600; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5); padding: 1rem;">
              ${latestStory.content}
            </div>
          ` : ''}
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div class="story-views">
              <span>üëÅÔ∏è</span>
              <span>${totalViews}</span>
            </div>
            <div style="font-size: 0.75rem; color: #fff; opacity: 0.9;">
              ${userStories.stories.length} ${userStories.stories.length === 1 ? 'story' : 'stories'}
            </div>
          </div>
        </div>
      </div>
    `;
  },
  
  getTimeAgo(timestamp) {
    const now = Date.now();
    const diff = now - new Date(timestamp).getTime();
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor(diff / (1000 * 60));
    
    if (hours > 0) {
      return `${hours}h ago`;
    } else if (minutes > 0) {
      return `${minutes}m ago`;
    } else {
      return 'Just now';
    }
  }
};

function viewStory(userId, storyIndex) {
  window.location.href = `story-viewer.html?user=${userId}&index=${storyIndex}`;
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  StoriesSystem.init();
});
</script>
  <!-- ADD THIS SCRIPT TO EVERY PAGE (except index.html where you want it always shown) -->
<!-- Place it right before the closing </body> tag -->

<script>
// Avatar & Bubble Toggle System
(function() {
    // Create toggle button
    const toggleBtn = document.createElement('button');
    toggleBtn.id = 'avatarToggle';
    toggleBtn.innerHTML = 'üëÅÔ∏è';
    toggleBtn.title = 'Toggle Avatar/Bubbles';
    toggleBtn.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 9999;
        background: rgba(124, 58, 237, 0.9);
        border: 2px solid rgba(124, 58, 237, 1);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(124, 58, 237, 0.5);
        transition: all 0.3s ease;
    `;
    
    toggleBtn.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.1)';
    });
    
    toggleBtn.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
    });
    
    document.body.appendChild(toggleBtn);
    
    // Load saved preference
    let isHidden = localStorage.getItem('hideAvatarBubbles') === 'true';
    
    function updateVisibility() {
        const elementsToToggle = [
            document.getElementById('homeAvatarSwitcher'),
            ...document.querySelectorAll('[id*="bubble"]'),
            ...document.querySelectorAll('[class*="bubble"]'),
            ...document.querySelectorAll('[id*="avatar"][id*="switcher"]')
        ];
        
        elementsToToggle.forEach(el => {
            if (el) {
                el.style.display = isHidden ? 'none' : '';
            }
        });
        
        toggleBtn.innerHTML = isHidden ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è';
        toggleBtn.title = isHidden ? 'Show Avatar/Bubbles' : 'Hide Avatar/Bubbles';
    }
    
    toggleBtn.addEventListener('click', function() {
        isHidden = !isHidden;
        localStorage.setItem('hideAvatarBubbles', isHidden);
        updateVisibility();
    });
    
    // Apply on load
    updateVisibility();
    
    // Watch for dynamically added elements
    const observer = new MutationObserver(updateVisibility);
    observer.observe(document.body, { childList: true, subtree: true });
})();
</script>


</body>
</html>
