<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Studio - 8BFR</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #7c3aed; --dark: #0b0014; --dark-card: #0c0618; --text: #eae6ff; --text-dim: #a855f7; --border: rgba(124,58,237,.35); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Work Sans', sans-serif; background: linear-gradient(#0b0014,#000); color: var(--text); min-height: 100vh; padding-bottom: 80px; }
        .header { background: rgba(15,0,30,.9); border-bottom: 2px solid var(--primary); padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; flex-wrap: wrap; gap: 0.5rem; }
        .header h1 { font-family: 'Bebas Neue', cursive; font-size: 2rem; color: var(--primary); }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .card { background: var(--dark-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
        .tool-card { background: var(--dark); border: 1px solid var(--border); padding: 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .tool-card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .tool-card.active { border-color: var(--primary); background: rgba(124,58,237,0.15); box-shadow: 0 0 15px rgba(124,58,237,0.3); }
        .tool-card h3 { color: var(--primary); margin-bottom: 0.5rem; font-size: 1rem; }
        .tool-card p { font-size: 0.85rem; color: var(--text-dim); }
        .badge-real { display: inline-block; background: rgba(0,255,136,0.15); color: #00ff88; font-size: 0.65rem; padding: 0.1rem 0.4rem; border-radius: 4px; font-weight: 700; margin-top: 0.3rem; }
        .badge-brief { display: inline-block; background: rgba(124,58,237,0.15); color: var(--text-dim); font-size: 0.65rem; padding: 0.1rem 0.4rem; border-radius: 4px; font-weight: 700; margin-top: 0.3rem; }
        .btn { background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.95rem; transition: all 0.2s; }
        .btn:hover { background: #6d28d9; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-outline { background: rgba(124,58,237,0.2); border: 1px solid var(--border); }
        textarea { width: 100%; min-height: 120px; padding: 0.75rem; background: var(--dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: inherit; margin: 0.75rem 0; font-size: 0.95rem; resize: vertical; box-sizing: border-box; }
        textarea:focus { outline: none; border-color: var(--primary); }
        .result-box { background: rgba(124,58,237,0.1); border: 1px solid var(--border); padding: 1.25rem; border-radius: 8px; margin-top: 1rem; min-height: 100px; line-height: 1.7; white-space: pre-wrap; font-size: 0.95rem; }
        .spinner { width: 24px; height: 24px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.7s linear infinite; display: inline-block; vertical-align: middle; margin-right: 0.5rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .chat-link { display: flex; align-items: center; gap: 1rem; padding: 1.25rem; background: var(--dark); border: 1px solid var(--border); border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; }
        .chat-link:hover { border-color: var(--primary); background: rgba(124,58,237,0.1); transform: translateY(-2px); }
        .chat-link .icon { font-size: 2.5rem; flex-shrink: 0; }
        .chat-link h3 { color: var(--primary); font-size: 1.1rem; margin-bottom: 0.25rem; }
        .chat-link p { font-size: 0.85rem; color: var(--text-dim); margin: 0; line-height: 1.4; }
        .cover-preview { margin-top: 1rem; text-align: center; }
        .cover-preview img { max-width: 400px; width: 100%; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); }
        .warn-box { margin-top: 0.75rem; padding: 0.6rem 1rem; background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); border-radius: 8px; font-size: 0.82rem; color: #f59e0b; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé® Owner Studio</h1>
        <a href="owner-panel.html" style="color: var(--text); text-decoration: none; font-weight: 600;">‚Üê Back to Panel</a>
    </div>
    <div class="container">

        <!-- AI CHATS -->
        <div class="card">
            <h2 style="color: var(--primary); margin-bottom: 1rem; font-family: 'Bebas Neue', cursive; font-size: 1.5rem;">üí¨ AI Assistants</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                <a href="ai-chat.html" class="chat-link">
                    <div class="icon">ü§ñ</div>
                    <div><h3>General AI Chat</h3><p>Ask anything ‚Äî coding, business, ideas, writing, advice</p></div>
                </a>
                <a href="ai-music-expert.html" class="chat-link">
                    <div class="icon">üéì</div>
                    <div><h3>Music Expert AI</h3><p>Tips, tricks, theory, production, mixing, marketing, industry knowledge</p></div>
                </a>
            </div>
        </div>

        <!-- TOOLS -->
        <div class="card">
            <h2 style="color: var(--primary); margin-bottom: 1rem; font-family: 'Bebas Neue', cursive; font-size: 1.5rem;">üõ†Ô∏è AI Generator Tools</h2>
            <div class="tools-grid">
                <div class="tool-card" id="tool-lyrics" onclick="selectTool('lyrics')"><h3>‚úçÔ∏è Lyrics Generator</h3><p>Generate song lyrics in any style</p><span class="badge-real">‚úÖ REAL OUTPUT</span></div>
                <div class="tool-card" id="tool-post" onclick="selectTool('post')"><h3>üìù Post Generator</h3><p>Create social media posts</p><span class="badge-real">‚úÖ REAL OUTPUT</span></div>
                <div class="tool-card" id="tool-cover" onclick="selectTool('cover')"><h3>üé® Album Cover</h3><p>Generate actual cover art images</p><span class="badge-real">‚úÖ REAL IMAGE</span></div>
                <div class="tool-card" id="tool-song" onclick="selectTool('song')"><h3>üé§ Song Creator</h3><p>Full song structure + lyrics</p><span class="badge-real">‚úÖ REAL OUTPUT</span></div>
                <div class="tool-card" id="tool-beats" onclick="selectTool('beats')"><h3>üéµ Beat Ideas</h3><p>Production concepts & blueprints</p><span class="badge-brief">üìã CREATIVE BRIEF</span></div>
                <div class="tool-card" id="tool-video" onclick="selectTool('video')"><h3>üé¨ Video Concept</h3><p>Music video storyboards & ideas</p><span class="badge-brief">üìã CREATIVE BRIEF</span></div>
            </div>
        </div>
        
        <!-- TOOL PANEL -->
        <div id="toolPanel" class="card" style="display: none;">
            <h2 style="color: var(--primary); font-family: 'Bebas Neue', cursive; font-size: 1.5rem;" id="toolTitle">Tool</h2>
            <p id="toolHint" style="font-size:0.85rem;color:var(--text-dim);margin-bottom:0.25rem;"></p>
            <textarea id="prompt" placeholder="Enter your prompt..."></textarea>
            <div style="display:flex;gap:0.75rem;align-items:center;flex-wrap:wrap;">
                <button class="btn" id="generateBtn" onclick="generateAI()">üöÄ Generate</button>
                <button class="btn btn-outline" onclick="copyResult()">üìã Copy Result</button>
                <button class="btn btn-outline" id="downloadBtn" onclick="downloadCover()" style="display:none;">üíæ Download Image</button>
            </div>
            <div class="warn-box">‚ö†Ô∏è <strong>Copy your output!</strong> Results are not saved ‚Äî copy text or download images before leaving this page.</div>
            <div id="result" class="result-box" style="display: none;"></div>
            <div id="coverPreview" class="cover-preview" style="display:none;"></div>
        </div>

        <!-- INFO -->
        <div class="card" style="border-color:rgba(0,217,255,0.3);background:rgba(0,217,255,0.05);">
            <h2 style="color:#00d9ff;font-family:'Bebas Neue',cursive;font-size:1.3rem;">‚ÑπÔ∏è About AI Tools</h2>
            <div style="font-size:0.9rem;line-height:1.7;color:var(--text-dim);">
                <p style="margin-bottom:0.5rem;"><strong style="color:var(--text);">What generates real output:</strong></p>
                <p>‚úÖ <strong>Lyrics, Posts, Song Creator</strong> ‚Äî Full text you can use immediately</p>
                <p>‚úÖ <strong>Album Cover</strong> ‚Äî Generates an actual downloadable image</p>
                <p style="margin-top:0.5rem;"><strong style="color:var(--text);">What generates plans/blueprints:</strong></p>
                <p>üìã <strong>Beat Ideas</strong> ‚Äî Detailed production blueprint (actual beat generation requires Suno/Udio ‚Äî premium)</p>
                <p>üìã <strong>Video Concepts</strong> ‚Äî Scene-by-scene storyboard (actual video generation requires Runway/Pika ‚Äî premium)</p>
                <p style="margin-top:0.75rem;padding:0.75rem;background:rgba(124,58,237,0.1);border-radius:8px;border-left:3px solid var(--primary);">
                    <strong style="color:var(--text);">üíé Future Premium Plan:</strong> Upgraded accounts will include actual beat generation, extended AI chat, and more tools. Text tools (lyrics, posts, songs) and album covers are included in the free tier. Beat and video generation require premium services with additional costs.
                </p>
                <p style="margin-top:0.75rem;color:rgba(234,230,255,0.4);font-size:0.8rem;">Powered by Groq AI (text) + Pollinations (images) ‚Äî Free tier</p>
            </div>
        </div>
    </div>
    
    <script src="scripts.js" defer></script>
    <script>
        const SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
        const s = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentTool = '';
        let currentCoverUrl = '';
        
        const toolConfig = {
            lyrics: { title: '‚úçÔ∏è Lyrics Generator', hint: 'Describe the mood, genre, theme. Be specific for better results.', placeholder: 'e.g. Write a dark trap verse about rising from nothing, Wu-Tang style, with internal rhymes and martial arts metaphors...' },
            beats: { title: 'üéµ Beat Ideas', hint: 'Describe the vibe ‚Äî this creates a detailed production blueprint.', placeholder: 'e.g. 82 BPM boom-bap beat with piano chops, heavy bass, and a martial arts movie sample...' },
            cover: { title: 'üé® Album Cover Generator', hint: 'Describe the image you want ‚Äî a real cover image will be generated!', placeholder: 'e.g. Dark cyberpunk album cover with neon purple glow, a hooded figure holding a microphone, city skyline at night, rain...' },
            video: { title: 'üé¨ Video Concept', hint: 'Describe the song and vision ‚Äî get a detailed storyboard plan.', placeholder: 'e.g. Music video for a hype anthem ‚Äî warehouse setting, crew shots, slow-mo fight choreography, smoke effects...' },
            post: { title: 'üìù Post Generator', hint: 'What platform and topic? Gets ready-to-paste posts.', placeholder: 'e.g. Instagram caption for a new single drop, hype tone, include hashtags and a call to action...' },
            song: { title: 'üé§ Song Creator', hint: 'Describe the full song ‚Äî get complete lyrics with structure.', placeholder: 'e.g. Full rap song, 3 verses + hook, about discipline and martial arts, aggressive delivery, 4/4 time...' }
        };

        async function init() {
            try {
                const { data: { session } } = await s.auth.getSession();
                if (!session) { location.href = 'login.html?return=owner-studio.html'; return; }
                const { data: profile } = await s.from('profiles').select('role').eq('user_id', session.user.id).single();
                if (!profile || profile.role !== 'owner') { alert('Owner access only.'); location.href = 'owner-panel.html'; return; }
            } catch (error) { console.error('Init error:', error); }
        }
        
        function selectTool(tool) {
            currentTool = tool;
            currentCoverUrl = '';
            const cfg = toolConfig[tool] || {};
            document.querySelectorAll('.tool-card').forEach(c => c.classList.remove('active'));
            var el = document.getElementById('tool-' + tool);
            if (el) el.classList.add('active');
            document.getElementById('toolTitle').textContent = cfg.title || tool;
            document.getElementById('toolHint').textContent = cfg.hint || '';
            document.getElementById('prompt').placeholder = cfg.placeholder || 'Enter your prompt...';
            document.getElementById('toolPanel').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.getElementById('coverPreview').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'none';
            document.getElementById('prompt').value = '';
            document.getElementById('prompt').focus();
        }
        
        async function generateAI() {
            const prompt = document.getElementById('prompt').value.trim();
            if (!prompt) { alert('Enter a prompt first.'); return; }
            
            const resultDiv = document.getElementById('result');
            const coverDiv = document.getElementById('coverPreview');
            const btn = document.getElementById('generateBtn');
            const dlBtn = document.getElementById('downloadBtn');
            
            btn.disabled = true; btn.textContent = 'Generating...';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="spinner"></div> Generating...';
            coverDiv.style.display = 'none';
            dlBtn.style.display = 'none';

            // ALBUM COVER ‚Äî generate real image
            if (currentTool === 'cover') {
                try {
                    resultDiv.innerHTML = '<div class="spinner"></div> Step 1: Enhancing your description with AI...';
                    
                    let imagePrompt = prompt;
                    try {
                        const aiRes = await fetch('https://8bfr-api.vercel.app/api/openai', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ input: 'Create a concise, vivid image generation prompt (only the visual description, no explanations) for this album cover idea: ' + prompt, tool: 'cover' })
                        });
                        if (aiRes.ok) {
                            const aiData = await aiRes.json();
                            if (aiData.response) imagePrompt = aiData.response.replace(/\n/g, ' ').substring(0, 500);
                        }
                    } catch(e) { /* use original prompt */ }
                    
                    resultDiv.innerHTML = '<div class="spinner"></div> Step 2: Generating image... this may take 10-30 seconds...';
                    
                    const encodedPrompt = encodeURIComponent(imagePrompt + ', album cover art, high quality, professional, square format');
                    currentCoverUrl = 'https://image.pollinations.ai/prompt/' + encodedPrompt + '?width=1024&height=1024&nologo=true&seed=' + Date.now();
                    
                    const img = new Image();
                    img.onload = function() {
                        coverDiv.innerHTML = '<img src="' + currentCoverUrl + '" alt="Generated Album Cover"><p style="margin-top:0.75rem;font-size:0.85rem;color:var(--text-dim);">Right-click ‚Üí Save Image, or click Download below</p>';
                        coverDiv.style.display = 'block';
                        dlBtn.style.display = 'inline-block';
                        resultDiv.innerHTML = '‚úÖ <strong>Cover generated!</strong>\n\n<strong>Enhanced prompt used:</strong>\n' + imagePrompt + '\n\nüí° Not happy? Edit your description and generate again.';
                        btn.disabled = false; btn.textContent = 'üöÄ Generate';
                    };
                    img.onerror = function() {
                        resultDiv.innerHTML = '<p style="color:#ff4466;">Image generation failed. Try a simpler description or try again.</p>';
                        btn.disabled = false; btn.textContent = 'üöÄ Generate';
                    };
                    img.src = currentCoverUrl;
                    return;
                } catch(e) {
                    resultDiv.innerHTML = '<p style="color:#ff4466;">Error: ' + e.message + '</p>';
                    btn.disabled = false; btn.textContent = 'üöÄ Generate';
                    return;
                }
            }
            
            // ALL OTHER TOOLS ‚Äî Groq text API
            try {
                const response = await fetch('https://8bfr-api.vercel.app/api/openai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({ input: prompt, tool: currentTool })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    resultDiv.innerHTML = '<p style="color:#ff4466;"><strong>API Error (' + response.status + ')</strong></p><p style="font-size:0.85rem;color:var(--text-dim);margin-top:0.5rem;">' + errorText.substring(0, 500) + '</p>';
                    return;
                }
                
                const data = await response.json();
                if (data.status === 'success' || data.response || data.result) {
                    const content = data.response || data.result || JSON.stringify(data, null, 2);
                    resultDiv.innerHTML = content.replace(/\n/g, '<br>');
                } else {
                    resultDiv.innerHTML = '<p style="color:#ff4466;">Error: ' + (data.error || data.message || 'Unknown') + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p style="color:#ff4466;"><strong>Network Error:</strong> ' + error.message + '</p>';
            } finally {
                btn.disabled = false; btn.textContent = 'üöÄ Generate';
            }
        }

        function copyResult() {
            const r = document.getElementById('result');
            if (!r || r.style.display === 'none') { alert('Nothing to copy yet.'); return; }
            navigator.clipboard.writeText(r.innerText).then(() => alert('‚úÖ Copied!')).catch(() => {
                const t = document.createElement('textarea'); t.value = r.innerText; document.body.appendChild(t); t.select(); document.execCommand('copy'); document.body.removeChild(t); alert('‚úÖ Copied!');
            });
        }

        function downloadCover() {
            if (!currentCoverUrl) return;
            const a = document.createElement('a'); a.href = currentCoverUrl; a.download = 'album-cover-8bfr.png'; a.target = '_blank'; document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }
        
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
        else init();
    </script>

    <script>
    (function() {
        var b = document.createElement('button'); b.innerHTML = 'üëÅÔ∏è';
        b.style.cssText = 'position:fixed;top:80px;right:20px;z-index:9999;background:rgba(124,58,237,0.9);border:2px solid rgba(124,58,237,1);color:white;width:50px;height:50px;border-radius:50%;cursor:pointer;font-size:24px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(124,58,237,0.5);';
        document.body.appendChild(b);
        var h = localStorage.getItem('hideAvatarBubbles') === 'true';
        function u() { document.querySelectorAll('[id*="bubble"],[class*="bubble"],[id*="avatar"][id*="switcher"]').forEach(function(el) { if(el) el.style.display = h ? 'none' : ''; }); b.innerHTML = h ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è'; }
        b.addEventListener('click', function() { h = !h; localStorage.setItem('hideAvatarBubbles', h); u(); }); u();
    })();
    </script>
</body>
</html>
