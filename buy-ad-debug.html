
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8BFR Payment Debug</title>
    <style>
        body {
            background: #0b0014;
            color: #eae6ff;
            font-family: system-ui, sans-serif;
            min-height: 100vh;
            padding: 1rem;
        }
        .card {
            background: rgba(12, 6, 24, 0.8);
            border: 1px solid rgba(124, 58, 237, 0.4);
            border-radius: 16px;
            padding: 1.5rem;
            max-width: 600px;
            margin: 0 auto;
        }
        .debug-box {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
            word-break: break-all;
        }
        .debug-box .ok { color: #00ff88; }
        .debug-box .err { color: #ff0044; }
        .debug-box .warn { color: #fbbf24; }
        .debug-box .info { color: #a855f7; }
        #paypal-button-container {
            margin: 1rem 0;
            min-height: 50px;
            border: 2px dashed #00ff88;
            padding: 0.5rem;
        }
        #stripe-test {
            margin: 1rem 0;
            min-height: 50px;
            border: 2px dashed #635bff;
            padding: 0.5rem;
        }
        button {
            background: #7c3aed;
            color: white;
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        h1 { color: #00ff88; font-size: 1.3rem; margin-bottom: 0.5rem; }
        h2 { color: #a855f7; font-size: 1rem; margin: 1rem 0 0.5rem; }
    </style>
</head>
<body>
    <div class="card">
        <h1>&#128269; Payment Debug Page</h1>
        <p style="font-size:0.8rem;color:#a855f7;margin-bottom:1rem;">This shows exactly what's happening with PayPal and Stripe</p>

        <div class="debug-box" id="debugLog">
            <div style="color:#00ff88;font-weight:bold;">DEBUG LOG:</div>
        </div>

        <h2>PayPal Button:</h2>
        <div id="paypal-button-container">
            <p style="color:#fbbf24;font-size:0.8rem;">Waiting...</p>
        </div>

        <h2>Stripe Test:</h2>
        <div id="stripe-test">
            <p style="color:#fbbf24;font-size:0.8rem;">Waiting...</p>
        </div>

        <button onclick="window.location.reload()">&#128260; Reload Page</button>
        <button onclick="copyLog()" style="background:#00ff88;color:#000;">&#128203; Copy Log</button>
    </div>

    <script>
        var logDiv = document.getElementById('debugLog');
        var allLogs = [];

        function log(msg, type) {
            var t = new Date().toLocaleTimeString();
            var cls = type || 'info';
            var line = document.createElement('div');
            line.className = cls;
            line.textContent = '[' + t + '] ' + msg;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
            allLogs.push('[' + t + '] ' + msg);
            console.log(msg);
        }

        function copyLog() {
            var text = allLogs.join('\n');
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function() {
                    alert('Log copied!');
                });
            } else {
                prompt('Copy this log:', text);
            }
        }

        log('Page loaded', 'ok');
        log('URL: ' + window.location.href, 'info');
        log('User Agent: ' + navigator.userAgent.substring(0, 80), 'info');

        // ── TEST 1: Check if Supabase loaded ──
        if (typeof window.supabase !== 'undefined') {
            log('Supabase JS: LOADED', 'ok');
        } else {
            log('Supabase JS: NOT LOADED', 'err');
        }

        // ── TEST 2: Load and test Stripe ──
        var stripeScript = document.createElement('script');
        stripeScript.src = 'https://js.stripe.com/v3/';
        stripeScript.onload = function() {
            log('Stripe JS: LOADED', 'ok');
            try {
                var s = Stripe('pk_live_51OkBOuEvK9FbOwLilOaOLSHSLx47wT1q7T6xiMuODRF2j4a2DM0BHI16A5z8ovscAfhv83l7d1OFPbUjehHtQIeH00RwDCQ0I1');
                log('Stripe initialized OK', 'ok');
                document.getElementById('stripe-test').innerHTML =
                    '<p style="color:#00ff88;font-size:0.8rem;">Stripe loaded and initialized OK</p>' +
                    '<button onclick="testStripeRedirect()" style="background:#635bff;margin-top:0.5rem;">Test Stripe Redirect (Carousel 7-day $5)</button>';

                window.testStripeRedirect = async function() {
                    log('Testing Stripe redirect...', 'warn');
                    try {
                        var result = await s.redirectToCheckout({
                            lineItems: [{ price: 'price_1SxvB9EvK9FbOwLivDlFaHpj', quantity: 1 }],
                            mode: 'payment',
                            successUrl: window.location.origin + '/index.html?stripe=success',
                            cancelUrl: window.location.href
                        });
                        if (result.error) {
                            log('Stripe redirect error: ' + result.error.message, 'err');
                        }
                    } catch (err) {
                        log('Stripe error: ' + err.message, 'err');
                    }
                };
            } catch (err) {
                log('Stripe init ERROR: ' + err.message, 'err');
                document.getElementById('stripe-test').innerHTML =
                    '<p style="color:#ff0044;font-size:0.8rem;">Stripe error: ' + err.message + '</p>';
            }
        };
        stripeScript.onerror = function() {
            log('Stripe JS: FAILED TO LOAD', 'err');
            document.getElementById('stripe-test').innerHTML =
                '<p style="color:#ff0044;font-size:0.8rem;">Stripe script failed to load</p>';
        };
        document.head.appendChild(stripeScript);

        // ── TEST 3: Load and test PayPal ──
        log('Loading PayPal SDK...', 'warn');
        var ppScript = document.createElement('script');
        ppScript.src = 'https://www.paypal.com/sdk/js?client-id=AWx0LwdZ_sCyCE5gEj9mL1ha7ZbG_eZLE_R636KjLXFMV1pOfmGwNg9prM5kVKQspvnpNLJDZxPp100G&currency=USD&intent=capture&components=buttons';
        ppScript.setAttribute('data-sdk-integration-source', 'button-factory');

        ppScript.onload = function() {
            log('PayPal SDK: LOADED', 'ok');

            if (typeof window.paypal === 'undefined') {
                log('PayPal SDK loaded but window.paypal is undefined!', 'err');
                return;
            }

            log('window.paypal keys: ' + Object.keys(window.paypal).join(', '), 'info');

            try {
                log('Rendering PayPal buttons...', 'warn');
                window.paypal.Buttons({
                    style: { layout: 'vertical', color: 'gold', shape: 'rect', label: 'paypal', height: 45 },
                    createOrder: function(data, actions) {
                        log('createOrder called - creating $5 test order', 'warn');
                        return actions.order.create({
                            purchase_units: [{
                                amount: { value: '5.00' },
                                description: 'DEBUG TEST - 8BFR Ad'
                            }]
                        });
                    },
                    onApprove: function(data, actions) {
                        log('onApprove called!', 'ok');
                        return actions.order.capture().then(function(details) {
                            log('Payment captured: ' + details.id, 'ok');
                            alert('Payment successful! ID: ' + details.id);
                        });
                    },
                    onCancel: function() {
                        log('Payment cancelled by user', 'warn');
                    },
                    onError: function(err) {
                        log('PayPal button error: ' + err, 'err');
                    }
                }).render('#paypal-button-container').then(function() {
                    log('PayPal buttons RENDERED OK', 'ok');
                }).catch(function(err) {
                    log('PayPal render FAILED: ' + err.message, 'err');
                    document.getElementById('paypal-button-container').innerHTML =
                        '<p style="color:#ff0044;font-size:0.8rem;">Render failed: ' + err.message + '</p>';
                });
            } catch (err) {
                log('PayPal render ERROR: ' + err.message, 'err');
                log('Stack: ' + (err.stack || 'none').substring(0, 200), 'err');
            }
        };

        ppScript.onerror = function() {
            log('PayPal SDK: FAILED TO LOAD', 'err');
            log('This usually means: ad blocker, network issue, or invalid client ID', 'err');
            document.getElementById('paypal-button-container').innerHTML =
                '<p style="color:#ff0044;font-size:0.8rem;">PayPal script failed to load. Check ad blockers or try incognito.</p>';
        };

        document.body.appendChild(ppScript);
        log('PayPal script tag appended to page', 'info');

        // ── TEST 4: Network connectivity ──
        fetch('https://www.paypal.com/sdk/js?client-id=test', { mode: 'no-cors' })
            .then(function() { log('Network: Can reach paypal.com', 'ok'); })
            .catch(function(err) { log('Network: Cannot reach paypal.com - ' + err.message, 'err'); });

        fetch('https://js.stripe.com/v3/', { mode: 'no-cors' })
            .then(function() { log('Network: Can reach stripe.com', 'ok'); })
            .catch(function(err) { log('Network: Cannot reach stripe.com - ' + err.message, 'err'); });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
    
