<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fan Zone â€” 8BFR Music Network</title>
  <link rel="icon" href="assets/images/favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; background: linear-gradient(#0b0014, #000); color: #eae6ff; margin: 0; min-height: 100vh; padding-bottom: 80px; }
    .fan-card { background: rgba(12,6,24,0.8); border: 1px solid rgba(124,58,237,0.4); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
    .identity-card { background: linear-gradient(135deg, rgba(124,58,237,0.2), rgba(0,217,255,0.1)); border: 2px solid rgba(124,58,237,0.6); border-radius: 20px; padding: 2rem; margin-bottom: 2rem; }
    .stat-card { background: rgba(124,58,237,0.1); border: 1px solid rgba(124,58,237,0.3); border-radius: 12px; padding: 1.5rem; text-align: center; transition: all 0.2s; }
    .stat-card:hover { background: rgba(124,58,237,0.15); transform: translateY(-2px); }
    .badge-chip { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(124,58,237,0.2); border: 1px solid rgba(124,58,237,0.5); border-radius: 50px; font-size: 0.9rem; margin: 0.25rem; }
    .leaderboard-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(124,58,237,0.05); border: 1px solid rgba(124,58,237,0.2); border-radius: 12px; margin-bottom: 0.75rem; text-decoration: none; color: inherit; }
    .leaderboard-item:hover { background: rgba(124,58,237,0.1); }
    .rank-badge { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
    .rank-1 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; }
    .rank-2 { background: linear-gradient(135deg, #e5e7eb, #9ca3af); color: #000; }
    .rank-3 { background: linear-gradient(135deg, #f97316, #ea580c); color: #fff; }
    .rank-other { background: rgba(124,58,237,0.3); color: #a855f7; }
    .btn { display: inline-block; padding: 0.75rem 1.5rem; border-radius: 0.75rem; text-decoration: none; font-weight: 600; border: 1px solid; font-size: 0.9rem; }
    .btn-primary { background: #7c3aed; color: white; border-color: #7c3aed; }
    .btn-secondary { background: transparent; color: #a855f7; border-color: rgba(124,58,237,0.6); }
    .spinner { width: 32px; height: 32px; border-radius: 50%; border: 3px solid rgba(168,85,247,0.2); border-top-color: #a855f7; animation: spin 0.7s linear infinite; margin: 1rem auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .bottom-nav-item { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.5rem 0.75rem; text-decoration: none; color: #a855f7; border-radius: 0.5rem; flex: 1; max-width: 100px; }
    .bottom-nav-item.active { color: #fff; background: rgba(124,58,237,0.3); }
  </style>
</head>
<body>
  <header style="background:rgba(15,0,30,0.95);border-bottom:1px solid rgba(124,58,237,0.5);padding:1.5rem 1rem;position:sticky;top:0;z-index:100;">
    <div style="max-width:1000px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;">
      <div><h1 style="font-size:1.5rem;font-weight:bold;">ğŸ’ Fan Zone</h1><p style="font-size:0.9rem;color:#a855f7;">Where fans become community</p></div>
      <a href="index.html" class="btn btn-secondary" style="padding:0.5rem 1rem;">â† Home</a>
    </div>
  </header>
  <div style="max-width:1000px;margin:0 auto;padding:2rem 1rem;">
    <div class="identity-card">
      <div style="display:flex;align-items:center;gap:1.5rem;flex-wrap:wrap;">
        <div id="fanAvatar" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#7c3aed,#a855f7);display:flex;align-items:center;justify-content:center;font-size:2rem;border:3px solid rgba(0,217,255,0.5);overflow:hidden;flex-shrink:0;">ğŸ’</div>
        <div style="flex:1;min-width:250px;">
          <h2 id="fanName" style="font-size:1.75rem;font-weight:bold;margin-bottom:0.5rem;">Loading...</h2>
          <div id="fanBadges" style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:0.75rem;"></div>
          <div style="display:flex;gap:1rem;font-size:0.85rem;color:#a855f7;flex-wrap:wrap;">
            <span id="fanTier">ğŸ… Bronze</span>
            <span id="fanPoints">â­ 0 points</span>
          </div>
        </div>
      </div>
      <div style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid rgba(124,58,237,0.3);display:flex;gap:1rem;flex-wrap:wrap;">
        <a href="profile.html" class="btn btn-secondary" style="flex:1;min-width:150px;text-align:center;">ğŸ‘¤ My Profile</a>
        <a href="algorithm-points.html" class="btn btn-primary" style="flex:1;min-width:150px;text-align:center;">â­ My Points</a>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem;">
      <div class="stat-card"><div style="font-size:2.5rem;margin-bottom:0.5rem;">ğŸµ</div><div id="statSongs" style="font-size:1.75rem;font-weight:bold;color:#a855f7;">â€”</div><div style="font-size:0.85rem;opacity:0.8;">Total Songs</div></div>
      <div class="stat-card"><div style="font-size:2.5rem;margin-bottom:0.5rem;">ğŸ¤</div><div id="statArtists" style="font-size:1.75rem;font-weight:bold;color:#a855f7;">â€”</div><div style="font-size:0.85rem;opacity:0.8;">Verified Artists</div></div>
      <div class="stat-card"><div style="font-size:2.5rem;margin-bottom:0.5rem;">ğŸ“</div><div id="statPosts" style="font-size:1.75rem;font-weight:bold;color:#a855f7;">â€”</div><div style="font-size:0.85rem;opacity:0.8;">Community Posts</div></div>
      <div class="stat-card"><div style="font-size:2.5rem;margin-bottom:0.5rem;">ğŸ‘¥</div><div id="statMembers" style="font-size:1.75rem;font-weight:bold;color:#a855f7;">â€”</div><div style="font-size:0.85rem;opacity:0.8;">Members</div></div>
    </div>
    <div class="fan-card">
      <h2 style="font-size:1.5rem;font-weight:bold;margin-bottom:1.5rem;">ğŸ† Top Community Members</h2>
      <div id="leaderboardLoading"><div class="spinner"></div></div>
      <div id="leaderboardList"></div>
      <div id="leaderboardEmpty" style="display:none;text-align:center;padding:2rem;color:#a855f7;">No members with points yet.</div>
    </div>
    <div class="fan-card">
      <h2 style="font-size:1.5rem;font-weight:bold;margin-bottom:1.5rem;">ğŸ”¥ Trending Creators</h2>
      <div id="trendingLoading"><div class="spinner"></div></div>
      <div id="trendingList" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;"></div>
      <div id="trendingEmpty" style="display:none;text-align:center;padding:2rem;color:#a855f7;">No trending creators yet.</div>
    </div>
    <div class="fan-card">
      <h2 style="font-size:1.5rem;font-weight:bold;margin-bottom:1rem;">ğŸ’œ Support the Community</h2>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;">
        <div style="background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(0,217,255,0.1));border:2px solid rgba(124,58,237,0.5);border-radius:16px;padding:2rem;text-align:center;">
          <div style="font-size:3rem;margin-bottom:1rem;">ğŸ–ï¸</div><h3 style="font-size:1.25rem;font-weight:bold;margin-bottom:0.5rem;">Earn Points</h3><p style="font-size:0.9rem;color:#a855f7;margin-bottom:1rem;">Post, like, share &amp; climb the leaderboard</p><a href="algorithm-points.html" class="btn btn-primary">Learn More</a>
        </div>
        <div style="background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(0,217,255,0.1));border:2px solid rgba(124,58,237,0.5);border-radius:16px;padding:2rem;text-align:center;">
          <div style="font-size:3rem;margin-bottom:1rem;">ğŸ’°</div><h3 style="font-size:1.25rem;font-weight:bold;margin-bottom:0.5rem;">Support Artists</h3><p style="font-size:0.9rem;color:#a855f7;margin-bottom:1rem;">Buy music directly from creators</p><a href="featured.html" class="btn btn-secondary">Browse Artists</a>
        </div>
        <div style="background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(0,217,255,0.1));border:2px solid rgba(124,58,237,0.5);border-radius:16px;padding:2rem;text-align:center;">
          <div style="font-size:3rem;margin-bottom:1rem;">ğŸ’œ</div><h3 style="font-size:1.25rem;font-weight:bold;margin-bottom:0.5rem;">Donate</h3><p style="font-size:0.9rem;color:#a855f7;margin-bottom:1rem;">Help keep 8BFR running</p><a href="https://www.paypal.com/donate?business=8bfr.music@gmail.com" target="_blank" class="btn btn-primary">Donate Now</a>
        </div>
      </div>
    </div>
  </div>
  <nav class="fixed bottom-0 left-0 right-0 z-50 bg-[rgba(15,0,30,0.95)] backdrop-blur-md border-t border-purple-500/40">
    <div class="max-w-6xl mx-auto px-2 py-2"><div class="flex items-center justify-around gap-1">
      <a href="index.html" class="bottom-nav-item"><div style="font-size:1.25rem;">ğŸ </div><div style="font-size:0.7rem;font-weight:600;">Home</div></a>
      <a href="search.html" class="bottom-nav-item"><div style="font-size:1.25rem;">ğŸ”</div><div style="font-size:0.7rem;font-weight:600;">Search</div></a>
      <a href="feed.html" class="bottom-nav-item"><div style="font-size:1.25rem;">ğŸ“°</div><div style="font-size:0.7rem;font-weight:600;">Feed</div></a>
      <a href="radio.html" class="bottom-nav-item"><div style="font-size:1.25rem;">ğŸ“»</div><div style="font-size:0.7rem;font-weight:600;">Radio</div></a>
      <a href="shop.html" class="bottom-nav-item"><div style="font-size:1.25rem;">ğŸ›’</div><div style="font-size:0.7rem;font-weight:600;">Shop</div></a>
    </div></div>
  </nav>
  <script src="scripts.js?v=fz2" defer></script>
  <script>
  (async function() {
    const db = window.supabase.createClient('https://novbuvwpjnxwwvdekjhr.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0');
    let currentUser = null;
    try {
      const { data:{session} } = await db.auth.getSession();
      if (session) {
        currentUser = session.user;
        const { data:p } = await db.from('profiles').select('username,display_name,avatar_url,badges,algorithm_points,algorithm_tier').eq('user_id',currentUser.id).single();
        if (p) {
          document.getElementById('fanName').textContent = 'Welcome, '+(p.display_name||p.username||'Fan')+'!';
          if (p.avatar_url) document.getElementById('fanAvatar').innerHTML = '<img src="'+p.avatar_url+'" style="width:100%;height:100%;object-fit:cover;">';
          const be = {fan:'ğŸ’',artist:'ğŸ¤',beatmaker:'ğŸšï¸',producer:'ğŸ›ï¸',singer:'ğŸ¶',author:'âœï¸',dancer:'ğŸ’ƒ',influencer:'ğŸ’«',owner:'ğŸ‘‘'};
          document.getElementById('fanBadges').innerHTML = (p.badges||[]).map(b=>'<span class="badge-chip">'+(be[b]||'ğŸŸ£')+' '+b+'</span>').join('');
          document.getElementById('fanTier').textContent = 'ğŸ… '+(p.algorithm_tier||'Bronze');
          document.getElementById('fanPoints').textContent = 'â­ '+(p.algorithm_points||0).toLocaleString()+' points';
        }
      } else { document.getElementById('fanName').textContent = 'Welcome, Fan!'; document.getElementById('fanBadges').innerHTML = '<span class="badge-chip">ğŸ’ Fan</span>'; }
    } catch(e) { document.getElementById('fanName').textContent = 'Welcome, Fan!'; }
    try {
      const [s,a,po,m] = await Promise.all([
        db.from('songs').select('id',{count:'exact',head:true}),
        db.from('profiles').select('user_id',{count:'exact',head:true}).eq('verified_artist',true),
        db.from('posts').select('id',{count:'exact',head:true}),
        db.from('profiles').select('user_id',{count:'exact',head:true})
      ]);
      document.getElementById('statSongs').textContent = (s.count||0).toLocaleString();
      document.getElementById('statArtists').textContent = (a.count||0).toLocaleString();
      document.getElementById('statPosts').textContent = (po.count||0).toLocaleString();
      document.getElementById('statMembers').textContent = (m.count||0).toLocaleString();
    } catch(e) { ['statSongs','statArtists','statPosts','statMembers'].forEach(id=>{document.getElementById(id).textContent='0';}); }
    try {
      const { data:top } = await db.from('profiles').select('user_id,username,display_name,avatar_url,algorithm_points,algorithm_tier,verified_artist').order('algorithm_points',{ascending:false,nullsFirst:false}).gt('algorithm_points',0).limit(10);
      document.getElementById('leaderboardLoading').style.display = 'none';
      if (!top||!top.length) { document.getElementById('leaderboardEmpty').style.display='block'; }
      else {
        const rc = ['','rank-1','rank-2','rank-3'];
        const tc = {Bronze:'#cd7f32',Silver:'#c0c0c0',Gold:'#ffd700',Platinum:'#e5e4e2',Diamond:'#b9f2ff'};
        document.getElementById('leaderboardList').innerHTML = top.map((u,i)=>{
          const n=u.display_name||u.username||'User';
          const av=u.avatar_url?'<img src="'+u.avatar_url+'" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">':'ğŸŸ£';
          const v=u.verified_artist?' <span style="color:#00d9ff;">âœ“</span>':'';
          const t=u.algorithm_tier||'Bronze';
          return '<a href="profile.html?id='+u.user_id+'" class="leaderboard-item"><div class="rank-badge '+(rc[i+1]||'rank-other')+'">'+(i+1)+'</div><div style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#7c3aed,#a855f7);display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0;">'+av+'</div><div style="flex:1;"><div style="font-weight:600;">'+n+v+'</div><div style="font-size:0.85rem;color:'+(tc[t]||'#cd7f32')+';">'+t+'</div></div><div style="font-weight:600;color:#a855f7;">'+(u.algorithm_points||0).toLocaleString()+' pts</div></a>';
        }).join('');
      }
    } catch(e) { document.getElementById('leaderboardLoading').style.display='none'; document.getElementById('leaderboardEmpty').style.display='block'; }
    try {
      const { data:trend } = await db.from('profiles').select('user_id,username,display_name,avatar_url,verified_artist,badges').eq('verified_artist',true).order('algorithm_points',{ascending:false,nullsFirst:false}).limit(6);
      document.getElementById('trendingLoading').style.display = 'none';
      if (!trend||!trend.length) { document.getElementById('trendingEmpty').style.display='block'; }
      else {
        document.getElementById('trendingList').innerHTML = trend.map(u=>{
          const n=u.display_name||u.username||'Artist';
          const av=u.avatar_url?'<img src="'+u.avatar_url+'" style="width:100%;height:100%;object-fit:cover;">':'ğŸ¤';
          const b=(u.badges||[]).includes('beatmaker')?'ğŸšï¸ Beatmaker':(u.badges||[]).includes('artist')?'ğŸ¤ Artist':'';
          return '<a href="profile.html?id='+u.user_id+'" style="display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(124,58,237,0.05);border:1px solid rgba(124,58,237,0.2);border-radius:12px;text-decoration:none;color:inherit;"><div style="width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#7c3aed,#a855f7);display:flex;align-items:center;justify-content:center;font-size:1.5rem;overflow:hidden;flex-shrink:0;">'+av+'</div><div style="flex:1;"><div style="font-weight:600;">'+n+(u.verified_artist?' <span style="color:#00d9ff;">âœ“</span>':'')+'</div><div style="font-size:0.85rem;color:#a855f7;">'+b+'</div></div></a>';
        }).join('');
      }
    } catch(e) { document.getElementById('trendingLoading').style.display='none'; document.getElementById('trendingEmpty').style.display='block'; }
  })();
  </script>
</body>
</html>
