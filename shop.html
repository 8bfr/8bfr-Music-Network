<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>8BFR Shop ‚Äî Buy with Coins</title>
  <link rel="icon" href="assets/images/favicon.png?v=15">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="carrie-closet-data.js?v=3"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.30), transparent 60%),
        radial-gradient(900px 400px at 110% 10%, rgba(0,217,255,.22), transparent 60%),
        linear-gradient(#050011,#000);
      color: #eae6ff;
      margin: 0;
      min-height: 100vh;
    }
    
    header {
      background: rgba(10,0,25,.96);
      border-bottom: 1px solid rgba(124,58,237,.5);
      box-shadow: 0 18px 40px rgba(0,0,0,.7);
    }
    
    .main-tab {
      font-size: 13px;
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,255,.35);
      background: rgba(15,23,42,.8);
      cursor: pointer;
      color: #e5e7eb;
      transition: all .15s ease;
      white-space: nowrap;
      font-weight: 600;
    }
    
    .main-tab.active {
      border-color: #a855f7;
      background: linear-gradient(135deg, #7c3aed, #a855f7);
      color: white;
      box-shadow: 0 0 20px rgba(168,85,247,.4);
    }
    
    .tab-btn {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,255,.35);
      background: rgba(15,23,42,.8);
      cursor: pointer;
      color: #e5e7eb;
      transition: all .12s ease;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      border-color: #38bdf8;
      background: radial-gradient(circle at 0 0, #38bdf8, #6366f1);
      color: #0f172a;
    }
    
    .item-card {
      background: rgba(15,23,42,.96);
      border: 1px solid rgba(124,58,237,.4);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.15s ease;
      cursor: pointer;
    }
    
    .item-card:hover {
      transform: translateY(-2px);
      border-color: #a855f7;
      box-shadow: 0 0 0 1px rgba(129,140,248,.85), 0 0 20px rgba(124,58,237,.6);
    }
    
    .item-card.owned {
      border-color: #22c55e;
      opacity: 0.6;
      cursor: default;
    }
    
    .item-card.coming-soon {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .item-img {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 8px;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 0.75rem;
      position: relative;
    }
    
    .item-img img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    
    .price-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      background: rgba(168,85,247,.2);
      border: 1px solid rgba(168,85,247,.5);
      border-radius: 999px;
      padding: 0.25rem 0.5rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: #a855f7;
    }
    
    .owned-badge {
      background: rgba(34,197,94,.2);
      border: 1px solid rgba(34,197,94,.6);
      color: #22c55e;
    }
    
    .coming-soon-badge {
      background: rgba(234,179,8,.2);
      border: 1px solid rgba(234,179,8,.6);
      color: #eab308;
    }
  </style>
</head>
<body>
  <header class="px-4 py-4">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="assets/images/logo_8bfr.svg?v=15"
             alt="8BFR logo"
             class="h-9 w-auto"
             onerror="this.onerror=null;this.src='assets/images/8bfr.png?v=15'">
        <div>
          <h1 class="text-xl sm:text-2xl font-extrabold">
            <span class="text-[#a855f7]">8BFR Shop</span>
          </h1>
          <p class="text-[11px] text-purple-300/80 -mt-0.5">
            Browse and buy items with your 8BFR coins
          </p>
        </div>
      </div>
      <div class="flex flex-col items-end gap-1">
        <a href="https://8bfr.github.io/8bfr-Music-Network/index.html"
           class="text-[#00d9ff] text-[11px] sm:text-xs underline/50 hover:underline">
          ‚¨Ö Back to Home
        </a>
        <div style="font-size:11px; color:#a855f7;">
          Balance: <span id="coinBalance" style="font-weight:700;">0</span> <img src="assets/images/icon_8bfr_coin.png" style="width:1em; height:1em; display:inline-block; vertical-align:middle;">
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-10 pt-6">
    <!-- Main Category Tabs -->
    <div class="flex flex-wrap gap-3 mb-6">
      <button type="button" class="main-tab active" data-main-cat="accessories">üëó Avatar Accessories</button>
      <button type="button" class="main-tab" data-main-cat="stickers">üé® Stickers</button>
      <button type="button" class="main-tab" data-main-cat="game-items">üéÆ Game Items</button>
      <button type="button" class="main-tab" data-main-cat="upgrades">‚ö° Upgrades</button>
    </div>

    <!-- Accessories Sub-categories -->
    <div id="accessoriesFilters" class="mb-6">
      <div class="flex flex-wrap gap-2 mb-3">
        <button type="button" class="tab-btn active" data-cat="all">All Items</button>
        <button type="button" class="tab-btn" data-cat="hair">Hair</button>
        <button type="button" class="tab-btn" data-cat="top">Tops</button>
        <button type="button" class="tab-btn" data-cat="bottom">Bottoms</button>
        <button type="button" class="tab-btn" data-cat="jewelry">Jewelry</button>
        <button type="button" class="tab-btn" data-cat="eyes">Eyes</button>
        <button type="button" class="tab-btn" data-cat="shoes">Shoes</button>
      </div>

      <!-- Gender Filter -->
      <div class="flex gap-2">
        <button type="button" class="tab-btn active" data-gender="all">All</button>
        <button type="button" class="tab-btn" data-gender="female">Female</button>
        <button type="button" class="tab-btn" data-gender="male">Male</button>
        <button type="button" class="tab-btn" data-gender="unisex">Unisex</button>
      </div>
    </div>

    <!-- Stickers Filters -->
    <div id="stickersFilters" class="mb-6" style="display:none;">
      <div class="flex flex-wrap gap-2">
        <button type="button" class="tab-btn active" data-sticker-cat="all">All Stickers</button>
        <button type="button" class="tab-btn" data-sticker-cat="emojis">Emojis</button>
        <button type="button" class="tab-btn" data-sticker-cat="reactions">Reactions</button>
        <button type="button" class="tab-btn" data-sticker-cat="custom">Custom</button>
      </div>
    </div>

    <!-- Game Items Filters -->
    <div id="gameItemsFilters" class="mb-6" style="display:none;">
      <div class="flex flex-wrap gap-2">
        <button type="button" class="tab-btn active" data-game-cat="all">All Items</button>
        <button type="button" class="tab-btn" data-game-cat="powerups">Power-Ups</button>
        <button type="button" class="tab-btn" data-game-cat="boosters">Boosters</button>
        <button type="button" class="tab-btn" data-game-cat="tools">Tools</button>
      </div>
    </div>

    <!-- Upgrades Filters -->
    <div id="upgradesFilters" class="mb-6" style="display:none;">
      <div class="flex flex-wrap gap-2">
        <button type="button" class="tab-btn active" data-upgrade-cat="all">All Upgrades</button>
        <button type="button" class="tab-btn" data-upgrade-cat="chat">Chat Features</button>
        <button type="button" class="tab-btn" data-upgrade-cat="profile">Profile</button>
        <button type="button" class="tab-btn" data-upgrade-cat="badges">Badges</button>
      </div>
    </div>

    <!-- Items Grid -->
    <div id="itemsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
      <!-- Populated by JavaScript -->
    </div>

    <!-- Coming Soon Notice -->
    <div id="comingSoonNotice" class="mt-8 text-center text-purple-300/60 text-sm" style="display:none;">
      üí° More items coming soon! Check back later.
    </div>

    <!-- Links -->
    <div class="mt-10 flex flex-wrap justify-center gap-4">
      <a href="coinshop.html" class="text-[#00d9ff] text-sm underline hover:opacity-80">
        <img src="assets/images/icon_8bfr_coin.png" style="width:1em; height:1em; display:inline-block; vertical-align:middle;"> Buy More Coins
      </a>
      <a href="carrie-chat.html" class="text-[#00d9ff] text-sm underline hover:opacity-80">
        üí¨ Back to Chat
      </a>
    </div>
  </main>

  <script>
    let currentMainCategory = "accessories";
    let currentCategory = "all";
    let currentGender = "all";
    let currentStickerCat = "all";
    let currentGameCat = "all";
    let currentUpgradeCat = "all";
    
    let coins = parseInt(localStorage.getItem("carrieCoins_v1") || "0");
    let ownedItems = JSON.parse(localStorage.getItem("carrieOwnedItems_v1") || "[]");

    function updateCoinDisplay() {
      document.getElementById("coinBalance").textContent = coins.toLocaleString();
    }

    function showFilters(category) {
      // Hide all filter sections
      document.getElementById("accessoriesFilters").style.display = "none";
      document.getElementById("stickersFilters").style.display = "none";
      document.getElementById("gameItemsFilters").style.display = "none";
      document.getElementById("upgradesFilters").style.display = "none";
      
      // Show relevant filters
      if (category === "accessories") {
        document.getElementById("accessoriesFilters").style.display = "block";
      } else if (category === "stickers") {
        document.getElementById("stickersFilters").style.display = "block";
      } else if (category === "game-items") {
        document.getElementById("gameItemsFilters").style.display = "block";
      } else if (category === "upgrades") {
        document.getElementById("upgradesFilters").style.display = "block";
      }
    }

    function filterItems() {
      const items = window.CARRIE_CLOSET_ITEMS || [];
      
      if (currentMainCategory === "accessories") {
        return items.filter(item => {
          // Category filter
          const categoryToSlot = {
            "hair": "hair",
            "top": "top",
            "bottom": "bottom",
            "jewelry": ["necklace", "ears", "belly"],
            "eyes": "eyes",
            "shoes": "shoes"
          };
          
          let categoryMatch = true;
          if (currentCategory !== "all") {
            const slots = categoryToSlot[currentCategory];
            if (Array.isArray(slots)) {
              categoryMatch = slots.includes(item.slot);
            } else {
              categoryMatch = item.slot === slots;
            }
          }
          
          // Gender filter
          let genderMatch = true;
          if (currentGender !== "all") {
            genderMatch = item.gender === currentGender;
          }
          
          return categoryMatch && genderMatch;
        });
      } else {
        // Other categories return empty for now (coming soon)
        return [];
      }
    }

    function renderItems() {
      const grid = document.getElementById("itemsGrid");
      const comingSoon = document.getElementById("comingSoonNotice");
      const filtered = filterItems();
      
      grid.innerHTML = "";
      
      if (currentMainCategory !== "accessories") {
        // Show coming soon for non-accessories
        comingSoon.style.display = "block";
        grid.innerHTML = `
          <div style="grid-column:1/-1; text-align:center; padding:3rem;">
            <div style="font-size:3rem; margin-bottom:1rem;">üöß</div>
            <div style="font-size:1.2rem; color:#a855f7; font-weight:600; margin-bottom:0.5rem;">
              ${currentMainCategory === "stickers" ? "Stickers" : 
                currentMainCategory === "game-items" ? "Game Items" : 
                "Upgrades"} Coming Soon!
            </div>
            <div style="font-size:0.9rem; color:#e5e7eb; opacity:0.7;">
              We're working hard to bring you ${currentMainCategory === "stickers" ? "awesome stickers" : 
                currentMainCategory === "game-items" ? "exciting game items" : 
                "powerful upgrades"}
            </div>
          </div>
        `;
        return;
      }
      
      comingSoon.style.display = "none";
      
      if (filtered.length === 0) {
        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:3rem; color:#a855f7; opacity:.7;">No items found in this category</div>';
        return;
      }
      
      filtered.forEach(item => {
        const owned = ownedItems.includes(item.id);
        const card = document.createElement("div");
        card.className = "item-card" + (owned ? " owned" : "");
        
        card.innerHTML = `
          <div class="item-img">
            <img src="${item.img}" alt="${item.name}">
          </div>
          <div style="font-size:0.85rem; font-weight:600; margin-bottom:0.5rem; color:#e5e7eb;">${item.name}</div>
          <div style="display:flex; justify-content:space-between; align-items:center;">
            ${owned 
              ? '<span class="price-tag owned-badge">‚úÖ Owned</span>'
              : `<span class="price-tag">${item.price} <img src="assets/images/icon_8bfr_coin.png" style="width:1em; height:1em; display:inline-block; vertical-align:middle;"></span>`
            }
          </div>
        `;
        
        if (!owned) {
          card.addEventListener("click", () => purchaseItem(item));
        }
        
        grid.appendChild(card);
      });
    }

    function purchaseItem(item) {
      if (ownedItems.includes(item.id)) {
        alert("You already own this item!");
        return;
      }
      
      if (coins < item.price) {
        if (confirm(`Not enough coins! You need ${item.price} coins but only have ${coins}. Buy more coins?`)) {
          window.location.href = "coinshop.html";
        }
        return;
      }
      
      if (confirm(`Purchase ${item.name} for ${item.price} coins?`)) {
        coins -= item.price;
        ownedItems.push(item.id);
        
        localStorage.setItem("carrieCoins_v1", coins.toString());
        localStorage.setItem("carrieOwnedItems_v1", JSON.stringify(ownedItems));
        
        updateCoinDisplay();
        renderItems();
        
        alert(`‚úÖ Successfully purchased ${item.name}!`);
      }
    }

    // Main category tabs
    document.querySelectorAll('[data-main-cat]').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('[data-main-cat]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentMainCategory = this.dataset.mainCat;
        showFilters(currentMainCategory);
        renderItems();
      });
    });

    // Accessories category tabs
    document.querySelectorAll('[data-cat]').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('[data-cat]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentCategory = this.dataset.cat;
        renderItems();
      });
    });

    // Accessories gender tabs
    document.querySelectorAll('[data-gender]').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('[data-gender]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentGender = this.dataset.gender;
        renderItems();
      });
    });

    // Initialize
    updateCoinDisplay();
    showFilters(currentMainCategory);
    renderItems();
  </script>
  <!-- ADD THIS SCRIPT TO EVERY PAGE (except index.html where you want it always shown) -->
<!-- Place it right before the closing </body> tag -->

<script>
// Avatar & Bubble Toggle System
(function() {
    // Create toggle button
    const toggleBtn = document.createElement('button');
    toggleBtn.id = 'avatarToggle';
    toggleBtn.innerHTML = 'üëÅÔ∏è';
    toggleBtn.title = 'Toggle Avatar/Bubbles';
    toggleBtn.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 9999;
        background: rgba(124, 58, 237, 0.9);
        border: 2px solid rgba(124, 58, 237, 1);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(124, 58, 237, 0.5);
        transition: all 0.3s ease;
    `;
    
    toggleBtn.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.1)';
    });
    
    toggleBtn.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
    });
    
    document.body.appendChild(toggleBtn);
    
    // Load saved preference
    let isHidden = localStorage.getItem('hideAvatarBubbles') === 'true';
    
    function updateVisibility() {
        const elementsToToggle = [
            document.getElementById('homeAvatarSwitcher'),
            ...document.querySelectorAll('[id*="bubble"]'),
            ...document.querySelectorAll('[class*="bubble"]'),
            ...document.querySelectorAll('[id*="avatar"][id*="switcher"]')
        ];
        
        elementsToToggle.forEach(el => {
            if (el) {
                el.style.display = isHidden ? 'none' : '';
            }
        });
        
        toggleBtn.innerHTML = isHidden ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è';
        toggleBtn.title = isHidden ? 'Show Avatar/Bubbles' : 'Hide Avatar/Bubbles';
    }
    
    toggleBtn.addEventListener('click', function() {
        isHidden = !isHidden;
        localStorage.setItem('hideAvatarBubbles', isHidden);
        updateVisibility();
    });
    
    // Apply on load
    updateVisibility();
    
    // Watch for dynamically added elements
    const observer = new MutationObserver(updateVisibility);
    observer.observe(document.body, { childList: true, subtree: true });
})();
</script>

</body>
</html>
