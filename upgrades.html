<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Upgrade ‚Äî 8BFR Music Network</title>
<link rel="icon" href="assets/images/favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'DM Sans',system-ui,sans-serif;background:linear-gradient(180deg,#0b0014 0%,#000 100%);color:#eae6ff;min-height:100vh}
  a{color:#a855f7;text-decoration:none}
  .wrap{max-width:780px;margin:0 auto;padding:0 1rem}
  header{background:rgba(15,0,30,0.9);border-bottom:1px solid rgba(124,58,237,0.5);padding:1rem;position:sticky;top:0;z-index:100}
  .hdr-inner{max-width:780px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
  .hdr-inner a{color:#a855f7;font-weight:600}
  .hdr-title{font-family:Syne;font-size:1.2rem;font-weight:800}
  .glow{text-shadow:0 0 30px rgba(124,58,237,0.4)}
  .status-bar{background:rgba(12,6,24,0.9);border:1px solid rgba(124,58,237,0.2);border-radius:14px;padding:1.25rem;margin-bottom:2rem;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:0.5rem}
  .status-label{font-size:0.75rem;color:rgba(168,85,247,0.6);text-transform:uppercase;letter-spacing:0.05em;font-weight:600}
  .status-plan{font-family:Syne;font-size:1.3rem;font-weight:800}
  .hero{text-align:center;margin-bottom:3rem}
  .hero h2{font-family:Syne;font-size:clamp(1.8rem,4vw,2.8rem);font-weight:800;line-height:1.1;margin-bottom:0.75rem}
  .hero p{color:rgba(168,85,247,0.7);font-size:1.05rem;max-width:500px;margin:0 auto}
  .plans-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:3rem}
  @media(max-width:640px){.plans-grid{grid-template-columns:1fr}}
  .plan-card{background:rgba(12,6,24,0.85);border:1px solid rgba(124,58,237,0.25);border-radius:20px;padding:2rem;position:relative;transition:all 0.3s}
  .plan-card:hover{border-color:rgba(124,58,237,0.5);transform:translateY(-4px);box-shadow:0 12px 40px rgba(124,58,237,0.15)}
  .plan-card.featured{border-color:rgba(124,58,237,0.6);background:linear-gradient(180deg,rgba(124,58,237,0.08),rgba(12,6,24,0.9))}
  .plan-card.featured::before{content:'BEST VALUE';position:absolute;top:-14px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#7c3aed,#a855f7);color:#fff;font-size:0.7rem;font-weight:800;padding:0.35rem 1rem;border-radius:20px;letter-spacing:0.05em}
  .plan-name{font-family:Syne;font-size:1.1rem;font-weight:700}
  .plan-price{font-family:Syne;font-size:2.5rem;font-weight:800;margin:0.5rem 0}
  .plan-price span{font-size:0.85rem;font-weight:400;color:rgba(168,85,247,0.5)}
  .plan-sub{font-size:0.85rem;color:rgba(168,85,247,0.6);margin-bottom:1.25rem}
  .section-label{font-size:0.78rem;font-weight:600;text-transform:uppercase;letter-spacing:0.04em;margin-bottom:0.5rem}
  .section-label.purple{color:#a855f7}
  .section-label.gold{color:#d4a017}
  .feature-row{display:flex;align-items:flex-start;gap:0.3rem;font-size:0.9rem;line-height:1.8}
  .chk{color:#a855f7;margin-right:0.4rem}
  .lck{color:rgba(168,85,247,0.3);margin-right:0.4rem}
  .divider{height:1px;background:rgba(124,58,237,0.15);margin:1.5rem 0}
  .plan-btn{display:block;width:100%;padding:0.85rem;border-radius:12px;border:none;font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.2s;text-align:center;text-decoration:none;font-family:'DM Sans',system-ui,sans-serif}
  .plan-btn:hover:not(:disabled){transform:translateY(-2px)}
  .plan-btn:disabled{opacity:0.4;cursor:default}
  .btn-free{background:rgba(255,255,255,0.06);color:#eae6ff;border:1px solid rgba(255,255,255,0.08)}
  .btn-pro{background:linear-gradient(135deg,#7c3aed,#a855f7);color:#fff;box-shadow:0 4px 15px rgba(124,58,237,0.3);border:none}
  .btn-pro:hover{box-shadow:0 6px 25px rgba(124,58,237,0.4)}
  .current-badge{display:inline-block;background:rgba(34,197,94,0.15);color:#4ade80;font-size:0.72rem;font-weight:700;padding:0.2rem 0.6rem;border-radius:8px}
  .paypal-note{font-size:0.78rem;color:rgba(168,85,247,0.5);text-align:center;margin-top:0.75rem;font-style:italic}
  .info-card{background:rgba(12,6,24,0.7);border:1px solid rgba(124,58,237,0.2);border-radius:16px;padding:1.75rem;margin-bottom:3rem}
  .info-card h3{font-family:Syne;font-size:1.15rem;font-weight:700;margin-bottom:1rem}
  .info-card p{font-size:0.92rem;color:rgba(168,85,247,0.8);line-height:1.7;margin-bottom:1rem}
  .info-card a{color:#d4a017;font-weight:600;font-size:0.9rem}
  .modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);z-index:1000;align-items:center;justify-content:center;padding:1rem}
  .modal-box{background:#0c0618;border:1px solid rgba(124,58,237,0.4);border-radius:20px;padding:2rem;max-width:440px;width:100%;position:relative}
  .modal-close{position:absolute;top:1rem;right:1rem;background:none;border:none;color:rgba(168,85,247,0.5);font-size:1.3rem;cursor:pointer}
  .modal-box h3{font-family:Syne;font-size:1.3rem;font-weight:800;margin-bottom:0.5rem}
  .modal-sub{color:rgba(168,85,247,0.6);font-size:0.88rem;margin-bottom:1.5rem}
  .pay-box{background:rgba(124,58,237,0.08);border:1px solid rgba(124,58,237,0.25);border-radius:12px;padding:1.25rem;margin-bottom:1.25rem}
  .pay-box p{font-size:0.9rem;margin-bottom:1rem}
  .pay-addr{background:rgba(0,0,0,0.3);padding:0.75rem;border-radius:8px;display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}
  .pay-addr code{font-size:0.95rem}
  .pay-addr button{background:none;border:none;color:#a855f7;cursor:pointer;font-size:1.1rem}
  .paypal-btn{display:block;width:100%;padding:0.85rem;border-radius:12px;border:none;background:#0070ba;color:#fff;font-size:1rem;font-weight:700;cursor:pointer;text-align:center;text-decoration:none;font-family:'DM Sans',system-ui,sans-serif;margin-bottom:0.5rem}
  .modal-fine{font-size:0.75rem;color:rgba(168,85,247,0.4);text-align:center;margin-top:0.75rem;font-style:italic}
  .already-pro{display:none;margin-bottom:2rem}
  .already-box{background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.25);border-radius:16px;padding:2rem;text-align:center}
  .already-box h3{font-family:Syne;font-size:1.3rem;font-weight:800;color:#4ade80;margin-bottom:0.5rem}
  .already-box p{color:rgba(168,85,247,0.7);font-size:0.92rem;margin-bottom:1.5rem}
  .already-btns{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap}
  .already-btns a{padding:0.75rem 1.5rem;border-radius:12px;font-weight:600;font-size:0.9rem;text-decoration:none}
  footer{padding:2rem;text-align:center;border-top:1px solid rgba(124,58,237,0.1);margin-top:2rem}
  footer p{font-size:0.78rem;color:rgba(168,85,247,0.4)}
</style>
</head>
<body>

<header>
  <div class="hdr-inner">
    <a href="index.html">‚Üê Home</a>
    <span class="hdr-title">‚ö° Upgrade Your Account</span>
    <a href="profile.html" style="font-size:0.9rem;">Profile</a>
  </div>
</header>

<main style="padding:2rem 0;">
<div class="wrap">

  <!-- Status -->
  <div class="status-bar">
    <div>
      <div class="status-label">Current Plan</div>
      <div class="status-plan" id="currentPlanName">Free</div>
    </div>
    <div id="currentBadge"></div>
  </div>

  <!-- Hero -->
  <div class="hero">
    <h2 class="glow">One Upgrade.<br>Two Powerful Apps.</h2>
    <p>Get full access to the 8BFR Music Network <em>and</em> Producer AI with a single Artist Pro subscription.</p>
  </div>

  <!-- Plans -->
  <div class="plans-grid">

    <!-- Free -->
    <div class="plan-card">
      <div class="plan-name">Free</div>
      <div class="plan-price">$0<span> /forever</span></div>
      <div class="plan-sub">Get started and explore</div>

      <div class="section-label purple">8BFR Network</div>
      <div class="feature-row"><span class="chk">‚úì</span> Artist / Beatmaker profile</div>
      <div class="feature-row"><span class="chk">‚úì</span> Upload &amp; sell music</div>
      <div class="feature-row"><span class="chk">‚úì</span> Browse &amp; discover</div>
      <div class="feature-row"><span class="lck">‚úó</span> Verified badge</div>
      <div class="feature-row"><span class="lck">‚úó</span> Priority in algorithm</div>

      <div class="divider"></div>
      <div class="section-label gold">üéµ Producer AI</div>
      <div class="feature-row"><span class="chk">‚úì</span> 3 generations per day</div>
      <div class="feature-row"><span class="chk">‚úì</span> All 7 AI tools</div>
      <div class="feature-row"><span class="lck">‚úó</span> Watermarked outputs</div>
      <div class="feature-row"><span class="lck">‚úó</span> No copy or download</div>

      <div style="margin-top:1.5rem;">
        <button class="plan-btn btn-free" id="freeBtn" disabled>Current Plan</button>
      </div>
    </div>

    <!-- Artist Pro -->
    <div class="plan-card featured">
      <div class="plan-name">Artist Pro</div>
      <div class="plan-price">$12.99<span> /month</span></div>
      <div class="plan-sub">Everything. Unlimited.</div>

      <div class="section-label purple">8BFR Network</div>
      <div class="feature-row"><span class="chk">‚úì</span> Everything in Free</div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>Verified artist badge</strong></div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>Priority in algorithm</strong></div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>Featured placement</strong></div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>Promo &amp; marketing tools</strong></div>

      <div class="divider"></div>
      <div class="section-label gold">üéµ Producer AI ‚Äî Included</div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>Unlimited generations</strong></div>
      <div class="feature-row"><span class="chk">‚úì</span> All 7 AI tools</div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>No watermarks</strong></div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>Copy &amp; download</strong></div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>3000√ó3000 album covers</strong></div>
      <div class="feature-row"><span class="chk">‚úì</span> <strong>Commercial license</strong></div>

      <div style="margin-top:1.5rem;">
        <button class="plan-btn btn-pro" id="proBtn" onclick="startUpgrade()">‚ö° Upgrade to Artist Pro</button>
        <div class="paypal-note">Secure payment via PayPal</div>
      </div>
    </div>
  </div>

  <!-- What's Producer AI -->
  <div class="info-card">
    <h3>üéµ What is Producer AI?</h3>
    <p>Producer AI is our AI-powered creative suite with 7 tools built for music creators: Lyrics Generator, Album Cover Creator, Song Creator, Beat Blueprint, Rhyme Finder, Post Generator, and Video Concepts.</p>
    <a href="https://8bfr.github.io/producer-ai/" target="_blank">Try Producer AI Free ‚Üí</a>
  </div>

  <!-- Already Pro -->
  <div class="already-pro" id="alreadyPro">
    <div class="already-box">
      <div style="font-size:2.5rem;margin-bottom:0.5rem;">üéâ</div>
      <h3>You're an Artist Pro!</h3>
      <p>You have full access to both apps.</p>
      <div class="already-btns">
        <a href="profile.html" style="background:rgba(124,58,237,0.15);color:#a855f7;border:1px solid rgba(124,58,237,0.3);">My Profile</a>
        <a href="https://8bfr.github.io/producer-ai/" target="_blank" style="background:rgba(212,160,23,0.12);color:#f5c842;border:1px solid rgba(212,160,23,0.25);">üéµ Open Producer AI</a>
      </div>
    </div>
  </div>

</div>
</main>

<!-- PayPal Modal -->
<div class="modal-bg" id="upgradeModal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h3>‚ö° Upgrade to Artist Pro</h3>
    <p class="modal-sub">$12.99/month ‚Äî cancel anytime</p>
    <div class="pay-box">
      <p>Send <strong style="color:#f59e0b;">$12.99</strong> to activate your first month:</p>
      <div class="pay-addr">
        <code>8bfr.music@gmail.com</code>
        <button onclick="navigator.clipboard.writeText('8bfr.music@gmail.com');this.textContent='‚úì';setTimeout(()=>this.textContent='üìã',1500)">üìã</button>
      </div>
      <a href="https://www.paypal.com/paypalme/8bfrmusic/12.99" target="_blank" rel="noopener" class="paypal-btn">üí≥ Open PayPal ‚Äî $12.99</a>
    </div>
    <button class="plan-btn btn-pro" id="confirmUpgradeBtn" onclick="confirmUpgrade()">‚úÖ I Sent Payment ‚Äî Activate Artist Pro</button>
    <p class="modal-fine">Your upgrade activates immediately. Renewals are manual monthly via PayPal.</p>
  </div>
</div>

<footer>
  <p>¬© 2025 8BFR Music Network ¬∑ <a href="mailto:8bfr.music@gmail.com">Contact Support</a></p>
</footer>

<script>
/* ‚îÄ‚îÄ Upgrade Page Logic ‚îÄ‚îÄ */
var SUPABASE_URL = 'https://novbuvwpjnxwwvdekjhr.supabase.co';
var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vdmJ1dndwam54d3d2ZGVramhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExODkxODUsImV4cCI6MjA3Njc2NTE4NX0.1UUkdGafh6ZplAX8hi7Bvj94D2gvFQZUl0an1RvcSA0';
var OWNER_ID = 'cb556180-f032-4b21-9470-1d786f2664ab';
var db, user = null, tier = 'free';

function startUpgrade() {
  if (tier === 'pro') return;
  if (!user) { window.location.href = 'login.html?return=upgrades.html'; return; }
  document.getElementById('upgradeModal').style.display = 'flex';
}
function closeModal() { document.getElementById('upgradeModal').style.display = 'none'; }

async function confirmUpgrade() {
  var btn = document.getElementById('confirmUpgradeBtn');
  btn.disabled = true; btn.textContent = 'Activating...';
  try {
    var expires = new Date(Date.now() + 30 * 86400000).toISOString();
    var existing = null;
    try { var r = await db.from('app_subscriptions').select('id').eq('user_id', user.id).limit(1).single(); existing = r.data; } catch(e){}
    if (existing) {
      await db.from('app_subscriptions').update({ tier:'pro', status:'active', expires_at:expires, updated_at:new Date().toISOString() }).eq('user_id', user.id);
    } else {
      await db.from('app_subscriptions').insert({ user_id:user.id, tier:'pro', status:'active', expires_at:expires });
    }
    closeModal();
    tier = 'pro';
    document.getElementById('currentPlanName').textContent = 'Artist Pro';
    document.getElementById('currentPlanName').style.color = '#a855f7';
    document.getElementById('currentBadge').innerHTML = '<span class="current-badge">‚úì Active</span>';
    document.getElementById('proBtn').textContent = '‚úì Current Plan';
    document.getElementById('proBtn').disabled = true;
    document.getElementById('alreadyPro').style.display = 'block';
    alert('Artist Pro activated! You now have full access to the 8BFR Network and Producer AI.');
  } catch(e) {
    alert('Error: ' + e.message);
    btn.disabled = false; btn.textContent = 'I Sent Payment ‚Äî Activate Artist Pro';
  }
}

document.getElementById('upgradeModal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

/* ‚îÄ‚îÄ Load Supabase async (non-blocking) ‚îÄ‚îÄ */
(function() {
  var s = document.createElement('script');
  s.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
  s.onload = async function() {
    if (!window.supabase || !window.supabase.createClient) return;
    try {
      db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      var session = null;
      try { var r = await db.auth.getSession(); session = r && r.data ? r.data.session : null; } catch(e) {}
      
      if (!session || !session.user) {
        document.getElementById('currentPlanName').textContent = 'Not Logged In';
        document.getElementById('currentBadge').innerHTML = '<a href="login.html?return=upgrades.html" style="color:#a855f7;font-size:0.85rem;">Log In ‚Üí</a>';
        document.getElementById('freeBtn').textContent = 'Sign Up Free';
        document.getElementById('freeBtn').disabled = false;
        document.getElementById('freeBtn').onclick = function(){ window.location.href='login.html?return=upgrades.html'; };
        return;
      }
      user = session.user;
      var isOwner = user.id === OWNER_ID;

      try {
        var g = await db.from('free_access_grants').select('*').eq('user_email', user.email).eq('is_active', true).limit(1).single();
        if (g.data) tier = g.data.granted_tier || 'pro';
      } catch(e){}
      
      if (tier === 'free') {
        try {
          var sub = await db.from('app_subscriptions').select('*').eq('user_id', user.id).order('created_at', { ascending:false }).limit(1).single();
          if (sub.data) { tier = sub.data.tier || 'free'; if (sub.data.expires_at && new Date(sub.data.expires_at) < new Date() && sub.data.tier !== 'free') tier = 'free'; }
        } catch(e){}
      }
      if (isOwner) tier = 'pro';

      if (tier === 'pro') {
        document.getElementById('currentPlanName').textContent = 'Artist Pro';
        document.getElementById('currentPlanName').style.color = '#a855f7';
        document.getElementById('currentBadge').innerHTML = '<span class="current-badge">‚úì Active</span>';
        document.getElementById('freeBtn').textContent = 'Free';
        document.getElementById('proBtn').textContent = '‚úì Current Plan';
        document.getElementById('proBtn').disabled = true;
        document.getElementById('alreadyPro').style.display = 'block';
      } else {
        document.getElementById('currentBadge').innerHTML = '<a href="#" onclick="document.querySelector(\'.featured\').scrollIntoView({behavior:\'smooth\'});return false;" style="color:#a855f7;font-size:0.85rem;">Upgrade ‚Üí</a>';
      }

      var params = new URLSearchParams(window.location.search);
      if (params.get('from') === 'producer-ai' && tier !== 'pro') startUpgrade();
    } catch(e) { console.error(e); }
  };
  document.head.appendChild(s);
})();
</script>

<!-- Avatar Toggle (no MutationObserver) -->
<script>
(function() {
  var b = document.createElement('button');
  b.innerHTML = 'üëÅÔ∏è';
  b.style.cssText = 'position:fixed;top:80px;right:20px;z-index:9999;background:rgba(124,58,237,0.9);border:2px solid rgba(124,58,237,1);color:white;width:50px;height:50px;border-radius:50%;cursor:pointer;font-size:24px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(124,58,237,0.5);';
  document.body.appendChild(b);
  var h = localStorage.getItem('hideAvatarBubbles') === 'true';
  function u() {
    document.querySelectorAll('[id*="bubble"],[class*="bubble"],[id*="avatar"][id*="switcher"]').forEach(function(el){ if(el) el.style.display = h ? 'none' : ''; });
    b.innerHTML = h ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è';
  }
  b.addEventListener('click', function(){ h = !h; localStorage.setItem('hideAvatarBubbles', h); u(); });
  u();
})();
</script>

<script src="scripts.js" defer></script>
</body>
</html>
